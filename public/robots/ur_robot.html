<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.6.1"/>
    <title>robots.ur_robot API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../robots.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;robots</a>

            <img src="mujoco-logo-reborn.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#URRobot">URRobot</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#URRobot.__init__">URRobot</a>
                        </li>
                        <li>
                                <a class="class" href="#URRobot.Type">URRobot.Type</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="variable" href="#URRobot.Type.UR3e">UR3e</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#URRobot.Type.UR5e">UR5e</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#URRobot.Type.UR10e">UR10e</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="variable" href="#URRobot.dt">dt</a>
                        </li>
                        <li>
                                <a class="variable" href="#URRobot.home_qpos">home_qpos</a>
                        </li>
                        <li>
                                <a class="variable" href="#URRobot.tcp_id">tcp_id</a>
                        </li>
                        <li>
                                <a class="function" href="#URRobot.step">step</a>
                        </li>
                        <li>
                                <a class="variable" href="#URRobot.controller">controller</a>
                        </li>
                        <li>
                                <a class="variable" href="#URRobot.info">info</a>
                        </li>
                        <li>
                                <a class="variable" href="#URRobot.data">data</a>
                        </li>
                        <li>
                                <a class="variable" href="#URRobot.model">model</a>
                        </li>
                        <li>
                                <a class="variable" href="#URRobot.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#URRobot.type">type</a>
                        </li>
                        <li>
                                <a class="variable" href="#URRobot.actuator_values">actuator_values</a>
                        </li>
                        <li>
                                <a class="variable" href="#URRobot.w">w</a>
                        </li>
                        <li>
                                <a class="function" href="#URRobot.fk">fk</a>
                        </li>
                        <li>
                                <a class="function" href="#URRobot.ik">ik</a>
                        </li>
                        <li>
                                <a class="function" href="#URRobot.get_ee_pose">get_ee_pose</a>
                        </li>
                        <li>
                                <a class="function" href="#URRobot.set_ee_pose">set_ee_pose</a>
                        </li>
                        <li>
                                <a class="function" href="#URRobot.move_l">move_l</a>
                        </li>
                        <li>
                                <a class="function" href="#URRobot.move_j">move_j</a>
                        </li>
                        <li>
                                <a class="function" href="#URRobot.move_traj">move_traj</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../robots.html">robots</a><wbr>.ur_robot    </h1>

                
                        <input id="mod-ur_robot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-ur_robot-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span> <span class="nn">enum</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span> <span class="nn">math</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">import</span> <span class="nn">time</span> <span class="k">as</span> <span class="nn">t</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">import</span> <span class="nn">mujoco</span> <span class="k">as</span> <span class="nn">mj</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">import</span> <span class="nn">mujoco.viewer</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">import</span> <span class="nn">spatialmath</span> <span class="k">as</span> <span class="nn">sm</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">import</span> <span class="nn">spatialmath.base</span> <span class="k">as</span> <span class="nn">smb</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">from</span> <span class="nn">mujoco</span> <span class="kn">import</span> <span class="n">minimize</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="c1"># from ctrl.dmp_position import DMPPosition</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">from</span> <span class="nn">ctrl.base_ctrl</span> <span class="kn">import</span> <span class="n">BaseController</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="kn">from</span> <span class="nn">robots.base_robot</span> <span class="kn">import</span> <span class="n">BaseRobot</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="kn">from</span> <span class="nn">sims.base_sim</span> <span class="kn">import</span> <span class="n">SimSync</span><span class="p">,</span> <span class="n">sleep</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="kn">from</span> <span class="nn">utils.mj</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>    <span class="n">ObjType</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>    <span class="n">RobotInfo</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>    <span class="n">get_pose</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>    <span class="n">name2id</span><span class="p">,</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>    <span class="n">set_joint_q</span><span class="p">,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="p">)</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="kn">from</span> <span class="nn">utils.sm</span> <span class="kn">import</span> <span class="n">ctraj</span><span class="p">,</span> <span class="n">jtraj</span><span class="p">,</span> <span class="n">make_tf</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="k">class</span> <span class="nc">URRobot</span><span class="p">(</span><span class="n">BaseRobot</span><span class="p">):</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>    <span class="k">class</span> <span class="nc">Type</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>        <span class="n">UR3e</span> <span class="o">=</span> <span class="s2">&quot;ur3e&quot;</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>        <span class="n">UR5e</span> <span class="o">=</span> <span class="s2">&quot;ur5e&quot;</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>        <span class="n">UR10e</span> <span class="o">=</span> <span class="s2">&quot;ur10e&quot;</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>        <span class="n">model</span><span class="p">:</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjModel</span><span class="p">,</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjData</span><span class="p">,</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>        <span class="n">robot_type</span><span class="p">:</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">Type</span><span class="o">.</span><span class="n">UR5e</span><span class="p">,</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_robot_type</span> <span class="o">=</span> <span class="n">robot_type</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">timestep</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">home_qpos</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5708</span><span class="p">,</span> <span class="mf">1.5708</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5708</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5708</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_queue</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">RobotInfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tcp_id</span> <span class="o">=</span> <span class="n">name2id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/attachment_site&quot;</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">SITE</span><span class="p">)</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_controller</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">        Perform a step in the controller.</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">        This method calls the `step()` method of the controller object and</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">        before doing so it checks if there are any tasks to be performed in</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">        the robot task queue (URRobot._task_queue)</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_queue</span><span class="p">:</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>            <span class="n">task_pose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_queue</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_ee_pose</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="n">task_pose</span><span class="p">)</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_ctrl</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>    <span class="nd">@property</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>    <span class="k">def</span> <span class="nf">controller</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseController</span><span class="p">]:</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_controller</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>    <span class="nd">@controller</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>    <span class="k">def</span> <span class="nf">controller</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_controller</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_controller</span> <span class="o">=</span> <span class="n">new_controller</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>    <span class="nd">@property</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RobotInfo</span><span class="p">:</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>    <span class="nd">@property</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjData</span><span class="p">:</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>    <span class="nd">@property</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>    <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjModel</span><span class="p">:</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>    <span class="nd">@property</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot_type</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>    <span class="nd">@property</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>    <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">        Get the type of the UR robot.</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">        Returns</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">        ----------</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">                Type of the UR robot.</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot_type</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>    <span class="nd">@property</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>    <span class="k">def</span> <span class="nf">actuator_values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">        Get the values of the actuators.</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">        Returns</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">        ----------</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">                List of actuator values.</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">actuator</span><span class="p">(</span><span class="n">an</span><span class="p">)</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">an</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">actuator_names</span><span class="p">]</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>    <span class="nd">@property</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>    <span class="k">def</span> <span class="nf">w</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">        Get the sensor wrench (force,torque) data from the force and toque sensor.</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">        Returns</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">        ----------</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">                np.ndarray: The sensor data as a NumPy array.</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sensor</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/force&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sensor</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/torque&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>        <span class="p">)</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>    <span class="k">def</span> <span class="nf">fk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">sm</span><span class="o">.</span><span class="n">SE3</span><span class="p">:</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">        Compute the forward kinematics of the UR robot given joint positions.</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">        Args</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">        ----------</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">                q (Union[list, np.ndarray]): Joint positions.</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">        Returns</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">        ----------</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">                sm.SE3: The pose of the end-effector in the base frame.</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">        Raises:</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">                ValueError: If the length of `q` does not match the number of actuators.</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">n_actuators</span><span class="p">:</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>                <span class="sa">f</span><span class="s2">&quot;Length of q should be </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">n_actuators</span><span class="si">}</span><span class="s2">, q had length </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>            <span class="p">)</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>        <span class="c1"># save the original state before performing forward kinematics</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>        <span class="n">q0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="p">[</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>            <span class="n">set_joint_q</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">jn</span><span class="p">,</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">jn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">joint_names</span><span class="p">)</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>        <span class="p">]</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>        <span class="c1"># compute forward kinematics</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>        <span class="n">mj</span><span class="o">.</span><span class="n">mj_kinematics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>        <span class="c1"># build tcp pose in base frame</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>        <span class="n">T_world_tcp</span> <span class="o">=</span> <span class="n">get_pose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcp_id</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">SITE</span><span class="p">)</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>        <span class="n">T_base_tcp</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>            <span class="n">get_pose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/base&quot;</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">BODY</span><span class="p">)</span><span class="o">.</span><span class="n">inv</span><span class="p">()</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>            <span class="o">@</span> <span class="n">T_world_tcp</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>        <span class="p">)</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="c1"># return to pre- forward kinematics state</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>        <span class="p">[</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>            <span class="n">set_joint_q</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">jn</span><span class="p">,</span> <span class="n">q0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">jn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">joint_names</span><span class="p">)</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>        <span class="p">]</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>        <span class="k">return</span> <span class="n">T_base_tcp</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>    <span class="k">def</span> <span class="nf">ik</span><span class="p">(</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>        <span class="n">T</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">SE3</span><span class="p">,</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="nb">iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="n">iter_interpolation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>        <span class="n">epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">        Compute the inverse kinematics for the given target pose.</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="sd">        This function calculates the joint angles required to achieve the specified</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a><span class="sd">        end-effector pose using inverse kinematics. It uses an analytic Jacobian</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a><span class="sd">        and residual function to iteratively solve for the joint angles that minimize</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a><span class="sd">        the difference between the current end-effector pose and the target pose.</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="sd">        Args:</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">        ----------</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="sd">        T : sm.SE3</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="sd">            The target pose for the end-effector, represented as a transformation matrix.</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="sd">        iter : int</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">            Maximum number of iterations for the solver.</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a><span class="sd">        epsilon : float</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">            Convergence threshold for the distance measure.</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">        Returns:</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">        ----------</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">        Tuple[np.ndarray, bool]</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">            The joint angles that achieve the target pose and a boolean indicating if the pose was reachable.</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="k">def</span> <span class="nf">ik_jac</span><span class="p">(</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>            <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>            <span class="n">res</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>            <span class="n">pos</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>            <span class="n">quat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>            <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.04</span><span class="p">,</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>            <span class="n">reg</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Analytic Jacobian of inverse kinematics residual</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">            Args:</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">                x: joint angles.</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">                pos: target position for the end effector.</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">                quat: target orientation for the end effector.</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">                radius: scaling of the 3D cross.</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">            Returns:</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">                The Jacobian of the Inverse Kinematics task.</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>            <span class="c1"># least_squares() passes the value of the residual at x which is sometimes</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>            <span class="c1"># useful, but we don&#39;t need it here.</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>            <span class="k">del</span> <span class="n">res</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>            <span class="n">T</span> <span class="o">=</span> <span class="n">make_tf</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">ori</span><span class="o">=</span><span class="n">quat</span><span class="p">)</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>            <span class="c1"># Call mj_kinematics and mj_comPos (required for Jacobians).</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>            <span class="n">mujoco</span><span class="o">.</span><span class="n">mj_kinematics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>            <span class="n">mujoco</span><span class="o">.</span><span class="n">mj_comPos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>            <span class="c1"># Get Deffector, the 3x3 mju_subquat Jacobian</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>            <span class="n">effector_quat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>            <span class="n">mujoco</span><span class="o">.</span><span class="n">mju_mat2Quat</span><span class="p">(</span><span class="n">effector_quat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ee_pose</span><span class="p">()</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>            <span class="n">target_quat</span> <span class="o">=</span> <span class="n">smb</span><span class="o">.</span><span class="n">r2q</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>            <span class="c1"># target_quat =  data.body(&quot;target&quot;).xquat</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>            <span class="n">Deffector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>            <span class="n">mujoco</span><span class="o">.</span><span class="n">mjd_subQuat</span><span class="p">(</span><span class="n">target_quat</span><span class="p">,</span> <span class="n">effector_quat</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Deffector</span><span class="p">)</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>            <span class="c1"># Rotate into target frame, multiply by subQuat Jacobian, scale by radius.</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>            <span class="n">target_mat</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">R</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>            <span class="n">mat</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">Deffector</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">target_mat</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>            <span class="n">Jo</span> <span class="o">=</span> <span class="n">mat</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">Jo</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>            <span class="c1"># Regularization Jacobian.</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>            <span class="n">Jr</span> <span class="o">=</span> <span class="n">reg</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">n_joints</span><span class="p">)</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Jp</span><span class="p">,</span> <span class="n">Jo</span><span class="p">,</span> <span class="n">Jr</span><span class="p">))</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>        <span class="k">def</span> <span class="nf">ik_res</span><span class="p">(</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>            <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>            <span class="n">pos</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>            <span class="n">quat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>            <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.04</span><span class="p">,</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>            <span class="n">reg</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>            <span class="n">reg_target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Residual for inverse kinematics.</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a><span class="sd">            Args:</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="sd">                x: joint angles.</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="sd">                pos: target position for the end effector.</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="sd">                quat: target orientation for the end effector.</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="sd">                radius: scaling of the 3D cross.</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="sd">            Returns:</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">                The residual of the Inverse Kinematics task.</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>            <span class="n">T</span> <span class="o">=</span> <span class="n">make_tf</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">ori</span><span class="o">=</span><span class="n">quat</span><span class="p">)</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>            <span class="c1"># Set qpos, compute forward kinematics.</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>            <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>            <span class="p">[</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>                <span class="n">set_joint_q</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">joint_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>            <span class="p">]</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>            <span class="n">mujoco</span><span class="o">.</span><span class="n">mj_kinematics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>            <span class="c1"># Position residual.</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>            <span class="c1"># res_pos = T.t - self.get_ee_pose().t</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>            <span class="n">res_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ee_pose</span><span class="p">()</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">T</span><span class="o">.</span><span class="n">t</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>            <span class="c1"># Effector quat, use mju_mat2quat.</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>            <span class="n">effector_quat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>            <span class="n">mujoco</span><span class="o">.</span><span class="n">mju_mat2Quat</span><span class="p">(</span><span class="n">effector_quat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ee_pose</span><span class="p">()</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>            <span class="c1"># mujoco.mju_mat2Quat(effector_quat, data.site(&quot;effector&quot;).xmat)</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>            <span class="c1"># Target quat, exploit the fact that the site is aligned with the body.</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>            <span class="n">target_quat</span> <span class="o">=</span> <span class="n">smb</span><span class="o">.</span><span class="n">r2q</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>            <span class="c1"># target_quat = data.body(&quot;target&quot;).xquat</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>            <span class="c1"># Orientation residual: quaternion difference.</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>            <span class="n">res_quat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>            <span class="n">mujoco</span><span class="o">.</span><span class="n">mju_subQuat</span><span class="p">(</span><span class="n">res_quat</span><span class="p">,</span> <span class="n">target_quat</span><span class="p">,</span> <span class="n">effector_quat</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>            <span class="n">res_quat</span> <span class="o">*=</span> <span class="n">radius</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>            <span class="c1"># Regularization residual.</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>            <span class="n">reg_target</span> <span class="o">=</span> <span class="n">q0_init</span> <span class="k">if</span> <span class="n">reg_target</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">reg_target</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>            <span class="n">res_reg</span> <span class="o">=</span> <span class="n">reg</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">-</span> <span class="n">reg_target</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>            <span class="n">res_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">res_pos</span><span class="p">,</span> <span class="n">res_quat</span><span class="p">,</span> <span class="n">res_reg</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">res_i</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>        <span class="k">def</span> <span class="nf">distance_measure</span><span class="p">(</span><span class="n">pos_error</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">ori_error</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Compute the distance measure for convergence.&quot;&quot;&quot;</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">pos_error</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">ori_error</span><span class="p">)</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>        <span class="c1"># Define IK problem</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>        <span class="c1"># https://colab.research.google.com/github/google-deepmind/mujoco/blob/main/python/least_squares.ipynb#scrollTo=mfhCxqQiio5l</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>        <span class="n">pos</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">t</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>        <span class="n">quat</span> <span class="o">=</span> <span class="n">smb</span><span class="o">.</span><span class="n">r2q</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>        <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">joint_limits</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>        <span class="n">q0_init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>        <span class="n">q0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>        <span class="n">converged</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>        <span class="n">q_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>        <span class="n">_T</span> <span class="o">=</span> <span class="n">ctraj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_ee_pose</span><span class="p">(),</span> <span class="n">T</span><span class="p">,</span> <span class="n">iter_interpolation</span><span class="p">)</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>        <span class="n">t0</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>        <span class="k">for</span> <span class="n">Ti</span> <span class="ow">in</span> <span class="n">_T</span><span class="p">:</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>            <span class="n">pos</span> <span class="o">=</span> <span class="n">Ti</span><span class="o">.</span><span class="n">t</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>            <span class="n">quat</span> <span class="o">=</span> <span class="n">smb</span><span class="o">.</span><span class="n">r2q</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">iter</span><span class="p">):</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>                <span class="n">ik_target</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ik_res</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">quat</span><span class="o">=</span><span class="n">quat</span><span class="p">,</span> <span class="n">reg_target</span><span class="o">=</span><span class="n">q0</span><span class="p">)</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>                <span class="n">jac_target</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">ik_jac</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">quat</span><span class="o">=</span><span class="n">quat</span><span class="p">)</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>                <span class="n">q</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">minimize</span><span class="o">.</span><span class="n">least_squares</span><span class="p">(</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>                    <span class="n">q0</span><span class="p">,</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>                    <span class="n">ik_target</span><span class="p">,</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>                    <span class="n">bounds</span><span class="p">,</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>                    <span class="n">jacobian</span><span class="o">=</span><span class="n">jac_target</span><span class="p">,</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>                    <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>                <span class="p">)</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>                <span class="p">[</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>                    <span class="n">set_joint_q</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">joint_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">qi</span><span class="p">)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">qi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>                <span class="p">]</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>                <span class="n">mj</span><span class="o">.</span><span class="n">mj_kinematics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>                <span class="n">pos_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ee_pose</span><span class="p">()</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">pos</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>                <span class="n">effector_quat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>                <span class="n">mujoco</span><span class="o">.</span><span class="n">mju_mat2Quat</span><span class="p">(</span><span class="n">effector_quat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ee_pose</span><span class="p">()</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>                <span class="n">res_quat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>                <span class="n">mujoco</span><span class="o">.</span><span class="n">mju_subQuat</span><span class="p">(</span><span class="n">res_quat</span><span class="p">,</span> <span class="n">quat</span><span class="p">,</span> <span class="n">effector_quat</span><span class="p">)</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>                <span class="n">res_quat</span> <span class="o">*=</span> <span class="n">radius</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>                <span class="n">distance</span> <span class="o">=</span> <span class="n">distance_measure</span><span class="p">(</span><span class="n">pos_error</span><span class="p">,</span> <span class="n">res_quat</span><span class="p">)</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>                <span class="n">q_error</span> <span class="o">=</span> <span class="n">q</span> <span class="o">-</span> <span class="n">q0</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>                <span class="c1"># eval steps and epsilon</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>                <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">epsilon</span><span class="p">:</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>                    <span class="n">converged</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>                    <span class="k">break</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>                <span class="n">q0</span> <span class="o">=</span> <span class="n">q</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>        <span class="c1"># reset to current q</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>        <span class="p">[</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>            <span class="n">set_joint_q</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">joint_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">q0_init</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">q0_init</span><span class="p">))</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>        <span class="p">]</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="n">time</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>        <span class="n">t_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fk</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">pos</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>        <span class="k">return</span> <span class="n">q</span><span class="p">,</span> <span class="n">converged</span><span class="p">,</span> <span class="n">q_error</span><span class="p">,</span> <span class="n">t_error</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">time</span><span class="p">}</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>    <span class="k">def</span> <span class="nf">get_ee_pose</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sm</span><span class="o">.</span><span class="n">SE3</span><span class="p">:</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a><span class="sd">        Get the end-effector pose for the UR robot.</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">        Returns</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="sd">        ----------</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">                T (sm.SE3): The end-effector pose in the base frame.</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>    <span class="k">def</span> <span class="nf">set_ee_pose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">SE3</span><span class="p">):</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">        Set the desired end-effector pose for the UR robot.</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">        Args</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">        ----------</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">                T (sm.SE3): The desired end-effector pose in the base frame.</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">T_target</span> <span class="o">=</span> <span class="n">T</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>    <span class="k">def</span> <span class="nf">move_l</span><span class="p">(</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>        <span class="n">T</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">SE3</span><span class="p">,</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        <span class="n">ss</span><span class="p">:</span> <span class="n">SimSync</span><span class="p">,</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>        <span class="n">velocity</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>        <span class="n">acceleration</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.2</span><span class="p">,</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>    <span class="p">):</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="sd">        Move to a given position in task-space (or cartesian space)</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a><span class="sd">        The robot guides the TCP at a defined velocity along a straight path to the end point defined by T.</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="sd">        Args:</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">                T (sm.SE3): The desired end-effector pose in the base frame.</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">                velocity (Union[list, np.ndarray]): tool velocity [m/s]</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">                acceleration (Union[list, np.ndarray]): tool acceleration [m/s^2]</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a><span class="sd">        Returns:</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a><span class="sd">                success (bool): True if the move succeeds and False otherwise.</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="s2">                            You attempted to send a command to the robot without a controller, set a controller </span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a><span class="s2">                            ur5e.controller = DiffIk(ur5e)</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a><span class="s2">                            or</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a><span class="s2">                            ur5e.controller = OpSpace(ur5e)</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a><span class="s2">                            &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>        <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>        <span class="c1"># get the tcp pose in base frame</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>        <span class="n">T_base_tcp</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">SE3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>        <span class="n">T0</span> <span class="o">=</span> <span class="n">T_base_tcp</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>        <span class="n">T1</span> <span class="o">=</span> <span class="n">T</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="c1"># check if current and target is identical within some tolerance and abort if so.</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>        <span class="k">if</span> <span class="n">T0</span> <span class="o">==</span> <span class="n">T1</span><span class="p">:</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>            <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>            <span class="k">return</span> <span class="n">success</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>        <span class="c1"># calculate trajectory duration based on provided velocity and difference of SE(3) matrices as differential motion.</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>        <span class="n">delta</span> <span class="o">=</span> <span class="n">T0</span><span class="o">.</span><span class="n">delta</span><span class="p">(</span><span class="n">T1</span><span class="p">)</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>        <span class="n">duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">/</span> <span class="n">velocity</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>                <span class="s2">&quot;&gt; performing move_l:</span><span class="se">\n</span><span class="s2">  from:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">T0</span><span class="p">)</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  to:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">T1</span><span class="p">)</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  duration:</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">duration</span><span class="p">))</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>                <span class="o">+</span> <span class="s2">&quot; s&quot;</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>            <span class="p">)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>        <span class="n">trajectory_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">))</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>        <span class="n">t_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">trajectory_samples</span><span class="p">)</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>        <span class="n">c_traj</span> <span class="o">=</span> <span class="n">ctraj</span><span class="p">(</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">t_array</span><span class="p">)</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>        <span class="c1"># Add task poses to the task queue</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>        <span class="k">for</span> <span class="n">task_pose</span> <span class="ow">in</span> <span class="n">c_traj</span><span class="p">:</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">T_target</span> <span class="o">=</span> <span class="n">task_pose</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_ctrl</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>            <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>        <span class="k">return</span> <span class="n">success</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>    <span class="k">def</span> <span class="nf">move_j</span><span class="p">(</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>        <span class="n">q</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>        <span class="n">ss</span><span class="p">:</span> <span class="n">SimSync</span><span class="p">,</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>        <span class="n">velocity</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.05</span><span class="p">,</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>        <span class="n">acceleration</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.4</span><span class="p">,</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>    <span class="p">):</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a><span class="sd">        Move to a given joint position in joint-space.</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a><span class="sd">        The robot moves the joints to achieve the fastest path to the end point. The fastest</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a><span class="sd">        path is generally not the shortest path and is thus not a straight line. As the</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a><span class="sd">        motions of the robot axes are rotational, curved paths can be executed faster than</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="sd">        straight paths. The exact path of the motion cannot be predicted.</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a><span class="sd">        Args:</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a><span class="sd">                q (Union[list, np.ndarray]): q specifies joint positions of the robot axes [radians].</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">                velocity (Union[list, np.ndarray]): joint velocity [rad/s]</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a><span class="sd">                acceleration (Union[list, np.ndarray]): joint acceleration [rad/s^2]</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a><span class="sd">        Returns:</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a><span class="sd">                success (bool): True if the move succeeds and False otherwise.</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a><span class="s2">                            You attempted to send a command to the robot without a controller, set a controller </span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a><span class="s2">                            ur5e.controller = DiffIk(ur5e)</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a><span class="s2">                            or</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a><span class="s2">                            ur5e.controller = OpSpace(ur5e)</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a><span class="s2">                            &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>        <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>        <span class="n">current_q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>        <span class="n">target_q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>        <span class="c1"># check if current and target is identical within some tolerance and abort if so.</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">current_q</span><span class="p">,</span> <span class="n">target_q</span><span class="p">):</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>            <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>            <span class="k">return</span> <span class="n">success</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>        <span class="c1"># calculate trajectory duration based on provided velocity and leading axis movement.</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>        <span class="n">max_dist</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>            <span class="n">max_dist</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_dist</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">current_q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">target_q</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>        <span class="n">duration</span> <span class="o">=</span> <span class="n">max_dist</span> <span class="o">/</span> <span class="n">velocity</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>                <span class="s2">&quot;&gt; performing move_j:</span><span class="se">\n\t</span><span class="s2">from</span><span class="se">\t\t</span><span class="s2">:</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_q</span><span class="p">)</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">to</span><span class="se">\t\t</span><span class="s2">:</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">target_q</span><span class="p">)</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">duration</span><span class="se">\t</span><span class="s2">:</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">duration</span><span class="p">))</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>                <span class="o">+</span> <span class="s2">&quot; s&quot;</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>            <span class="p">)</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>        <span class="n">trajectory_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">))</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>        <span class="n">t_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">trajectory_samples</span><span class="p">)</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>        <span class="n">j_traj</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span><span class="n">current_q</span><span class="p">,</span> <span class="n">target_q</span><span class="p">,</span> <span class="n">t_array</span><span class="p">)</span><span class="o">.</span><span class="n">q</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>        <span class="k">for</span> <span class="n">joint_q</span> <span class="ow">in</span> <span class="n">j_traj</span><span class="p">:</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>            <span class="n">task_pose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fk</span><span class="p">(</span><span class="n">joint_q</span><span class="p">)</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">T_target</span> <span class="o">=</span> <span class="n">task_pose</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>            <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>        <span class="k">return</span> <span class="n">success</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>    <span class="k">def</span> <span class="nf">move_traj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">sm</span><span class="o">.</span><span class="n">SE3</span><span class="p">,</span> <span class="n">List</span><span class="p">],</span> <span class="n">ss</span><span class="p">:</span> <span class="n">SimSync</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a><span class="sd">        Move the robot along a given trajectory.</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a><span class="sd">        This function enqueues a series of task poses for the robot to follow sequentially.</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a><span class="sd">        Args</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a><span class="sd">        ----------</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a><span class="sd">                T (Union[sm.SE3, List]): List of desired end-effector poses in the base frame.</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>        <span class="c1"># add task poses to the robot task queue</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>        <span class="k">for</span> <span class="n">task_pose</span> <span class="ow">in</span> <span class="n">T</span><span class="p">:</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">T_target</span> <span class="o">=</span> <span class="n">task_pose</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_ctrl</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>            <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="URRobot">
                            <input id="URRobot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">URRobot</span><wbr>(<span class="base"><a href="base_robot.html#BaseRobot">robots.base_robot.BaseRobot</a></span>):

                <label class="view-source-button" for="URRobot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#URRobot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="URRobot-29"><a href="#URRobot-29"><span class="linenos"> 29</span></a><span class="k">class</span> <span class="nc">URRobot</span><span class="p">(</span><span class="n">BaseRobot</span><span class="p">):</span>
</span><span id="URRobot-30"><a href="#URRobot-30"><span class="linenos"> 30</span></a>    <span class="k">class</span> <span class="nc">Type</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="URRobot-31"><a href="#URRobot-31"><span class="linenos"> 31</span></a>        <span class="n">UR3e</span> <span class="o">=</span> <span class="s2">&quot;ur3e&quot;</span>
</span><span id="URRobot-32"><a href="#URRobot-32"><span class="linenos"> 32</span></a>        <span class="n">UR5e</span> <span class="o">=</span> <span class="s2">&quot;ur5e&quot;</span>
</span><span id="URRobot-33"><a href="#URRobot-33"><span class="linenos"> 33</span></a>        <span class="n">UR10e</span> <span class="o">=</span> <span class="s2">&quot;ur10e&quot;</span>
</span><span id="URRobot-34"><a href="#URRobot-34"><span class="linenos"> 34</span></a>
</span><span id="URRobot-35"><a href="#URRobot-35"><span class="linenos"> 35</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="URRobot-36"><a href="#URRobot-36"><span class="linenos"> 36</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="URRobot-37"><a href="#URRobot-37"><span class="linenos"> 37</span></a>        <span class="n">model</span><span class="p">:</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjModel</span><span class="p">,</span>
</span><span id="URRobot-38"><a href="#URRobot-38"><span class="linenos"> 38</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjData</span><span class="p">,</span>
</span><span id="URRobot-39"><a href="#URRobot-39"><span class="linenos"> 39</span></a>        <span class="n">robot_type</span><span class="p">:</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">Type</span><span class="o">.</span><span class="n">UR5e</span><span class="p">,</span>
</span><span id="URRobot-40"><a href="#URRobot-40"><span class="linenos"> 40</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="URRobot-41"><a href="#URRobot-41"><span class="linenos"> 41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="URRobot-42"><a href="#URRobot-42"><span class="linenos"> 42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="URRobot-43"><a href="#URRobot-43"><span class="linenos"> 43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_robot_type</span> <span class="o">=</span> <span class="n">robot_type</span><span class="o">.</span><span class="n">value</span>
</span><span id="URRobot-44"><a href="#URRobot-44"><span class="linenos"> 44</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">timestep</span>
</span><span id="URRobot-45"><a href="#URRobot-45"><span class="linenos"> 45</span></a>
</span><span id="URRobot-46"><a href="#URRobot-46"><span class="linenos"> 46</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">home_qpos</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5708</span><span class="p">,</span> <span class="mf">1.5708</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5708</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5708</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="URRobot-47"><a href="#URRobot-47"><span class="linenos"> 47</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_queue</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
</span><span id="URRobot-48"><a href="#URRobot-48"><span class="linenos"> 48</span></a>
</span><span id="URRobot-49"><a href="#URRobot-49"><span class="linenos"> 49</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">RobotInfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="URRobot-50"><a href="#URRobot-50"><span class="linenos"> 50</span></a>
</span><span id="URRobot-51"><a href="#URRobot-51"><span class="linenos"> 51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tcp_id</span> <span class="o">=</span> <span class="n">name2id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/attachment_site&quot;</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">SITE</span><span class="p">)</span>
</span><span id="URRobot-52"><a href="#URRobot-52"><span class="linenos"> 52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_controller</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="URRobot-53"><a href="#URRobot-53"><span class="linenos"> 53</span></a>
</span><span id="URRobot-54"><a href="#URRobot-54"><span class="linenos"> 54</span></a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="URRobot-55"><a href="#URRobot-55"><span class="linenos"> 55</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="URRobot-56"><a href="#URRobot-56"><span class="linenos"> 56</span></a><span class="sd">        Perform a step in the controller.</span>
</span><span id="URRobot-57"><a href="#URRobot-57"><span class="linenos"> 57</span></a>
</span><span id="URRobot-58"><a href="#URRobot-58"><span class="linenos"> 58</span></a><span class="sd">        This method calls the `step()` method of the controller object and</span>
</span><span id="URRobot-59"><a href="#URRobot-59"><span class="linenos"> 59</span></a><span class="sd">        before doing so it checks if there are any tasks to be performed in</span>
</span><span id="URRobot-60"><a href="#URRobot-60"><span class="linenos"> 60</span></a><span class="sd">        the robot task queue (URRobot._task_queue)</span>
</span><span id="URRobot-61"><a href="#URRobot-61"><span class="linenos"> 61</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URRobot-62"><a href="#URRobot-62"><span class="linenos"> 62</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_queue</span><span class="p">:</span>
</span><span id="URRobot-63"><a href="#URRobot-63"><span class="linenos"> 63</span></a>            <span class="n">task_pose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_queue</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
</span><span id="URRobot-64"><a href="#URRobot-64"><span class="linenos"> 64</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_ee_pose</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="n">task_pose</span><span class="p">)</span>
</span><span id="URRobot-65"><a href="#URRobot-65"><span class="linenos"> 65</span></a>
</span><span id="URRobot-66"><a href="#URRobot-66"><span class="linenos"> 66</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="URRobot-67"><a href="#URRobot-67"><span class="linenos"> 67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_ctrl</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="URRobot-68"><a href="#URRobot-68"><span class="linenos"> 68</span></a>
</span><span id="URRobot-69"><a href="#URRobot-69"><span class="linenos"> 69</span></a>    <span class="nd">@property</span>
</span><span id="URRobot-70"><a href="#URRobot-70"><span class="linenos"> 70</span></a>    <span class="k">def</span> <span class="nf">controller</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseController</span><span class="p">]:</span>
</span><span id="URRobot-71"><a href="#URRobot-71"><span class="linenos"> 71</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_controller</span>
</span><span id="URRobot-72"><a href="#URRobot-72"><span class="linenos"> 72</span></a>
</span><span id="URRobot-73"><a href="#URRobot-73"><span class="linenos"> 73</span></a>    <span class="nd">@controller</span><span class="o">.</span><span class="n">setter</span>
</span><span id="URRobot-74"><a href="#URRobot-74"><span class="linenos"> 74</span></a>    <span class="k">def</span> <span class="nf">controller</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_controller</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="URRobot-75"><a href="#URRobot-75"><span class="linenos"> 75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_controller</span> <span class="o">=</span> <span class="n">new_controller</span>
</span><span id="URRobot-76"><a href="#URRobot-76"><span class="linenos"> 76</span></a>
</span><span id="URRobot-77"><a href="#URRobot-77"><span class="linenos"> 77</span></a>    <span class="nd">@property</span>
</span><span id="URRobot-78"><a href="#URRobot-78"><span class="linenos"> 78</span></a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RobotInfo</span><span class="p">:</span>
</span><span id="URRobot-79"><a href="#URRobot-79"><span class="linenos"> 79</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span>
</span><span id="URRobot-80"><a href="#URRobot-80"><span class="linenos"> 80</span></a>
</span><span id="URRobot-81"><a href="#URRobot-81"><span class="linenos"> 81</span></a>    <span class="nd">@property</span>
</span><span id="URRobot-82"><a href="#URRobot-82"><span class="linenos"> 82</span></a>    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjData</span><span class="p">:</span>
</span><span id="URRobot-83"><a href="#URRobot-83"><span class="linenos"> 83</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</span><span id="URRobot-84"><a href="#URRobot-84"><span class="linenos"> 84</span></a>
</span><span id="URRobot-85"><a href="#URRobot-85"><span class="linenos"> 85</span></a>    <span class="nd">@property</span>
</span><span id="URRobot-86"><a href="#URRobot-86"><span class="linenos"> 86</span></a>    <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjModel</span><span class="p">:</span>
</span><span id="URRobot-87"><a href="#URRobot-87"><span class="linenos"> 87</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span>
</span><span id="URRobot-88"><a href="#URRobot-88"><span class="linenos"> 88</span></a>
</span><span id="URRobot-89"><a href="#URRobot-89"><span class="linenos"> 89</span></a>    <span class="nd">@property</span>
</span><span id="URRobot-90"><a href="#URRobot-90"><span class="linenos"> 90</span></a>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="URRobot-91"><a href="#URRobot-91"><span class="linenos"> 91</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot_type</span>
</span><span id="URRobot-92"><a href="#URRobot-92"><span class="linenos"> 92</span></a>
</span><span id="URRobot-93"><a href="#URRobot-93"><span class="linenos"> 93</span></a>    <span class="nd">@property</span>
</span><span id="URRobot-94"><a href="#URRobot-94"><span class="linenos"> 94</span></a>    <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="URRobot-95"><a href="#URRobot-95"><span class="linenos"> 95</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="URRobot-96"><a href="#URRobot-96"><span class="linenos"> 96</span></a><span class="sd">        Get the type of the UR robot.</span>
</span><span id="URRobot-97"><a href="#URRobot-97"><span class="linenos"> 97</span></a>
</span><span id="URRobot-98"><a href="#URRobot-98"><span class="linenos"> 98</span></a><span class="sd">        Returns</span>
</span><span id="URRobot-99"><a href="#URRobot-99"><span class="linenos"> 99</span></a><span class="sd">        ----------</span>
</span><span id="URRobot-100"><a href="#URRobot-100"><span class="linenos">100</span></a><span class="sd">                Type of the UR robot.</span>
</span><span id="URRobot-101"><a href="#URRobot-101"><span class="linenos">101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URRobot-102"><a href="#URRobot-102"><span class="linenos">102</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot_type</span>
</span><span id="URRobot-103"><a href="#URRobot-103"><span class="linenos">103</span></a>
</span><span id="URRobot-104"><a href="#URRobot-104"><span class="linenos">104</span></a>    <span class="nd">@property</span>
</span><span id="URRobot-105"><a href="#URRobot-105"><span class="linenos">105</span></a>    <span class="k">def</span> <span class="nf">actuator_values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="URRobot-106"><a href="#URRobot-106"><span class="linenos">106</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="URRobot-107"><a href="#URRobot-107"><span class="linenos">107</span></a><span class="sd">        Get the values of the actuators.</span>
</span><span id="URRobot-108"><a href="#URRobot-108"><span class="linenos">108</span></a>
</span><span id="URRobot-109"><a href="#URRobot-109"><span class="linenos">109</span></a><span class="sd">        Returns</span>
</span><span id="URRobot-110"><a href="#URRobot-110"><span class="linenos">110</span></a><span class="sd">        ----------</span>
</span><span id="URRobot-111"><a href="#URRobot-111"><span class="linenos">111</span></a><span class="sd">                List of actuator values.</span>
</span><span id="URRobot-112"><a href="#URRobot-112"><span class="linenos">112</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URRobot-113"><a href="#URRobot-113"><span class="linenos">113</span></a>        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">actuator</span><span class="p">(</span><span class="n">an</span><span class="p">)</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">an</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">actuator_names</span><span class="p">]</span>
</span><span id="URRobot-114"><a href="#URRobot-114"><span class="linenos">114</span></a>
</span><span id="URRobot-115"><a href="#URRobot-115"><span class="linenos">115</span></a>    <span class="nd">@property</span>
</span><span id="URRobot-116"><a href="#URRobot-116"><span class="linenos">116</span></a>    <span class="k">def</span> <span class="nf">w</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="URRobot-117"><a href="#URRobot-117"><span class="linenos">117</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="URRobot-118"><a href="#URRobot-118"><span class="linenos">118</span></a><span class="sd">        Get the sensor wrench (force,torque) data from the force and toque sensor.</span>
</span><span id="URRobot-119"><a href="#URRobot-119"><span class="linenos">119</span></a>
</span><span id="URRobot-120"><a href="#URRobot-120"><span class="linenos">120</span></a><span class="sd">        Returns</span>
</span><span id="URRobot-121"><a href="#URRobot-121"><span class="linenos">121</span></a><span class="sd">        ----------</span>
</span><span id="URRobot-122"><a href="#URRobot-122"><span class="linenos">122</span></a><span class="sd">                np.ndarray: The sensor data as a NumPy array.</span>
</span><span id="URRobot-123"><a href="#URRobot-123"><span class="linenos">123</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URRobot-124"><a href="#URRobot-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="URRobot-125"><a href="#URRobot-125"><span class="linenos">125</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sensor</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/force&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="URRobot-126"><a href="#URRobot-126"><span class="linenos">126</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sensor</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/torque&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="URRobot-127"><a href="#URRobot-127"><span class="linenos">127</span></a>        <span class="p">)</span>
</span><span id="URRobot-128"><a href="#URRobot-128"><span class="linenos">128</span></a>
</span><span id="URRobot-129"><a href="#URRobot-129"><span class="linenos">129</span></a>    <span class="k">def</span> <span class="nf">fk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">sm</span><span class="o">.</span><span class="n">SE3</span><span class="p">:</span>
</span><span id="URRobot-130"><a href="#URRobot-130"><span class="linenos">130</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="URRobot-131"><a href="#URRobot-131"><span class="linenos">131</span></a><span class="sd">        Compute the forward kinematics of the UR robot given joint positions.</span>
</span><span id="URRobot-132"><a href="#URRobot-132"><span class="linenos">132</span></a>
</span><span id="URRobot-133"><a href="#URRobot-133"><span class="linenos">133</span></a><span class="sd">        Args</span>
</span><span id="URRobot-134"><a href="#URRobot-134"><span class="linenos">134</span></a><span class="sd">        ----------</span>
</span><span id="URRobot-135"><a href="#URRobot-135"><span class="linenos">135</span></a><span class="sd">                q (Union[list, np.ndarray]): Joint positions.</span>
</span><span id="URRobot-136"><a href="#URRobot-136"><span class="linenos">136</span></a>
</span><span id="URRobot-137"><a href="#URRobot-137"><span class="linenos">137</span></a><span class="sd">        Returns</span>
</span><span id="URRobot-138"><a href="#URRobot-138"><span class="linenos">138</span></a><span class="sd">        ----------</span>
</span><span id="URRobot-139"><a href="#URRobot-139"><span class="linenos">139</span></a><span class="sd">                sm.SE3: The pose of the end-effector in the base frame.</span>
</span><span id="URRobot-140"><a href="#URRobot-140"><span class="linenos">140</span></a>
</span><span id="URRobot-141"><a href="#URRobot-141"><span class="linenos">141</span></a><span class="sd">        Raises:</span>
</span><span id="URRobot-142"><a href="#URRobot-142"><span class="linenos">142</span></a><span class="sd">                ValueError: If the length of `q` does not match the number of actuators.</span>
</span><span id="URRobot-143"><a href="#URRobot-143"><span class="linenos">143</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URRobot-144"><a href="#URRobot-144"><span class="linenos">144</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">n_actuators</span><span class="p">:</span>
</span><span id="URRobot-145"><a href="#URRobot-145"><span class="linenos">145</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="URRobot-146"><a href="#URRobot-146"><span class="linenos">146</span></a>                <span class="sa">f</span><span class="s2">&quot;Length of q should be </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">n_actuators</span><span class="si">}</span><span class="s2">, q had length </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="URRobot-147"><a href="#URRobot-147"><span class="linenos">147</span></a>            <span class="p">)</span>
</span><span id="URRobot-148"><a href="#URRobot-148"><span class="linenos">148</span></a>
</span><span id="URRobot-149"><a href="#URRobot-149"><span class="linenos">149</span></a>        <span class="c1"># save the original state before performing forward kinematics</span>
</span><span id="URRobot-150"><a href="#URRobot-150"><span class="linenos">150</span></a>        <span class="n">q0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span>
</span><span id="URRobot-151"><a href="#URRobot-151"><span class="linenos">151</span></a>        <span class="p">[</span>
</span><span id="URRobot-152"><a href="#URRobot-152"><span class="linenos">152</span></a>            <span class="n">set_joint_q</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">jn</span><span class="p">,</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="URRobot-153"><a href="#URRobot-153"><span class="linenos">153</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">jn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">joint_names</span><span class="p">)</span>
</span><span id="URRobot-154"><a href="#URRobot-154"><span class="linenos">154</span></a>        <span class="p">]</span>
</span><span id="URRobot-155"><a href="#URRobot-155"><span class="linenos">155</span></a>
</span><span id="URRobot-156"><a href="#URRobot-156"><span class="linenos">156</span></a>        <span class="c1"># compute forward kinematics</span>
</span><span id="URRobot-157"><a href="#URRobot-157"><span class="linenos">157</span></a>        <span class="n">mj</span><span class="o">.</span><span class="n">mj_kinematics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="URRobot-158"><a href="#URRobot-158"><span class="linenos">158</span></a>
</span><span id="URRobot-159"><a href="#URRobot-159"><span class="linenos">159</span></a>        <span class="c1"># build tcp pose in base frame</span>
</span><span id="URRobot-160"><a href="#URRobot-160"><span class="linenos">160</span></a>        <span class="n">T_world_tcp</span> <span class="o">=</span> <span class="n">get_pose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcp_id</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">SITE</span><span class="p">)</span>
</span><span id="URRobot-161"><a href="#URRobot-161"><span class="linenos">161</span></a>
</span><span id="URRobot-162"><a href="#URRobot-162"><span class="linenos">162</span></a>        <span class="n">T_base_tcp</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="URRobot-163"><a href="#URRobot-163"><span class="linenos">163</span></a>            <span class="n">get_pose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/base&quot;</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">BODY</span><span class="p">)</span><span class="o">.</span><span class="n">inv</span><span class="p">()</span>
</span><span id="URRobot-164"><a href="#URRobot-164"><span class="linenos">164</span></a>            <span class="o">@</span> <span class="n">T_world_tcp</span>
</span><span id="URRobot-165"><a href="#URRobot-165"><span class="linenos">165</span></a>        <span class="p">)</span>
</span><span id="URRobot-166"><a href="#URRobot-166"><span class="linenos">166</span></a>
</span><span id="URRobot-167"><a href="#URRobot-167"><span class="linenos">167</span></a>        <span class="c1"># return to pre- forward kinematics state</span>
</span><span id="URRobot-168"><a href="#URRobot-168"><span class="linenos">168</span></a>        <span class="p">[</span>
</span><span id="URRobot-169"><a href="#URRobot-169"><span class="linenos">169</span></a>            <span class="n">set_joint_q</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">jn</span><span class="p">,</span> <span class="n">q0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="URRobot-170"><a href="#URRobot-170"><span class="linenos">170</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">jn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">joint_names</span><span class="p">)</span>
</span><span id="URRobot-171"><a href="#URRobot-171"><span class="linenos">171</span></a>        <span class="p">]</span>
</span><span id="URRobot-172"><a href="#URRobot-172"><span class="linenos">172</span></a>
</span><span id="URRobot-173"><a href="#URRobot-173"><span class="linenos">173</span></a>        <span class="k">return</span> <span class="n">T_base_tcp</span>
</span><span id="URRobot-174"><a href="#URRobot-174"><span class="linenos">174</span></a>
</span><span id="URRobot-175"><a href="#URRobot-175"><span class="linenos">175</span></a>    <span class="k">def</span> <span class="nf">ik</span><span class="p">(</span>
</span><span id="URRobot-176"><a href="#URRobot-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="URRobot-177"><a href="#URRobot-177"><span class="linenos">177</span></a>        <span class="n">T</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">SE3</span><span class="p">,</span>
</span><span id="URRobot-178"><a href="#URRobot-178"><span class="linenos">178</span></a>        <span class="nb">iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="URRobot-179"><a href="#URRobot-179"><span class="linenos">179</span></a>        <span class="n">iter_interpolation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="URRobot-180"><a href="#URRobot-180"><span class="linenos">180</span></a>        <span class="n">epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
</span><span id="URRobot-181"><a href="#URRobot-181"><span class="linenos">181</span></a>        <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>
</span><span id="URRobot-182"><a href="#URRobot-182"><span class="linenos">182</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
</span><span id="URRobot-183"><a href="#URRobot-183"><span class="linenos">183</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="URRobot-184"><a href="#URRobot-184"><span class="linenos">184</span></a><span class="sd">        Compute the inverse kinematics for the given target pose.</span>
</span><span id="URRobot-185"><a href="#URRobot-185"><span class="linenos">185</span></a>
</span><span id="URRobot-186"><a href="#URRobot-186"><span class="linenos">186</span></a><span class="sd">        This function calculates the joint angles required to achieve the specified</span>
</span><span id="URRobot-187"><a href="#URRobot-187"><span class="linenos">187</span></a><span class="sd">        end-effector pose using inverse kinematics. It uses an analytic Jacobian</span>
</span><span id="URRobot-188"><a href="#URRobot-188"><span class="linenos">188</span></a><span class="sd">        and residual function to iteratively solve for the joint angles that minimize</span>
</span><span id="URRobot-189"><a href="#URRobot-189"><span class="linenos">189</span></a><span class="sd">        the difference between the current end-effector pose and the target pose.</span>
</span><span id="URRobot-190"><a href="#URRobot-190"><span class="linenos">190</span></a>
</span><span id="URRobot-191"><a href="#URRobot-191"><span class="linenos">191</span></a><span class="sd">        Args:</span>
</span><span id="URRobot-192"><a href="#URRobot-192"><span class="linenos">192</span></a><span class="sd">        ----------</span>
</span><span id="URRobot-193"><a href="#URRobot-193"><span class="linenos">193</span></a><span class="sd">        T : sm.SE3</span>
</span><span id="URRobot-194"><a href="#URRobot-194"><span class="linenos">194</span></a><span class="sd">            The target pose for the end-effector, represented as a transformation matrix.</span>
</span><span id="URRobot-195"><a href="#URRobot-195"><span class="linenos">195</span></a><span class="sd">        iter : int</span>
</span><span id="URRobot-196"><a href="#URRobot-196"><span class="linenos">196</span></a><span class="sd">            Maximum number of iterations for the solver.</span>
</span><span id="URRobot-197"><a href="#URRobot-197"><span class="linenos">197</span></a><span class="sd">        epsilon : float</span>
</span><span id="URRobot-198"><a href="#URRobot-198"><span class="linenos">198</span></a><span class="sd">            Convergence threshold for the distance measure.</span>
</span><span id="URRobot-199"><a href="#URRobot-199"><span class="linenos">199</span></a>
</span><span id="URRobot-200"><a href="#URRobot-200"><span class="linenos">200</span></a><span class="sd">        Returns:</span>
</span><span id="URRobot-201"><a href="#URRobot-201"><span class="linenos">201</span></a><span class="sd">        ----------</span>
</span><span id="URRobot-202"><a href="#URRobot-202"><span class="linenos">202</span></a><span class="sd">        Tuple[np.ndarray, bool]</span>
</span><span id="URRobot-203"><a href="#URRobot-203"><span class="linenos">203</span></a><span class="sd">            The joint angles that achieve the target pose and a boolean indicating if the pose was reachable.</span>
</span><span id="URRobot-204"><a href="#URRobot-204"><span class="linenos">204</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URRobot-205"><a href="#URRobot-205"><span class="linenos">205</span></a>
</span><span id="URRobot-206"><a href="#URRobot-206"><span class="linenos">206</span></a>        <span class="k">def</span> <span class="nf">ik_jac</span><span class="p">(</span>
</span><span id="URRobot-207"><a href="#URRobot-207"><span class="linenos">207</span></a>            <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="URRobot-208"><a href="#URRobot-208"><span class="linenos">208</span></a>            <span class="n">res</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="URRobot-209"><a href="#URRobot-209"><span class="linenos">209</span></a>            <span class="n">pos</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="URRobot-210"><a href="#URRobot-210"><span class="linenos">210</span></a>            <span class="n">quat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="URRobot-211"><a href="#URRobot-211"><span class="linenos">211</span></a>            <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.04</span><span class="p">,</span>
</span><span id="URRobot-212"><a href="#URRobot-212"><span class="linenos">212</span></a>            <span class="n">reg</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
</span><span id="URRobot-213"><a href="#URRobot-213"><span class="linenos">213</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="URRobot-214"><a href="#URRobot-214"><span class="linenos">214</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Analytic Jacobian of inverse kinematics residual</span>
</span><span id="URRobot-215"><a href="#URRobot-215"><span class="linenos">215</span></a>
</span><span id="URRobot-216"><a href="#URRobot-216"><span class="linenos">216</span></a><span class="sd">            Args:</span>
</span><span id="URRobot-217"><a href="#URRobot-217"><span class="linenos">217</span></a><span class="sd">                x: joint angles.</span>
</span><span id="URRobot-218"><a href="#URRobot-218"><span class="linenos">218</span></a><span class="sd">                pos: target position for the end effector.</span>
</span><span id="URRobot-219"><a href="#URRobot-219"><span class="linenos">219</span></a><span class="sd">                quat: target orientation for the end effector.</span>
</span><span id="URRobot-220"><a href="#URRobot-220"><span class="linenos">220</span></a><span class="sd">                radius: scaling of the 3D cross.</span>
</span><span id="URRobot-221"><a href="#URRobot-221"><span class="linenos">221</span></a>
</span><span id="URRobot-222"><a href="#URRobot-222"><span class="linenos">222</span></a><span class="sd">            Returns:</span>
</span><span id="URRobot-223"><a href="#URRobot-223"><span class="linenos">223</span></a><span class="sd">                The Jacobian of the Inverse Kinematics task.</span>
</span><span id="URRobot-224"><a href="#URRobot-224"><span class="linenos">224</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="URRobot-225"><a href="#URRobot-225"><span class="linenos">225</span></a>            <span class="c1"># least_squares() passes the value of the residual at x which is sometimes</span>
</span><span id="URRobot-226"><a href="#URRobot-226"><span class="linenos">226</span></a>            <span class="c1"># useful, but we don&#39;t need it here.</span>
</span><span id="URRobot-227"><a href="#URRobot-227"><span class="linenos">227</span></a>            <span class="k">del</span> <span class="n">res</span>
</span><span id="URRobot-228"><a href="#URRobot-228"><span class="linenos">228</span></a>
</span><span id="URRobot-229"><a href="#URRobot-229"><span class="linenos">229</span></a>            <span class="n">T</span> <span class="o">=</span> <span class="n">make_tf</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">ori</span><span class="o">=</span><span class="n">quat</span><span class="p">)</span>
</span><span id="URRobot-230"><a href="#URRobot-230"><span class="linenos">230</span></a>
</span><span id="URRobot-231"><a href="#URRobot-231"><span class="linenos">231</span></a>            <span class="c1"># Call mj_kinematics and mj_comPos (required for Jacobians).</span>
</span><span id="URRobot-232"><a href="#URRobot-232"><span class="linenos">232</span></a>            <span class="n">mujoco</span><span class="o">.</span><span class="n">mj_kinematics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="URRobot-233"><a href="#URRobot-233"><span class="linenos">233</span></a>            <span class="n">mujoco</span><span class="o">.</span><span class="n">mj_comPos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="URRobot-234"><a href="#URRobot-234"><span class="linenos">234</span></a>
</span><span id="URRobot-235"><a href="#URRobot-235"><span class="linenos">235</span></a>            <span class="c1"># Get Deffector, the 3x3 mju_subquat Jacobian</span>
</span><span id="URRobot-236"><a href="#URRobot-236"><span class="linenos">236</span></a>            <span class="n">effector_quat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span id="URRobot-237"><a href="#URRobot-237"><span class="linenos">237</span></a>
</span><span id="URRobot-238"><a href="#URRobot-238"><span class="linenos">238</span></a>            <span class="n">mujoco</span><span class="o">.</span><span class="n">mju_mat2Quat</span><span class="p">(</span><span class="n">effector_quat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ee_pose</span><span class="p">()</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="URRobot-239"><a href="#URRobot-239"><span class="linenos">239</span></a>            <span class="n">target_quat</span> <span class="o">=</span> <span class="n">smb</span><span class="o">.</span><span class="n">r2q</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
</span><span id="URRobot-240"><a href="#URRobot-240"><span class="linenos">240</span></a>            <span class="c1"># target_quat =  data.body(&quot;target&quot;).xquat</span>
</span><span id="URRobot-241"><a href="#URRobot-241"><span class="linenos">241</span></a>            <span class="n">Deffector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="URRobot-242"><a href="#URRobot-242"><span class="linenos">242</span></a>            <span class="n">mujoco</span><span class="o">.</span><span class="n">mjd_subQuat</span><span class="p">(</span><span class="n">target_quat</span><span class="p">,</span> <span class="n">effector_quat</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Deffector</span><span class="p">)</span>
</span><span id="URRobot-243"><a href="#URRobot-243"><span class="linenos">243</span></a>
</span><span id="URRobot-244"><a href="#URRobot-244"><span class="linenos">244</span></a>            <span class="c1"># Rotate into target frame, multiply by subQuat Jacobian, scale by radius.</span>
</span><span id="URRobot-245"><a href="#URRobot-245"><span class="linenos">245</span></a>            <span class="n">target_mat</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">R</span>
</span><span id="URRobot-246"><a href="#URRobot-246"><span class="linenos">246</span></a>            <span class="n">mat</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">Deffector</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">target_mat</span><span class="o">.</span><span class="n">T</span>
</span><span id="URRobot-247"><a href="#URRobot-247"><span class="linenos">247</span></a>            <span class="n">Jo</span> <span class="o">=</span> <span class="n">mat</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">Jo</span>
</span><span id="URRobot-248"><a href="#URRobot-248"><span class="linenos">248</span></a>
</span><span id="URRobot-249"><a href="#URRobot-249"><span class="linenos">249</span></a>            <span class="c1"># Regularization Jacobian.</span>
</span><span id="URRobot-250"><a href="#URRobot-250"><span class="linenos">250</span></a>            <span class="n">Jr</span> <span class="o">=</span> <span class="n">reg</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">n_joints</span><span class="p">)</span>
</span><span id="URRobot-251"><a href="#URRobot-251"><span class="linenos">251</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Jp</span><span class="p">,</span> <span class="n">Jo</span><span class="p">,</span> <span class="n">Jr</span><span class="p">))</span>
</span><span id="URRobot-252"><a href="#URRobot-252"><span class="linenos">252</span></a>
</span><span id="URRobot-253"><a href="#URRobot-253"><span class="linenos">253</span></a>        <span class="k">def</span> <span class="nf">ik_res</span><span class="p">(</span>
</span><span id="URRobot-254"><a href="#URRobot-254"><span class="linenos">254</span></a>            <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="URRobot-255"><a href="#URRobot-255"><span class="linenos">255</span></a>            <span class="n">pos</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="URRobot-256"><a href="#URRobot-256"><span class="linenos">256</span></a>            <span class="n">quat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="URRobot-257"><a href="#URRobot-257"><span class="linenos">257</span></a>            <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.04</span><span class="p">,</span>
</span><span id="URRobot-258"><a href="#URRobot-258"><span class="linenos">258</span></a>            <span class="n">reg</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
</span><span id="URRobot-259"><a href="#URRobot-259"><span class="linenos">259</span></a>            <span class="n">reg_target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="URRobot-260"><a href="#URRobot-260"><span class="linenos">260</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="URRobot-261"><a href="#URRobot-261"><span class="linenos">261</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Residual for inverse kinematics.</span>
</span><span id="URRobot-262"><a href="#URRobot-262"><span class="linenos">262</span></a>
</span><span id="URRobot-263"><a href="#URRobot-263"><span class="linenos">263</span></a><span class="sd">            Args:</span>
</span><span id="URRobot-264"><a href="#URRobot-264"><span class="linenos">264</span></a><span class="sd">                x: joint angles.</span>
</span><span id="URRobot-265"><a href="#URRobot-265"><span class="linenos">265</span></a><span class="sd">                pos: target position for the end effector.</span>
</span><span id="URRobot-266"><a href="#URRobot-266"><span class="linenos">266</span></a><span class="sd">                quat: target orientation for the end effector.</span>
</span><span id="URRobot-267"><a href="#URRobot-267"><span class="linenos">267</span></a><span class="sd">                radius: scaling of the 3D cross.</span>
</span><span id="URRobot-268"><a href="#URRobot-268"><span class="linenos">268</span></a>
</span><span id="URRobot-269"><a href="#URRobot-269"><span class="linenos">269</span></a><span class="sd">            Returns:</span>
</span><span id="URRobot-270"><a href="#URRobot-270"><span class="linenos">270</span></a><span class="sd">                The residual of the Inverse Kinematics task.</span>
</span><span id="URRobot-271"><a href="#URRobot-271"><span class="linenos">271</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="URRobot-272"><a href="#URRobot-272"><span class="linenos">272</span></a>
</span><span id="URRobot-273"><a href="#URRobot-273"><span class="linenos">273</span></a>            <span class="n">T</span> <span class="o">=</span> <span class="n">make_tf</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">ori</span><span class="o">=</span><span class="n">quat</span><span class="p">)</span>
</span><span id="URRobot-274"><a href="#URRobot-274"><span class="linenos">274</span></a>
</span><span id="URRobot-275"><a href="#URRobot-275"><span class="linenos">275</span></a>            <span class="c1"># Set qpos, compute forward kinematics.</span>
</span><span id="URRobot-276"><a href="#URRobot-276"><span class="linenos">276</span></a>            <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="URRobot-277"><a href="#URRobot-277"><span class="linenos">277</span></a>
</span><span id="URRobot-278"><a href="#URRobot-278"><span class="linenos">278</span></a>            <span class="p">[</span>
</span><span id="URRobot-279"><a href="#URRobot-279"><span class="linenos">279</span></a>                <span class="n">set_joint_q</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">joint_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="URRobot-280"><a href="#URRobot-280"><span class="linenos">280</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="URRobot-281"><a href="#URRobot-281"><span class="linenos">281</span></a>            <span class="p">]</span>
</span><span id="URRobot-282"><a href="#URRobot-282"><span class="linenos">282</span></a>            <span class="n">mujoco</span><span class="o">.</span><span class="n">mj_kinematics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="URRobot-283"><a href="#URRobot-283"><span class="linenos">283</span></a>
</span><span id="URRobot-284"><a href="#URRobot-284"><span class="linenos">284</span></a>            <span class="c1"># Position residual.</span>
</span><span id="URRobot-285"><a href="#URRobot-285"><span class="linenos">285</span></a>            <span class="c1"># res_pos = T.t - self.get_ee_pose().t</span>
</span><span id="URRobot-286"><a href="#URRobot-286"><span class="linenos">286</span></a>            <span class="n">res_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ee_pose</span><span class="p">()</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">T</span><span class="o">.</span><span class="n">t</span>
</span><span id="URRobot-287"><a href="#URRobot-287"><span class="linenos">287</span></a>
</span><span id="URRobot-288"><a href="#URRobot-288"><span class="linenos">288</span></a>            <span class="c1"># Effector quat, use mju_mat2quat.</span>
</span><span id="URRobot-289"><a href="#URRobot-289"><span class="linenos">289</span></a>            <span class="n">effector_quat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span id="URRobot-290"><a href="#URRobot-290"><span class="linenos">290</span></a>            <span class="n">mujoco</span><span class="o">.</span><span class="n">mju_mat2Quat</span><span class="p">(</span><span class="n">effector_quat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ee_pose</span><span class="p">()</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="URRobot-291"><a href="#URRobot-291"><span class="linenos">291</span></a>            <span class="c1"># mujoco.mju_mat2Quat(effector_quat, data.site(&quot;effector&quot;).xmat)</span>
</span><span id="URRobot-292"><a href="#URRobot-292"><span class="linenos">292</span></a>
</span><span id="URRobot-293"><a href="#URRobot-293"><span class="linenos">293</span></a>            <span class="c1"># Target quat, exploit the fact that the site is aligned with the body.</span>
</span><span id="URRobot-294"><a href="#URRobot-294"><span class="linenos">294</span></a>            <span class="n">target_quat</span> <span class="o">=</span> <span class="n">smb</span><span class="o">.</span><span class="n">r2q</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
</span><span id="URRobot-295"><a href="#URRobot-295"><span class="linenos">295</span></a>            <span class="c1"># target_quat = data.body(&quot;target&quot;).xquat</span>
</span><span id="URRobot-296"><a href="#URRobot-296"><span class="linenos">296</span></a>
</span><span id="URRobot-297"><a href="#URRobot-297"><span class="linenos">297</span></a>            <span class="c1"># Orientation residual: quaternion difference.</span>
</span><span id="URRobot-298"><a href="#URRobot-298"><span class="linenos">298</span></a>            <span class="n">res_quat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="URRobot-299"><a href="#URRobot-299"><span class="linenos">299</span></a>            <span class="n">mujoco</span><span class="o">.</span><span class="n">mju_subQuat</span><span class="p">(</span><span class="n">res_quat</span><span class="p">,</span> <span class="n">target_quat</span><span class="p">,</span> <span class="n">effector_quat</span><span class="p">)</span>
</span><span id="URRobot-300"><a href="#URRobot-300"><span class="linenos">300</span></a>            <span class="n">res_quat</span> <span class="o">*=</span> <span class="n">radius</span>
</span><span id="URRobot-301"><a href="#URRobot-301"><span class="linenos">301</span></a>
</span><span id="URRobot-302"><a href="#URRobot-302"><span class="linenos">302</span></a>            <span class="c1"># Regularization residual.</span>
</span><span id="URRobot-303"><a href="#URRobot-303"><span class="linenos">303</span></a>            <span class="n">reg_target</span> <span class="o">=</span> <span class="n">q0_init</span> <span class="k">if</span> <span class="n">reg_target</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">reg_target</span>
</span><span id="URRobot-304"><a href="#URRobot-304"><span class="linenos">304</span></a>            <span class="n">res_reg</span> <span class="o">=</span> <span class="n">reg</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">-</span> <span class="n">reg_target</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="URRobot-305"><a href="#URRobot-305"><span class="linenos">305</span></a>
</span><span id="URRobot-306"><a href="#URRobot-306"><span class="linenos">306</span></a>            <span class="n">res_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">res_pos</span><span class="p">,</span> <span class="n">res_quat</span><span class="p">,</span> <span class="n">res_reg</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
</span><span id="URRobot-307"><a href="#URRobot-307"><span class="linenos">307</span></a>
</span><span id="URRobot-308"><a href="#URRobot-308"><span class="linenos">308</span></a>            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">res_i</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="URRobot-309"><a href="#URRobot-309"><span class="linenos">309</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</span><span id="URRobot-310"><a href="#URRobot-310"><span class="linenos">310</span></a>
</span><span id="URRobot-311"><a href="#URRobot-311"><span class="linenos">311</span></a>        <span class="k">def</span> <span class="nf">distance_measure</span><span class="p">(</span><span class="n">pos_error</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">ori_error</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="URRobot-312"><a href="#URRobot-312"><span class="linenos">312</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Compute the distance measure for convergence.&quot;&quot;&quot;</span>
</span><span id="URRobot-313"><a href="#URRobot-313"><span class="linenos">313</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">pos_error</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">ori_error</span><span class="p">)</span>
</span><span id="URRobot-314"><a href="#URRobot-314"><span class="linenos">314</span></a>
</span><span id="URRobot-315"><a href="#URRobot-315"><span class="linenos">315</span></a>        <span class="c1"># Define IK problem</span>
</span><span id="URRobot-316"><a href="#URRobot-316"><span class="linenos">316</span></a>        <span class="c1"># https://colab.research.google.com/github/google-deepmind/mujoco/blob/main/python/least_squares.ipynb#scrollTo=mfhCxqQiio5l</span>
</span><span id="URRobot-317"><a href="#URRobot-317"><span class="linenos">317</span></a>
</span><span id="URRobot-318"><a href="#URRobot-318"><span class="linenos">318</span></a>        <span class="n">pos</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">t</span>
</span><span id="URRobot-319"><a href="#URRobot-319"><span class="linenos">319</span></a>        <span class="n">quat</span> <span class="o">=</span> <span class="n">smb</span><span class="o">.</span><span class="n">r2q</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
</span><span id="URRobot-320"><a href="#URRobot-320"><span class="linenos">320</span></a>        <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">joint_limits</span>
</span><span id="URRobot-321"><a href="#URRobot-321"><span class="linenos">321</span></a>        <span class="n">q0_init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span>
</span><span id="URRobot-322"><a href="#URRobot-322"><span class="linenos">322</span></a>        <span class="n">q0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span>
</span><span id="URRobot-323"><a href="#URRobot-323"><span class="linenos">323</span></a>        <span class="n">converged</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="URRobot-324"><a href="#URRobot-324"><span class="linenos">324</span></a>        <span class="n">q_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
</span><span id="URRobot-325"><a href="#URRobot-325"><span class="linenos">325</span></a>
</span><span id="URRobot-326"><a href="#URRobot-326"><span class="linenos">326</span></a>        <span class="n">_T</span> <span class="o">=</span> <span class="n">ctraj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_ee_pose</span><span class="p">(),</span> <span class="n">T</span><span class="p">,</span> <span class="n">iter_interpolation</span><span class="p">)</span>
</span><span id="URRobot-327"><a href="#URRobot-327"><span class="linenos">327</span></a>
</span><span id="URRobot-328"><a href="#URRobot-328"><span class="linenos">328</span></a>        <span class="n">t0</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</span><span id="URRobot-329"><a href="#URRobot-329"><span class="linenos">329</span></a>
</span><span id="URRobot-330"><a href="#URRobot-330"><span class="linenos">330</span></a>        <span class="k">for</span> <span class="n">Ti</span> <span class="ow">in</span> <span class="n">_T</span><span class="p">:</span>
</span><span id="URRobot-331"><a href="#URRobot-331"><span class="linenos">331</span></a>            <span class="n">pos</span> <span class="o">=</span> <span class="n">Ti</span><span class="o">.</span><span class="n">t</span>
</span><span id="URRobot-332"><a href="#URRobot-332"><span class="linenos">332</span></a>            <span class="n">quat</span> <span class="o">=</span> <span class="n">smb</span><span class="o">.</span><span class="n">r2q</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
</span><span id="URRobot-333"><a href="#URRobot-333"><span class="linenos">333</span></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">iter</span><span class="p">):</span>
</span><span id="URRobot-334"><a href="#URRobot-334"><span class="linenos">334</span></a>                <span class="n">ik_target</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ik_res</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">quat</span><span class="o">=</span><span class="n">quat</span><span class="p">,</span> <span class="n">reg_target</span><span class="o">=</span><span class="n">q0</span><span class="p">)</span>
</span><span id="URRobot-335"><a href="#URRobot-335"><span class="linenos">335</span></a>                <span class="n">jac_target</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">ik_jac</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">quat</span><span class="o">=</span><span class="n">quat</span><span class="p">)</span>
</span><span id="URRobot-336"><a href="#URRobot-336"><span class="linenos">336</span></a>
</span><span id="URRobot-337"><a href="#URRobot-337"><span class="linenos">337</span></a>                <span class="n">q</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">minimize</span><span class="o">.</span><span class="n">least_squares</span><span class="p">(</span>
</span><span id="URRobot-338"><a href="#URRobot-338"><span class="linenos">338</span></a>                    <span class="n">q0</span><span class="p">,</span>
</span><span id="URRobot-339"><a href="#URRobot-339"><span class="linenos">339</span></a>                    <span class="n">ik_target</span><span class="p">,</span>
</span><span id="URRobot-340"><a href="#URRobot-340"><span class="linenos">340</span></a>                    <span class="n">bounds</span><span class="p">,</span>
</span><span id="URRobot-341"><a href="#URRobot-341"><span class="linenos">341</span></a>                    <span class="n">jacobian</span><span class="o">=</span><span class="n">jac_target</span><span class="p">,</span>
</span><span id="URRobot-342"><a href="#URRobot-342"><span class="linenos">342</span></a>                    <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="URRobot-343"><a href="#URRobot-343"><span class="linenos">343</span></a>                <span class="p">)</span>
</span><span id="URRobot-344"><a href="#URRobot-344"><span class="linenos">344</span></a>
</span><span id="URRobot-345"><a href="#URRobot-345"><span class="linenos">345</span></a>                <span class="p">[</span>
</span><span id="URRobot-346"><a href="#URRobot-346"><span class="linenos">346</span></a>                    <span class="n">set_joint_q</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">joint_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">qi</span><span class="p">)</span>
</span><span id="URRobot-347"><a href="#URRobot-347"><span class="linenos">347</span></a>                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">qi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</span><span id="URRobot-348"><a href="#URRobot-348"><span class="linenos">348</span></a>                <span class="p">]</span>
</span><span id="URRobot-349"><a href="#URRobot-349"><span class="linenos">349</span></a>
</span><span id="URRobot-350"><a href="#URRobot-350"><span class="linenos">350</span></a>                <span class="n">mj</span><span class="o">.</span><span class="n">mj_kinematics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="URRobot-351"><a href="#URRobot-351"><span class="linenos">351</span></a>
</span><span id="URRobot-352"><a href="#URRobot-352"><span class="linenos">352</span></a>                <span class="n">pos_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ee_pose</span><span class="p">()</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">pos</span>
</span><span id="URRobot-353"><a href="#URRobot-353"><span class="linenos">353</span></a>                <span class="n">effector_quat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span id="URRobot-354"><a href="#URRobot-354"><span class="linenos">354</span></a>                <span class="n">mujoco</span><span class="o">.</span><span class="n">mju_mat2Quat</span><span class="p">(</span><span class="n">effector_quat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ee_pose</span><span class="p">()</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="URRobot-355"><a href="#URRobot-355"><span class="linenos">355</span></a>                <span class="n">res_quat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="URRobot-356"><a href="#URRobot-356"><span class="linenos">356</span></a>                <span class="n">mujoco</span><span class="o">.</span><span class="n">mju_subQuat</span><span class="p">(</span><span class="n">res_quat</span><span class="p">,</span> <span class="n">quat</span><span class="p">,</span> <span class="n">effector_quat</span><span class="p">)</span>
</span><span id="URRobot-357"><a href="#URRobot-357"><span class="linenos">357</span></a>                <span class="n">res_quat</span> <span class="o">*=</span> <span class="n">radius</span>
</span><span id="URRobot-358"><a href="#URRobot-358"><span class="linenos">358</span></a>                <span class="n">distance</span> <span class="o">=</span> <span class="n">distance_measure</span><span class="p">(</span><span class="n">pos_error</span><span class="p">,</span> <span class="n">res_quat</span><span class="p">)</span>
</span><span id="URRobot-359"><a href="#URRobot-359"><span class="linenos">359</span></a>
</span><span id="URRobot-360"><a href="#URRobot-360"><span class="linenos">360</span></a>                <span class="n">q_error</span> <span class="o">=</span> <span class="n">q</span> <span class="o">-</span> <span class="n">q0</span>
</span><span id="URRobot-361"><a href="#URRobot-361"><span class="linenos">361</span></a>
</span><span id="URRobot-362"><a href="#URRobot-362"><span class="linenos">362</span></a>                <span class="c1"># eval steps and epsilon</span>
</span><span id="URRobot-363"><a href="#URRobot-363"><span class="linenos">363</span></a>                <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">epsilon</span><span class="p">:</span>
</span><span id="URRobot-364"><a href="#URRobot-364"><span class="linenos">364</span></a>                    <span class="n">converged</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="URRobot-365"><a href="#URRobot-365"><span class="linenos">365</span></a>                    <span class="k">break</span>
</span><span id="URRobot-366"><a href="#URRobot-366"><span class="linenos">366</span></a>                <span class="n">q0</span> <span class="o">=</span> <span class="n">q</span>
</span><span id="URRobot-367"><a href="#URRobot-367"><span class="linenos">367</span></a>
</span><span id="URRobot-368"><a href="#URRobot-368"><span class="linenos">368</span></a>        <span class="c1"># reset to current q</span>
</span><span id="URRobot-369"><a href="#URRobot-369"><span class="linenos">369</span></a>        <span class="p">[</span>
</span><span id="URRobot-370"><a href="#URRobot-370"><span class="linenos">370</span></a>            <span class="n">set_joint_q</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">joint_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">q0_init</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="URRobot-371"><a href="#URRobot-371"><span class="linenos">371</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">q0_init</span><span class="p">))</span>
</span><span id="URRobot-372"><a href="#URRobot-372"><span class="linenos">372</span></a>        <span class="p">]</span>
</span><span id="URRobot-373"><a href="#URRobot-373"><span class="linenos">373</span></a>
</span><span id="URRobot-374"><a href="#URRobot-374"><span class="linenos">374</span></a>        <span class="n">time</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
</span><span id="URRobot-375"><a href="#URRobot-375"><span class="linenos">375</span></a>
</span><span id="URRobot-376"><a href="#URRobot-376"><span class="linenos">376</span></a>        <span class="n">t_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fk</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">pos</span>
</span><span id="URRobot-377"><a href="#URRobot-377"><span class="linenos">377</span></a>
</span><span id="URRobot-378"><a href="#URRobot-378"><span class="linenos">378</span></a>        <span class="k">return</span> <span class="n">q</span><span class="p">,</span> <span class="n">converged</span><span class="p">,</span> <span class="n">q_error</span><span class="p">,</span> <span class="n">t_error</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">time</span><span class="p">}</span>
</span><span id="URRobot-379"><a href="#URRobot-379"><span class="linenos">379</span></a>
</span><span id="URRobot-380"><a href="#URRobot-380"><span class="linenos">380</span></a>    <span class="k">def</span> <span class="nf">get_ee_pose</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sm</span><span class="o">.</span><span class="n">SE3</span><span class="p">:</span>
</span><span id="URRobot-381"><a href="#URRobot-381"><span class="linenos">381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="URRobot-382"><a href="#URRobot-382"><span class="linenos">382</span></a><span class="sd">        Get the end-effector pose for the UR robot.</span>
</span><span id="URRobot-383"><a href="#URRobot-383"><span class="linenos">383</span></a>
</span><span id="URRobot-384"><a href="#URRobot-384"><span class="linenos">384</span></a><span class="sd">        Returns</span>
</span><span id="URRobot-385"><a href="#URRobot-385"><span class="linenos">385</span></a><span class="sd">        ----------</span>
</span><span id="URRobot-386"><a href="#URRobot-386"><span class="linenos">386</span></a><span class="sd">                T (sm.SE3): The end-effector pose in the base frame.</span>
</span><span id="URRobot-387"><a href="#URRobot-387"><span class="linenos">387</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URRobot-388"><a href="#URRobot-388"><span class="linenos">388</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
</span><span id="URRobot-389"><a href="#URRobot-389"><span class="linenos">389</span></a>
</span><span id="URRobot-390"><a href="#URRobot-390"><span class="linenos">390</span></a>    <span class="k">def</span> <span class="nf">set_ee_pose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">SE3</span><span class="p">):</span>
</span><span id="URRobot-391"><a href="#URRobot-391"><span class="linenos">391</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="URRobot-392"><a href="#URRobot-392"><span class="linenos">392</span></a><span class="sd">        Set the desired end-effector pose for the UR robot.</span>
</span><span id="URRobot-393"><a href="#URRobot-393"><span class="linenos">393</span></a>
</span><span id="URRobot-394"><a href="#URRobot-394"><span class="linenos">394</span></a><span class="sd">        Args</span>
</span><span id="URRobot-395"><a href="#URRobot-395"><span class="linenos">395</span></a><span class="sd">        ----------</span>
</span><span id="URRobot-396"><a href="#URRobot-396"><span class="linenos">396</span></a><span class="sd">                T (sm.SE3): The desired end-effector pose in the base frame.</span>
</span><span id="URRobot-397"><a href="#URRobot-397"><span class="linenos">397</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URRobot-398"><a href="#URRobot-398"><span class="linenos">398</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">T_target</span> <span class="o">=</span> <span class="n">T</span>
</span><span id="URRobot-399"><a href="#URRobot-399"><span class="linenos">399</span></a>
</span><span id="URRobot-400"><a href="#URRobot-400"><span class="linenos">400</span></a>    <span class="k">def</span> <span class="nf">move_l</span><span class="p">(</span>
</span><span id="URRobot-401"><a href="#URRobot-401"><span class="linenos">401</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="URRobot-402"><a href="#URRobot-402"><span class="linenos">402</span></a>        <span class="n">T</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">SE3</span><span class="p">,</span>
</span><span id="URRobot-403"><a href="#URRobot-403"><span class="linenos">403</span></a>        <span class="n">ss</span><span class="p">:</span> <span class="n">SimSync</span><span class="p">,</span>
</span><span id="URRobot-404"><a href="#URRobot-404"><span class="linenos">404</span></a>        <span class="n">velocity</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
</span><span id="URRobot-405"><a href="#URRobot-405"><span class="linenos">405</span></a>        <span class="n">acceleration</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.2</span><span class="p">,</span>
</span><span id="URRobot-406"><a href="#URRobot-406"><span class="linenos">406</span></a>    <span class="p">):</span>
</span><span id="URRobot-407"><a href="#URRobot-407"><span class="linenos">407</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="URRobot-408"><a href="#URRobot-408"><span class="linenos">408</span></a><span class="sd">        Move to a given position in task-space (or cartesian space)</span>
</span><span id="URRobot-409"><a href="#URRobot-409"><span class="linenos">409</span></a>
</span><span id="URRobot-410"><a href="#URRobot-410"><span class="linenos">410</span></a><span class="sd">        The robot guides the TCP at a defined velocity along a straight path to the end point defined by T.</span>
</span><span id="URRobot-411"><a href="#URRobot-411"><span class="linenos">411</span></a>
</span><span id="URRobot-412"><a href="#URRobot-412"><span class="linenos">412</span></a><span class="sd">        Args:</span>
</span><span id="URRobot-413"><a href="#URRobot-413"><span class="linenos">413</span></a><span class="sd">                T (sm.SE3): The desired end-effector pose in the base frame.</span>
</span><span id="URRobot-414"><a href="#URRobot-414"><span class="linenos">414</span></a><span class="sd">                velocity (Union[list, np.ndarray]): tool velocity [m/s]</span>
</span><span id="URRobot-415"><a href="#URRobot-415"><span class="linenos">415</span></a><span class="sd">                acceleration (Union[list, np.ndarray]): tool acceleration [m/s^2]</span>
</span><span id="URRobot-416"><a href="#URRobot-416"><span class="linenos">416</span></a>
</span><span id="URRobot-417"><a href="#URRobot-417"><span class="linenos">417</span></a><span class="sd">        Returns:</span>
</span><span id="URRobot-418"><a href="#URRobot-418"><span class="linenos">418</span></a><span class="sd">                success (bool): True if the move succeeds and False otherwise.</span>
</span><span id="URRobot-419"><a href="#URRobot-419"><span class="linenos">419</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URRobot-420"><a href="#URRobot-420"><span class="linenos">420</span></a>
</span><span id="URRobot-421"><a href="#URRobot-421"><span class="linenos">421</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="URRobot-422"><a href="#URRobot-422"><span class="linenos">422</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="URRobot-423"><a href="#URRobot-423"><span class="linenos">423</span></a><span class="s2">                            You attempted to send a command to the robot without a controller, set a controller </span>
</span><span id="URRobot-424"><a href="#URRobot-424"><span class="linenos">424</span></a><span class="s2">                            ur5e.controller = DiffIk(ur5e)</span>
</span><span id="URRobot-425"><a href="#URRobot-425"><span class="linenos">425</span></a><span class="s2">                            or</span>
</span><span id="URRobot-426"><a href="#URRobot-426"><span class="linenos">426</span></a><span class="s2">                            ur5e.controller = OpSpace(ur5e)</span>
</span><span id="URRobot-427"><a href="#URRobot-427"><span class="linenos">427</span></a><span class="s2">                            &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="URRobot-428"><a href="#URRobot-428"><span class="linenos">428</span></a>
</span><span id="URRobot-429"><a href="#URRobot-429"><span class="linenos">429</span></a>        <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="URRobot-430"><a href="#URRobot-430"><span class="linenos">430</span></a>
</span><span id="URRobot-431"><a href="#URRobot-431"><span class="linenos">431</span></a>        <span class="c1"># get the tcp pose in base frame</span>
</span><span id="URRobot-432"><a href="#URRobot-432"><span class="linenos">432</span></a>        <span class="n">T_base_tcp</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">SE3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
</span><span id="URRobot-433"><a href="#URRobot-433"><span class="linenos">433</span></a>        <span class="n">T0</span> <span class="o">=</span> <span class="n">T_base_tcp</span>
</span><span id="URRobot-434"><a href="#URRobot-434"><span class="linenos">434</span></a>        <span class="n">T1</span> <span class="o">=</span> <span class="n">T</span>
</span><span id="URRobot-435"><a href="#URRobot-435"><span class="linenos">435</span></a>
</span><span id="URRobot-436"><a href="#URRobot-436"><span class="linenos">436</span></a>        <span class="c1"># check if current and target is identical within some tolerance and abort if so.</span>
</span><span id="URRobot-437"><a href="#URRobot-437"><span class="linenos">437</span></a>        <span class="k">if</span> <span class="n">T0</span> <span class="o">==</span> <span class="n">T1</span><span class="p">:</span>
</span><span id="URRobot-438"><a href="#URRobot-438"><span class="linenos">438</span></a>            <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="URRobot-439"><a href="#URRobot-439"><span class="linenos">439</span></a>            <span class="k">return</span> <span class="n">success</span>
</span><span id="URRobot-440"><a href="#URRobot-440"><span class="linenos">440</span></a>
</span><span id="URRobot-441"><a href="#URRobot-441"><span class="linenos">441</span></a>        <span class="c1"># calculate trajectory duration based on provided velocity and difference of SE(3) matrices as differential motion.</span>
</span><span id="URRobot-442"><a href="#URRobot-442"><span class="linenos">442</span></a>        <span class="n">delta</span> <span class="o">=</span> <span class="n">T0</span><span class="o">.</span><span class="n">delta</span><span class="p">(</span><span class="n">T1</span><span class="p">)</span>
</span><span id="URRobot-443"><a href="#URRobot-443"><span class="linenos">443</span></a>        <span class="n">duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">/</span> <span class="n">velocity</span>
</span><span id="URRobot-444"><a href="#URRobot-444"><span class="linenos">444</span></a>
</span><span id="URRobot-445"><a href="#URRobot-445"><span class="linenos">445</span></a>        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="URRobot-446"><a href="#URRobot-446"><span class="linenos">446</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="URRobot-447"><a href="#URRobot-447"><span class="linenos">447</span></a>                <span class="s2">&quot;&gt; performing move_l:</span><span class="se">\n</span><span class="s2">  from:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="URRobot-448"><a href="#URRobot-448"><span class="linenos">448</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">T0</span><span class="p">)</span>
</span><span id="URRobot-449"><a href="#URRobot-449"><span class="linenos">449</span></a>                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  to:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="URRobot-450"><a href="#URRobot-450"><span class="linenos">450</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">T1</span><span class="p">)</span>
</span><span id="URRobot-451"><a href="#URRobot-451"><span class="linenos">451</span></a>                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  duration:</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="URRobot-452"><a href="#URRobot-452"><span class="linenos">452</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">duration</span><span class="p">))</span>
</span><span id="URRobot-453"><a href="#URRobot-453"><span class="linenos">453</span></a>                <span class="o">+</span> <span class="s2">&quot; s&quot;</span>
</span><span id="URRobot-454"><a href="#URRobot-454"><span class="linenos">454</span></a>            <span class="p">)</span>
</span><span id="URRobot-455"><a href="#URRobot-455"><span class="linenos">455</span></a>
</span><span id="URRobot-456"><a href="#URRobot-456"><span class="linenos">456</span></a>        <span class="n">trajectory_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">))</span>
</span><span id="URRobot-457"><a href="#URRobot-457"><span class="linenos">457</span></a>        <span class="n">t_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">trajectory_samples</span><span class="p">)</span>
</span><span id="URRobot-458"><a href="#URRobot-458"><span class="linenos">458</span></a>
</span><span id="URRobot-459"><a href="#URRobot-459"><span class="linenos">459</span></a>        <span class="n">c_traj</span> <span class="o">=</span> <span class="n">ctraj</span><span class="p">(</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">t_array</span><span class="p">)</span>
</span><span id="URRobot-460"><a href="#URRobot-460"><span class="linenos">460</span></a>
</span><span id="URRobot-461"><a href="#URRobot-461"><span class="linenos">461</span></a>        <span class="c1"># Add task poses to the task queue</span>
</span><span id="URRobot-462"><a href="#URRobot-462"><span class="linenos">462</span></a>        <span class="k">for</span> <span class="n">task_pose</span> <span class="ow">in</span> <span class="n">c_traj</span><span class="p">:</span>
</span><span id="URRobot-463"><a href="#URRobot-463"><span class="linenos">463</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">T_target</span> <span class="o">=</span> <span class="n">task_pose</span>
</span><span id="URRobot-464"><a href="#URRobot-464"><span class="linenos">464</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="URRobot-465"><a href="#URRobot-465"><span class="linenos">465</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_ctrl</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="URRobot-466"><a href="#URRobot-466"><span class="linenos">466</span></a>            <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
</span><span id="URRobot-467"><a href="#URRobot-467"><span class="linenos">467</span></a>        <span class="k">return</span> <span class="n">success</span>
</span><span id="URRobot-468"><a href="#URRobot-468"><span class="linenos">468</span></a>
</span><span id="URRobot-469"><a href="#URRobot-469"><span class="linenos">469</span></a>    <span class="k">def</span> <span class="nf">move_j</span><span class="p">(</span>
</span><span id="URRobot-470"><a href="#URRobot-470"><span class="linenos">470</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="URRobot-471"><a href="#URRobot-471"><span class="linenos">471</span></a>        <span class="n">q</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
</span><span id="URRobot-472"><a href="#URRobot-472"><span class="linenos">472</span></a>        <span class="n">ss</span><span class="p">:</span> <span class="n">SimSync</span><span class="p">,</span>
</span><span id="URRobot-473"><a href="#URRobot-473"><span class="linenos">473</span></a>        <span class="n">velocity</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.05</span><span class="p">,</span>
</span><span id="URRobot-474"><a href="#URRobot-474"><span class="linenos">474</span></a>        <span class="n">acceleration</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.4</span><span class="p">,</span>
</span><span id="URRobot-475"><a href="#URRobot-475"><span class="linenos">475</span></a>    <span class="p">):</span>
</span><span id="URRobot-476"><a href="#URRobot-476"><span class="linenos">476</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="URRobot-477"><a href="#URRobot-477"><span class="linenos">477</span></a><span class="sd">        Move to a given joint position in joint-space.</span>
</span><span id="URRobot-478"><a href="#URRobot-478"><span class="linenos">478</span></a>
</span><span id="URRobot-479"><a href="#URRobot-479"><span class="linenos">479</span></a><span class="sd">        The robot moves the joints to achieve the fastest path to the end point. The fastest</span>
</span><span id="URRobot-480"><a href="#URRobot-480"><span class="linenos">480</span></a><span class="sd">        path is generally not the shortest path and is thus not a straight line. As the</span>
</span><span id="URRobot-481"><a href="#URRobot-481"><span class="linenos">481</span></a><span class="sd">        motions of the robot axes are rotational, curved paths can be executed faster than</span>
</span><span id="URRobot-482"><a href="#URRobot-482"><span class="linenos">482</span></a><span class="sd">        straight paths. The exact path of the motion cannot be predicted.</span>
</span><span id="URRobot-483"><a href="#URRobot-483"><span class="linenos">483</span></a>
</span><span id="URRobot-484"><a href="#URRobot-484"><span class="linenos">484</span></a><span class="sd">        Args:</span>
</span><span id="URRobot-485"><a href="#URRobot-485"><span class="linenos">485</span></a><span class="sd">                q (Union[list, np.ndarray]): q specifies joint positions of the robot axes [radians].</span>
</span><span id="URRobot-486"><a href="#URRobot-486"><span class="linenos">486</span></a><span class="sd">                velocity (Union[list, np.ndarray]): joint velocity [rad/s]</span>
</span><span id="URRobot-487"><a href="#URRobot-487"><span class="linenos">487</span></a><span class="sd">                acceleration (Union[list, np.ndarray]): joint acceleration [rad/s^2]</span>
</span><span id="URRobot-488"><a href="#URRobot-488"><span class="linenos">488</span></a>
</span><span id="URRobot-489"><a href="#URRobot-489"><span class="linenos">489</span></a><span class="sd">        Returns:</span>
</span><span id="URRobot-490"><a href="#URRobot-490"><span class="linenos">490</span></a><span class="sd">                success (bool): True if the move succeeds and False otherwise.</span>
</span><span id="URRobot-491"><a href="#URRobot-491"><span class="linenos">491</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URRobot-492"><a href="#URRobot-492"><span class="linenos">492</span></a>
</span><span id="URRobot-493"><a href="#URRobot-493"><span class="linenos">493</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="URRobot-494"><a href="#URRobot-494"><span class="linenos">494</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="URRobot-495"><a href="#URRobot-495"><span class="linenos">495</span></a><span class="s2">                            You attempted to send a command to the robot without a controller, set a controller </span>
</span><span id="URRobot-496"><a href="#URRobot-496"><span class="linenos">496</span></a><span class="s2">                            ur5e.controller = DiffIk(ur5e)</span>
</span><span id="URRobot-497"><a href="#URRobot-497"><span class="linenos">497</span></a><span class="s2">                            or</span>
</span><span id="URRobot-498"><a href="#URRobot-498"><span class="linenos">498</span></a><span class="s2">                            ur5e.controller = OpSpace(ur5e)</span>
</span><span id="URRobot-499"><a href="#URRobot-499"><span class="linenos">499</span></a><span class="s2">                            &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="URRobot-500"><a href="#URRobot-500"><span class="linenos">500</span></a>
</span><span id="URRobot-501"><a href="#URRobot-501"><span class="linenos">501</span></a>        <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="URRobot-502"><a href="#URRobot-502"><span class="linenos">502</span></a>
</span><span id="URRobot-503"><a href="#URRobot-503"><span class="linenos">503</span></a>        <span class="n">current_q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span>
</span><span id="URRobot-504"><a href="#URRobot-504"><span class="linenos">504</span></a>        <span class="n">target_q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</span><span id="URRobot-505"><a href="#URRobot-505"><span class="linenos">505</span></a>
</span><span id="URRobot-506"><a href="#URRobot-506"><span class="linenos">506</span></a>        <span class="c1"># check if current and target is identical within some tolerance and abort if so.</span>
</span><span id="URRobot-507"><a href="#URRobot-507"><span class="linenos">507</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">current_q</span><span class="p">,</span> <span class="n">target_q</span><span class="p">):</span>
</span><span id="URRobot-508"><a href="#URRobot-508"><span class="linenos">508</span></a>            <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="URRobot-509"><a href="#URRobot-509"><span class="linenos">509</span></a>            <span class="k">return</span> <span class="n">success</span>
</span><span id="URRobot-510"><a href="#URRobot-510"><span class="linenos">510</span></a>
</span><span id="URRobot-511"><a href="#URRobot-511"><span class="linenos">511</span></a>        <span class="c1"># calculate trajectory duration based on provided velocity and leading axis movement.</span>
</span><span id="URRobot-512"><a href="#URRobot-512"><span class="linenos">512</span></a>        <span class="n">max_dist</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="URRobot-513"><a href="#URRobot-513"><span class="linenos">513</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
</span><span id="URRobot-514"><a href="#URRobot-514"><span class="linenos">514</span></a>            <span class="n">max_dist</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_dist</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">current_q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">target_q</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span><span id="URRobot-515"><a href="#URRobot-515"><span class="linenos">515</span></a>        <span class="n">duration</span> <span class="o">=</span> <span class="n">max_dist</span> <span class="o">/</span> <span class="n">velocity</span>
</span><span id="URRobot-516"><a href="#URRobot-516"><span class="linenos">516</span></a>        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="URRobot-517"><a href="#URRobot-517"><span class="linenos">517</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="URRobot-518"><a href="#URRobot-518"><span class="linenos">518</span></a>                <span class="s2">&quot;&gt; performing move_j:</span><span class="se">\n\t</span><span class="s2">from</span><span class="se">\t\t</span><span class="s2">:</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="URRobot-519"><a href="#URRobot-519"><span class="linenos">519</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_q</span><span class="p">)</span>
</span><span id="URRobot-520"><a href="#URRobot-520"><span class="linenos">520</span></a>                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">to</span><span class="se">\t\t</span><span class="s2">:</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="URRobot-521"><a href="#URRobot-521"><span class="linenos">521</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">target_q</span><span class="p">)</span>
</span><span id="URRobot-522"><a href="#URRobot-522"><span class="linenos">522</span></a>                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">duration</span><span class="se">\t</span><span class="s2">:</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="URRobot-523"><a href="#URRobot-523"><span class="linenos">523</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">duration</span><span class="p">))</span>
</span><span id="URRobot-524"><a href="#URRobot-524"><span class="linenos">524</span></a>                <span class="o">+</span> <span class="s2">&quot; s&quot;</span>
</span><span id="URRobot-525"><a href="#URRobot-525"><span class="linenos">525</span></a>            <span class="p">)</span>
</span><span id="URRobot-526"><a href="#URRobot-526"><span class="linenos">526</span></a>        <span class="n">trajectory_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">))</span>
</span><span id="URRobot-527"><a href="#URRobot-527"><span class="linenos">527</span></a>        <span class="n">t_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">trajectory_samples</span><span class="p">)</span>
</span><span id="URRobot-528"><a href="#URRobot-528"><span class="linenos">528</span></a>        <span class="n">j_traj</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span><span class="n">current_q</span><span class="p">,</span> <span class="n">target_q</span><span class="p">,</span> <span class="n">t_array</span><span class="p">)</span><span class="o">.</span><span class="n">q</span>
</span><span id="URRobot-529"><a href="#URRobot-529"><span class="linenos">529</span></a>
</span><span id="URRobot-530"><a href="#URRobot-530"><span class="linenos">530</span></a>        <span class="k">for</span> <span class="n">joint_q</span> <span class="ow">in</span> <span class="n">j_traj</span><span class="p">:</span>
</span><span id="URRobot-531"><a href="#URRobot-531"><span class="linenos">531</span></a>            <span class="n">task_pose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fk</span><span class="p">(</span><span class="n">joint_q</span><span class="p">)</span>
</span><span id="URRobot-532"><a href="#URRobot-532"><span class="linenos">532</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">T_target</span> <span class="o">=</span> <span class="n">task_pose</span>
</span><span id="URRobot-533"><a href="#URRobot-533"><span class="linenos">533</span></a>            <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
</span><span id="URRobot-534"><a href="#URRobot-534"><span class="linenos">534</span></a>        <span class="k">return</span> <span class="n">success</span>
</span><span id="URRobot-535"><a href="#URRobot-535"><span class="linenos">535</span></a>
</span><span id="URRobot-536"><a href="#URRobot-536"><span class="linenos">536</span></a>    <span class="k">def</span> <span class="nf">move_traj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">sm</span><span class="o">.</span><span class="n">SE3</span><span class="p">,</span> <span class="n">List</span><span class="p">],</span> <span class="n">ss</span><span class="p">:</span> <span class="n">SimSync</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="URRobot-537"><a href="#URRobot-537"><span class="linenos">537</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="URRobot-538"><a href="#URRobot-538"><span class="linenos">538</span></a><span class="sd">        Move the robot along a given trajectory.</span>
</span><span id="URRobot-539"><a href="#URRobot-539"><span class="linenos">539</span></a>
</span><span id="URRobot-540"><a href="#URRobot-540"><span class="linenos">540</span></a><span class="sd">        This function enqueues a series of task poses for the robot to follow sequentially.</span>
</span><span id="URRobot-541"><a href="#URRobot-541"><span class="linenos">541</span></a>
</span><span id="URRobot-542"><a href="#URRobot-542"><span class="linenos">542</span></a><span class="sd">        Args</span>
</span><span id="URRobot-543"><a href="#URRobot-543"><span class="linenos">543</span></a><span class="sd">        ----------</span>
</span><span id="URRobot-544"><a href="#URRobot-544"><span class="linenos">544</span></a><span class="sd">                T (Union[sm.SE3, List]): List of desired end-effector poses in the base frame.</span>
</span><span id="URRobot-545"><a href="#URRobot-545"><span class="linenos">545</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URRobot-546"><a href="#URRobot-546"><span class="linenos">546</span></a>        <span class="c1"># add task poses to the robot task queue</span>
</span><span id="URRobot-547"><a href="#URRobot-547"><span class="linenos">547</span></a>
</span><span id="URRobot-548"><a href="#URRobot-548"><span class="linenos">548</span></a>        <span class="k">for</span> <span class="n">task_pose</span> <span class="ow">in</span> <span class="n">T</span><span class="p">:</span>
</span><span id="URRobot-549"><a href="#URRobot-549"><span class="linenos">549</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">T_target</span> <span class="o">=</span> <span class="n">task_pose</span>
</span><span id="URRobot-550"><a href="#URRobot-550"><span class="linenos">550</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="URRobot-551"><a href="#URRobot-551"><span class="linenos">551</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_ctrl</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="URRobot-552"><a href="#URRobot-552"><span class="linenos">552</span></a>            <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Base class for robot simulation in MuJoCo.</p>

<p>This class provides a framework for simulating robots in MuJoCo environments. It defines
key properties and methods that should be implemented in child classes, including access
to the robot's model, data, and control mechanisms.</p>
</div>


                            <div id="URRobot.__init__" class="classattr">
                                        <input id="URRobot.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">URRobot</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">model</span><span class="p">:</span> <span class="n">mujoco</span><span class="o">.</span><span class="n">_structs</span><span class="o">.</span><span class="n">MjModel</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">mujoco</span><span class="o">.</span><span class="n">_structs</span><span class="o">.</span><span class="n">MjData</span>,</span><span class="param">	<span class="n">robot_type</span><span class="p">:</span> <span class="n"><a href="#URRobot.Type">URRobot.Type</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">Type</span><span class="o">.</span><span class="n">UR5e</span><span class="p">:</span> <span class="s1">&#39;ur5e&#39;</span><span class="o">&gt;</span></span>)</span>

                <label class="view-source-button" for="URRobot.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#URRobot.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="URRobot.__init__-35"><a href="#URRobot.__init__-35"><span class="linenos">35</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="URRobot.__init__-36"><a href="#URRobot.__init__-36"><span class="linenos">36</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="URRobot.__init__-37"><a href="#URRobot.__init__-37"><span class="linenos">37</span></a>        <span class="n">model</span><span class="p">:</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjModel</span><span class="p">,</span>
</span><span id="URRobot.__init__-38"><a href="#URRobot.__init__-38"><span class="linenos">38</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjData</span><span class="p">,</span>
</span><span id="URRobot.__init__-39"><a href="#URRobot.__init__-39"><span class="linenos">39</span></a>        <span class="n">robot_type</span><span class="p">:</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">Type</span><span class="o">.</span><span class="n">UR5e</span><span class="p">,</span>
</span><span id="URRobot.__init__-40"><a href="#URRobot.__init__-40"><span class="linenos">40</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="URRobot.__init__-41"><a href="#URRobot.__init__-41"><span class="linenos">41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="URRobot.__init__-42"><a href="#URRobot.__init__-42"><span class="linenos">42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="URRobot.__init__-43"><a href="#URRobot.__init__-43"><span class="linenos">43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_robot_type</span> <span class="o">=</span> <span class="n">robot_type</span><span class="o">.</span><span class="n">value</span>
</span><span id="URRobot.__init__-44"><a href="#URRobot.__init__-44"><span class="linenos">44</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">timestep</span>
</span><span id="URRobot.__init__-45"><a href="#URRobot.__init__-45"><span class="linenos">45</span></a>
</span><span id="URRobot.__init__-46"><a href="#URRobot.__init__-46"><span class="linenos">46</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">home_qpos</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5708</span><span class="p">,</span> <span class="mf">1.5708</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5708</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5708</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="URRobot.__init__-47"><a href="#URRobot.__init__-47"><span class="linenos">47</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_queue</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
</span><span id="URRobot.__init__-48"><a href="#URRobot.__init__-48"><span class="linenos">48</span></a>
</span><span id="URRobot.__init__-49"><a href="#URRobot.__init__-49"><span class="linenos">49</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">RobotInfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="URRobot.__init__-50"><a href="#URRobot.__init__-50"><span class="linenos">50</span></a>
</span><span id="URRobot.__init__-51"><a href="#URRobot.__init__-51"><span class="linenos">51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tcp_id</span> <span class="o">=</span> <span class="n">name2id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/attachment_site&quot;</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">SITE</span><span class="p">)</span>
</span><span id="URRobot.__init__-52"><a href="#URRobot.__init__-52"><span class="linenos">52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_controller</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


    

                            </div>
                            <div id="URRobot.dt" class="classattr">
                                <div class="attr variable">
            <span class="name">dt</span>

        
    </div>
    <a class="headerlink" href="#URRobot.dt"></a>
    
    

                            </div>
                            <div id="URRobot.home_qpos" class="classattr">
                                <div class="attr variable">
            <span class="name">home_qpos</span>

        
    </div>
    <a class="headerlink" href="#URRobot.home_qpos"></a>
    
    

                            </div>
                            <div id="URRobot.tcp_id" class="classattr">
                                <div class="attr variable">
            <span class="name">tcp_id</span>

        
    </div>
    <a class="headerlink" href="#URRobot.tcp_id"></a>
    
    

                            </div>
                            <div id="URRobot.step" class="classattr">
                                        <input id="URRobot.step-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">step</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="URRobot.step-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#URRobot.step"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="URRobot.step-54"><a href="#URRobot.step-54"><span class="linenos">54</span></a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="URRobot.step-55"><a href="#URRobot.step-55"><span class="linenos">55</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="URRobot.step-56"><a href="#URRobot.step-56"><span class="linenos">56</span></a><span class="sd">        Perform a step in the controller.</span>
</span><span id="URRobot.step-57"><a href="#URRobot.step-57"><span class="linenos">57</span></a>
</span><span id="URRobot.step-58"><a href="#URRobot.step-58"><span class="linenos">58</span></a><span class="sd">        This method calls the `step()` method of the controller object and</span>
</span><span id="URRobot.step-59"><a href="#URRobot.step-59"><span class="linenos">59</span></a><span class="sd">        before doing so it checks if there are any tasks to be performed in</span>
</span><span id="URRobot.step-60"><a href="#URRobot.step-60"><span class="linenos">60</span></a><span class="sd">        the robot task queue (URRobot._task_queue)</span>
</span><span id="URRobot.step-61"><a href="#URRobot.step-61"><span class="linenos">61</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URRobot.step-62"><a href="#URRobot.step-62"><span class="linenos">62</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_queue</span><span class="p">:</span>
</span><span id="URRobot.step-63"><a href="#URRobot.step-63"><span class="linenos">63</span></a>            <span class="n">task_pose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_queue</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
</span><span id="URRobot.step-64"><a href="#URRobot.step-64"><span class="linenos">64</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_ee_pose</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="n">task_pose</span><span class="p">)</span>
</span><span id="URRobot.step-65"><a href="#URRobot.step-65"><span class="linenos">65</span></a>
</span><span id="URRobot.step-66"><a href="#URRobot.step-66"><span class="linenos">66</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="URRobot.step-67"><a href="#URRobot.step-67"><span class="linenos">67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_ctrl</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform a step in the controller.</p>

<p>This method calls the <code><a href="#URRobot.step">step()</a></code> method of the controller object and
before doing so it checks if there are any tasks to be performed in
the robot task queue (URRobot._task_queue)</p>
</div>


                            </div>
                            <div id="URRobot.controller" class="classattr">
                                        <input id="URRobot.controller-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">controller</span><span class="annotation">: Optional[<a href="../ctrl/base_ctrl.html#BaseController">ctrl.base_ctrl.BaseController</a>]</span>

                <label class="view-source-button" for="URRobot.controller-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#URRobot.controller"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="URRobot.controller-69"><a href="#URRobot.controller-69"><span class="linenos">69</span></a>    <span class="nd">@property</span>
</span><span id="URRobot.controller-70"><a href="#URRobot.controller-70"><span class="linenos">70</span></a>    <span class="k">def</span> <span class="nf">controller</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseController</span><span class="p">]:</span>
</span><span id="URRobot.controller-71"><a href="#URRobot.controller-71"><span class="linenos">71</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_controller</span>
</span></pre></div>


    

                            </div>
                            <div id="URRobot.info" class="classattr">
                                        <input id="URRobot.info-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">info</span><span class="annotation">: <a href="../utils/mj.html#RobotInfo">utils.mj.RobotInfo</a></span>

                <label class="view-source-button" for="URRobot.info-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#URRobot.info"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="URRobot.info-77"><a href="#URRobot.info-77"><span class="linenos">77</span></a>    <span class="nd">@property</span>
</span><span id="URRobot.info-78"><a href="#URRobot.info-78"><span class="linenos">78</span></a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RobotInfo</span><span class="p">:</span>
</span><span id="URRobot.info-79"><a href="#URRobot.info-79"><span class="linenos">79</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span>
</span></pre></div>


            <div class="docstring"><p>Get detailed information about the robot.</p>

<p>This property returns an instance of the <code>RobotInfo</code> class, which provides comprehensive
details about the robot's structure and components. This includes information on the robot's
bodies, joints, actuators, and geometries, among other attributes. The <code>RobotInfo</code> instance
can be used to access various properties such as the number of joints, actuator limits, joint
limits, and more.</p>

<h2 id="returns">Returns</h2>

<p>RobotInfo
    An object containing detailed information about the robot's configuration and components.</p>
</div>


                            </div>
                            <div id="URRobot.data" class="classattr">
                                        <input id="URRobot.data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">data</span><span class="annotation">: mujoco._structs.MjData</span>

                <label class="view-source-button" for="URRobot.data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#URRobot.data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="URRobot.data-81"><a href="#URRobot.data-81"><span class="linenos">81</span></a>    <span class="nd">@property</span>
</span><span id="URRobot.data-82"><a href="#URRobot.data-82"><span class="linenos">82</span></a>    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjData</span><span class="p">:</span>
</span><span id="URRobot.data-83"><a href="#URRobot.data-83"><span class="linenos">83</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</span></pre></div>


            <div class="docstring"><p>Access the current simulation data.</p>

<p>This property provides access to an instance of the <code>MjData</code> class, which contains the dynamic
simulation state. This includes quantities such as joint positions, velocities,
actuator forces, and sensory information. The <code>MjData</code> object is updated at each simulation step
and can be used to inspect the real-time state of the robot during the simulation.</p>

<h2 id="returns">Returns</h2>

<p>mj.MjData
    An object representing the current dynamic state of the simulation.</p>
</div>


                            </div>
                            <div id="URRobot.model" class="classattr">
                                        <input id="URRobot.model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">model</span><span class="annotation">: mujoco._structs.MjModel</span>

                <label class="view-source-button" for="URRobot.model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#URRobot.model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="URRobot.model-85"><a href="#URRobot.model-85"><span class="linenos">85</span></a>    <span class="nd">@property</span>
</span><span id="URRobot.model-86"><a href="#URRobot.model-86"><span class="linenos">86</span></a>    <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjModel</span><span class="p">:</span>
</span><span id="URRobot.model-87"><a href="#URRobot.model-87"><span class="linenos">87</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span>
</span></pre></div>


            <div class="docstring"><p>Access the model of the MuJoCo simulation.</p>

<p>This property returns an instance of the <code>MjModel</code> class, which describes the physical and
mechanical properties of the simulation. The <code>MjModel</code> object contains static information about the
robot such as its kinematic tree, inertial properties, joint and actuator definitions, and geometry
configurations. It is used to define the robot's structure and behavior within the simulation.</p>

<h2 id="returns">Returns</h2>

<p>mj.MjModel
    An object representing the static model of the robot and overall MuJoCo simulation.</p>
</div>


                            </div>
                            <div id="URRobot.name" class="classattr">
                                        <input id="URRobot.name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">name</span><span class="annotation">: str</span>

                <label class="view-source-button" for="URRobot.name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#URRobot.name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="URRobot.name-89"><a href="#URRobot.name-89"><span class="linenos">89</span></a>    <span class="nd">@property</span>
</span><span id="URRobot.name-90"><a href="#URRobot.name-90"><span class="linenos">90</span></a>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="URRobot.name-91"><a href="#URRobot.name-91"><span class="linenos">91</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot_type</span>
</span></pre></div>


            <div class="docstring"><p>Get the name of the robot.</p>

<p>This property returns the name of the robot as a string. The name is typically a unique identifier
used to distinguish between different robots in the simulation environment.</p>

<h2 id="returns">Returns</h2>

<p>str
    The name of the robot as a string.</p>
</div>


                            </div>
                            <div id="URRobot.type" class="classattr">
                                        <input id="URRobot.type-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">type</span><span class="annotation">: str</span>

                <label class="view-source-button" for="URRobot.type-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#URRobot.type"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="URRobot.type-93"><a href="#URRobot.type-93"><span class="linenos"> 93</span></a>    <span class="nd">@property</span>
</span><span id="URRobot.type-94"><a href="#URRobot.type-94"><span class="linenos"> 94</span></a>    <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="URRobot.type-95"><a href="#URRobot.type-95"><span class="linenos"> 95</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="URRobot.type-96"><a href="#URRobot.type-96"><span class="linenos"> 96</span></a><span class="sd">        Get the type of the UR robot.</span>
</span><span id="URRobot.type-97"><a href="#URRobot.type-97"><span class="linenos"> 97</span></a>
</span><span id="URRobot.type-98"><a href="#URRobot.type-98"><span class="linenos"> 98</span></a><span class="sd">        Returns</span>
</span><span id="URRobot.type-99"><a href="#URRobot.type-99"><span class="linenos"> 99</span></a><span class="sd">        ----------</span>
</span><span id="URRobot.type-100"><a href="#URRobot.type-100"><span class="linenos">100</span></a><span class="sd">                Type of the UR robot.</span>
</span><span id="URRobot.type-101"><a href="#URRobot.type-101"><span class="linenos">101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URRobot.type-102"><a href="#URRobot.type-102"><span class="linenos">102</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot_type</span>
</span></pre></div>


            <div class="docstring"><p>Get the type of the UR robot.</p>

<h2 id="returns">Returns</h2>

<pre><code>    Type of the UR robot.
</code></pre>
</div>


                            </div>
                            <div id="URRobot.actuator_values" class="classattr">
                                        <input id="URRobot.actuator_values-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">actuator_values</span><span class="annotation">: List[float]</span>

                <label class="view-source-button" for="URRobot.actuator_values-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#URRobot.actuator_values"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="URRobot.actuator_values-104"><a href="#URRobot.actuator_values-104"><span class="linenos">104</span></a>    <span class="nd">@property</span>
</span><span id="URRobot.actuator_values-105"><a href="#URRobot.actuator_values-105"><span class="linenos">105</span></a>    <span class="k">def</span> <span class="nf">actuator_values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="URRobot.actuator_values-106"><a href="#URRobot.actuator_values-106"><span class="linenos">106</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="URRobot.actuator_values-107"><a href="#URRobot.actuator_values-107"><span class="linenos">107</span></a><span class="sd">        Get the values of the actuators.</span>
</span><span id="URRobot.actuator_values-108"><a href="#URRobot.actuator_values-108"><span class="linenos">108</span></a>
</span><span id="URRobot.actuator_values-109"><a href="#URRobot.actuator_values-109"><span class="linenos">109</span></a><span class="sd">        Returns</span>
</span><span id="URRobot.actuator_values-110"><a href="#URRobot.actuator_values-110"><span class="linenos">110</span></a><span class="sd">        ----------</span>
</span><span id="URRobot.actuator_values-111"><a href="#URRobot.actuator_values-111"><span class="linenos">111</span></a><span class="sd">                List of actuator values.</span>
</span><span id="URRobot.actuator_values-112"><a href="#URRobot.actuator_values-112"><span class="linenos">112</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URRobot.actuator_values-113"><a href="#URRobot.actuator_values-113"><span class="linenos">113</span></a>        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">actuator</span><span class="p">(</span><span class="n">an</span><span class="p">)</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">an</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">actuator_names</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Get the values of the actuators.</p>

<h2 id="returns">Returns</h2>

<pre><code>    List of actuator values.
</code></pre>
</div>


                            </div>
                            <div id="URRobot.w" class="classattr">
                                        <input id="URRobot.w-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">w</span><span class="annotation">: numpy.ndarray</span>

                <label class="view-source-button" for="URRobot.w-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#URRobot.w"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="URRobot.w-115"><a href="#URRobot.w-115"><span class="linenos">115</span></a>    <span class="nd">@property</span>
</span><span id="URRobot.w-116"><a href="#URRobot.w-116"><span class="linenos">116</span></a>    <span class="k">def</span> <span class="nf">w</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="URRobot.w-117"><a href="#URRobot.w-117"><span class="linenos">117</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="URRobot.w-118"><a href="#URRobot.w-118"><span class="linenos">118</span></a><span class="sd">        Get the sensor wrench (force,torque) data from the force and toque sensor.</span>
</span><span id="URRobot.w-119"><a href="#URRobot.w-119"><span class="linenos">119</span></a>
</span><span id="URRobot.w-120"><a href="#URRobot.w-120"><span class="linenos">120</span></a><span class="sd">        Returns</span>
</span><span id="URRobot.w-121"><a href="#URRobot.w-121"><span class="linenos">121</span></a><span class="sd">        ----------</span>
</span><span id="URRobot.w-122"><a href="#URRobot.w-122"><span class="linenos">122</span></a><span class="sd">                np.ndarray: The sensor data as a NumPy array.</span>
</span><span id="URRobot.w-123"><a href="#URRobot.w-123"><span class="linenos">123</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URRobot.w-124"><a href="#URRobot.w-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="URRobot.w-125"><a href="#URRobot.w-125"><span class="linenos">125</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sensor</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/force&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="URRobot.w-126"><a href="#URRobot.w-126"><span class="linenos">126</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sensor</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/torque&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="URRobot.w-127"><a href="#URRobot.w-127"><span class="linenos">127</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Get the sensor wrench (force,torque) data from the force and toque sensor.</p>

<h2 id="returns">Returns</h2>

<pre><code>    np.ndarray: The sensor data as a NumPy array.
</code></pre>
</div>


                            </div>
                            <div id="URRobot.fk" class="classattr">
                                        <input id="URRobot.fk-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fk</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">q</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">spatialmath</span><span class="o">.</span><span class="n">pose3d</span><span class="o">.</span><span class="n">SE3</span>:</span></span>

                <label class="view-source-button" for="URRobot.fk-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#URRobot.fk"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="URRobot.fk-129"><a href="#URRobot.fk-129"><span class="linenos">129</span></a>    <span class="k">def</span> <span class="nf">fk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">sm</span><span class="o">.</span><span class="n">SE3</span><span class="p">:</span>
</span><span id="URRobot.fk-130"><a href="#URRobot.fk-130"><span class="linenos">130</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="URRobot.fk-131"><a href="#URRobot.fk-131"><span class="linenos">131</span></a><span class="sd">        Compute the forward kinematics of the UR robot given joint positions.</span>
</span><span id="URRobot.fk-132"><a href="#URRobot.fk-132"><span class="linenos">132</span></a>
</span><span id="URRobot.fk-133"><a href="#URRobot.fk-133"><span class="linenos">133</span></a><span class="sd">        Args</span>
</span><span id="URRobot.fk-134"><a href="#URRobot.fk-134"><span class="linenos">134</span></a><span class="sd">        ----------</span>
</span><span id="URRobot.fk-135"><a href="#URRobot.fk-135"><span class="linenos">135</span></a><span class="sd">                q (Union[list, np.ndarray]): Joint positions.</span>
</span><span id="URRobot.fk-136"><a href="#URRobot.fk-136"><span class="linenos">136</span></a>
</span><span id="URRobot.fk-137"><a href="#URRobot.fk-137"><span class="linenos">137</span></a><span class="sd">        Returns</span>
</span><span id="URRobot.fk-138"><a href="#URRobot.fk-138"><span class="linenos">138</span></a><span class="sd">        ----------</span>
</span><span id="URRobot.fk-139"><a href="#URRobot.fk-139"><span class="linenos">139</span></a><span class="sd">                sm.SE3: The pose of the end-effector in the base frame.</span>
</span><span id="URRobot.fk-140"><a href="#URRobot.fk-140"><span class="linenos">140</span></a>
</span><span id="URRobot.fk-141"><a href="#URRobot.fk-141"><span class="linenos">141</span></a><span class="sd">        Raises:</span>
</span><span id="URRobot.fk-142"><a href="#URRobot.fk-142"><span class="linenos">142</span></a><span class="sd">                ValueError: If the length of `q` does not match the number of actuators.</span>
</span><span id="URRobot.fk-143"><a href="#URRobot.fk-143"><span class="linenos">143</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URRobot.fk-144"><a href="#URRobot.fk-144"><span class="linenos">144</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">n_actuators</span><span class="p">:</span>
</span><span id="URRobot.fk-145"><a href="#URRobot.fk-145"><span class="linenos">145</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="URRobot.fk-146"><a href="#URRobot.fk-146"><span class="linenos">146</span></a>                <span class="sa">f</span><span class="s2">&quot;Length of q should be </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">n_actuators</span><span class="si">}</span><span class="s2">, q had length </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="URRobot.fk-147"><a href="#URRobot.fk-147"><span class="linenos">147</span></a>            <span class="p">)</span>
</span><span id="URRobot.fk-148"><a href="#URRobot.fk-148"><span class="linenos">148</span></a>
</span><span id="URRobot.fk-149"><a href="#URRobot.fk-149"><span class="linenos">149</span></a>        <span class="c1"># save the original state before performing forward kinematics</span>
</span><span id="URRobot.fk-150"><a href="#URRobot.fk-150"><span class="linenos">150</span></a>        <span class="n">q0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span>
</span><span id="URRobot.fk-151"><a href="#URRobot.fk-151"><span class="linenos">151</span></a>        <span class="p">[</span>
</span><span id="URRobot.fk-152"><a href="#URRobot.fk-152"><span class="linenos">152</span></a>            <span class="n">set_joint_q</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">jn</span><span class="p">,</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="URRobot.fk-153"><a href="#URRobot.fk-153"><span class="linenos">153</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">jn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">joint_names</span><span class="p">)</span>
</span><span id="URRobot.fk-154"><a href="#URRobot.fk-154"><span class="linenos">154</span></a>        <span class="p">]</span>
</span><span id="URRobot.fk-155"><a href="#URRobot.fk-155"><span class="linenos">155</span></a>
</span><span id="URRobot.fk-156"><a href="#URRobot.fk-156"><span class="linenos">156</span></a>        <span class="c1"># compute forward kinematics</span>
</span><span id="URRobot.fk-157"><a href="#URRobot.fk-157"><span class="linenos">157</span></a>        <span class="n">mj</span><span class="o">.</span><span class="n">mj_kinematics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="URRobot.fk-158"><a href="#URRobot.fk-158"><span class="linenos">158</span></a>
</span><span id="URRobot.fk-159"><a href="#URRobot.fk-159"><span class="linenos">159</span></a>        <span class="c1"># build tcp pose in base frame</span>
</span><span id="URRobot.fk-160"><a href="#URRobot.fk-160"><span class="linenos">160</span></a>        <span class="n">T_world_tcp</span> <span class="o">=</span> <span class="n">get_pose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcp_id</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">SITE</span><span class="p">)</span>
</span><span id="URRobot.fk-161"><a href="#URRobot.fk-161"><span class="linenos">161</span></a>
</span><span id="URRobot.fk-162"><a href="#URRobot.fk-162"><span class="linenos">162</span></a>        <span class="n">T_base_tcp</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="URRobot.fk-163"><a href="#URRobot.fk-163"><span class="linenos">163</span></a>            <span class="n">get_pose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/base&quot;</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">BODY</span><span class="p">)</span><span class="o">.</span><span class="n">inv</span><span class="p">()</span>
</span><span id="URRobot.fk-164"><a href="#URRobot.fk-164"><span class="linenos">164</span></a>            <span class="o">@</span> <span class="n">T_world_tcp</span>
</span><span id="URRobot.fk-165"><a href="#URRobot.fk-165"><span class="linenos">165</span></a>        <span class="p">)</span>
</span><span id="URRobot.fk-166"><a href="#URRobot.fk-166"><span class="linenos">166</span></a>
</span><span id="URRobot.fk-167"><a href="#URRobot.fk-167"><span class="linenos">167</span></a>        <span class="c1"># return to pre- forward kinematics state</span>
</span><span id="URRobot.fk-168"><a href="#URRobot.fk-168"><span class="linenos">168</span></a>        <span class="p">[</span>
</span><span id="URRobot.fk-169"><a href="#URRobot.fk-169"><span class="linenos">169</span></a>            <span class="n">set_joint_q</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">jn</span><span class="p">,</span> <span class="n">q0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="URRobot.fk-170"><a href="#URRobot.fk-170"><span class="linenos">170</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">jn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">joint_names</span><span class="p">)</span>
</span><span id="URRobot.fk-171"><a href="#URRobot.fk-171"><span class="linenos">171</span></a>        <span class="p">]</span>
</span><span id="URRobot.fk-172"><a href="#URRobot.fk-172"><span class="linenos">172</span></a>
</span><span id="URRobot.fk-173"><a href="#URRobot.fk-173"><span class="linenos">173</span></a>        <span class="k">return</span> <span class="n">T_base_tcp</span>
</span></pre></div>


            <div class="docstring"><p>Compute the forward kinematics of the UR robot given joint positions.</p>

<h2 id="args">Args</h2>

<pre><code>    q (Union[list, np.ndarray]): Joint positions.
</code></pre>

<h2 id="returns">Returns</h2>

<pre><code>    sm.SE3: The pose of the end-effector in the base frame.
</code></pre>

<p>Raises:
        ValueError: If the length of <code><a href="#URRobot.q">q</a></code> does not match the number of actuators.</p>
</div>


                            </div>
                            <div id="URRobot.ik" class="classattr">
                                        <input id="URRobot.ik-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ik</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">T</span><span class="p">:</span> <span class="n">spatialmath</span><span class="o">.</span><span class="n">pose3d</span><span class="o">.</span><span class="n">SE3</span>,</span><span class="param">	<span class="nb">iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">iter_interpolation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>,</span><span class="param">	<span class="n">epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-06</span>,</span><span class="param">	<span class="n">radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="URRobot.ik-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#URRobot.ik"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="URRobot.ik-175"><a href="#URRobot.ik-175"><span class="linenos">175</span></a>    <span class="k">def</span> <span class="nf">ik</span><span class="p">(</span>
</span><span id="URRobot.ik-176"><a href="#URRobot.ik-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="URRobot.ik-177"><a href="#URRobot.ik-177"><span class="linenos">177</span></a>        <span class="n">T</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">SE3</span><span class="p">,</span>
</span><span id="URRobot.ik-178"><a href="#URRobot.ik-178"><span class="linenos">178</span></a>        <span class="nb">iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="URRobot.ik-179"><a href="#URRobot.ik-179"><span class="linenos">179</span></a>        <span class="n">iter_interpolation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="URRobot.ik-180"><a href="#URRobot.ik-180"><span class="linenos">180</span></a>        <span class="n">epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
</span><span id="URRobot.ik-181"><a href="#URRobot.ik-181"><span class="linenos">181</span></a>        <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>
</span><span id="URRobot.ik-182"><a href="#URRobot.ik-182"><span class="linenos">182</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
</span><span id="URRobot.ik-183"><a href="#URRobot.ik-183"><span class="linenos">183</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="URRobot.ik-184"><a href="#URRobot.ik-184"><span class="linenos">184</span></a><span class="sd">        Compute the inverse kinematics for the given target pose.</span>
</span><span id="URRobot.ik-185"><a href="#URRobot.ik-185"><span class="linenos">185</span></a>
</span><span id="URRobot.ik-186"><a href="#URRobot.ik-186"><span class="linenos">186</span></a><span class="sd">        This function calculates the joint angles required to achieve the specified</span>
</span><span id="URRobot.ik-187"><a href="#URRobot.ik-187"><span class="linenos">187</span></a><span class="sd">        end-effector pose using inverse kinematics. It uses an analytic Jacobian</span>
</span><span id="URRobot.ik-188"><a href="#URRobot.ik-188"><span class="linenos">188</span></a><span class="sd">        and residual function to iteratively solve for the joint angles that minimize</span>
</span><span id="URRobot.ik-189"><a href="#URRobot.ik-189"><span class="linenos">189</span></a><span class="sd">        the difference between the current end-effector pose and the target pose.</span>
</span><span id="URRobot.ik-190"><a href="#URRobot.ik-190"><span class="linenos">190</span></a>
</span><span id="URRobot.ik-191"><a href="#URRobot.ik-191"><span class="linenos">191</span></a><span class="sd">        Args:</span>
</span><span id="URRobot.ik-192"><a href="#URRobot.ik-192"><span class="linenos">192</span></a><span class="sd">        ----------</span>
</span><span id="URRobot.ik-193"><a href="#URRobot.ik-193"><span class="linenos">193</span></a><span class="sd">        T : sm.SE3</span>
</span><span id="URRobot.ik-194"><a href="#URRobot.ik-194"><span class="linenos">194</span></a><span class="sd">            The target pose for the end-effector, represented as a transformation matrix.</span>
</span><span id="URRobot.ik-195"><a href="#URRobot.ik-195"><span class="linenos">195</span></a><span class="sd">        iter : int</span>
</span><span id="URRobot.ik-196"><a href="#URRobot.ik-196"><span class="linenos">196</span></a><span class="sd">            Maximum number of iterations for the solver.</span>
</span><span id="URRobot.ik-197"><a href="#URRobot.ik-197"><span class="linenos">197</span></a><span class="sd">        epsilon : float</span>
</span><span id="URRobot.ik-198"><a href="#URRobot.ik-198"><span class="linenos">198</span></a><span class="sd">            Convergence threshold for the distance measure.</span>
</span><span id="URRobot.ik-199"><a href="#URRobot.ik-199"><span class="linenos">199</span></a>
</span><span id="URRobot.ik-200"><a href="#URRobot.ik-200"><span class="linenos">200</span></a><span class="sd">        Returns:</span>
</span><span id="URRobot.ik-201"><a href="#URRobot.ik-201"><span class="linenos">201</span></a><span class="sd">        ----------</span>
</span><span id="URRobot.ik-202"><a href="#URRobot.ik-202"><span class="linenos">202</span></a><span class="sd">        Tuple[np.ndarray, bool]</span>
</span><span id="URRobot.ik-203"><a href="#URRobot.ik-203"><span class="linenos">203</span></a><span class="sd">            The joint angles that achieve the target pose and a boolean indicating if the pose was reachable.</span>
</span><span id="URRobot.ik-204"><a href="#URRobot.ik-204"><span class="linenos">204</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URRobot.ik-205"><a href="#URRobot.ik-205"><span class="linenos">205</span></a>
</span><span id="URRobot.ik-206"><a href="#URRobot.ik-206"><span class="linenos">206</span></a>        <span class="k">def</span> <span class="nf">ik_jac</span><span class="p">(</span>
</span><span id="URRobot.ik-207"><a href="#URRobot.ik-207"><span class="linenos">207</span></a>            <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="URRobot.ik-208"><a href="#URRobot.ik-208"><span class="linenos">208</span></a>            <span class="n">res</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="URRobot.ik-209"><a href="#URRobot.ik-209"><span class="linenos">209</span></a>            <span class="n">pos</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="URRobot.ik-210"><a href="#URRobot.ik-210"><span class="linenos">210</span></a>            <span class="n">quat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="URRobot.ik-211"><a href="#URRobot.ik-211"><span class="linenos">211</span></a>            <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.04</span><span class="p">,</span>
</span><span id="URRobot.ik-212"><a href="#URRobot.ik-212"><span class="linenos">212</span></a>            <span class="n">reg</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
</span><span id="URRobot.ik-213"><a href="#URRobot.ik-213"><span class="linenos">213</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="URRobot.ik-214"><a href="#URRobot.ik-214"><span class="linenos">214</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Analytic Jacobian of inverse kinematics residual</span>
</span><span id="URRobot.ik-215"><a href="#URRobot.ik-215"><span class="linenos">215</span></a>
</span><span id="URRobot.ik-216"><a href="#URRobot.ik-216"><span class="linenos">216</span></a><span class="sd">            Args:</span>
</span><span id="URRobot.ik-217"><a href="#URRobot.ik-217"><span class="linenos">217</span></a><span class="sd">                x: joint angles.</span>
</span><span id="URRobot.ik-218"><a href="#URRobot.ik-218"><span class="linenos">218</span></a><span class="sd">                pos: target position for the end effector.</span>
</span><span id="URRobot.ik-219"><a href="#URRobot.ik-219"><span class="linenos">219</span></a><span class="sd">                quat: target orientation for the end effector.</span>
</span><span id="URRobot.ik-220"><a href="#URRobot.ik-220"><span class="linenos">220</span></a><span class="sd">                radius: scaling of the 3D cross.</span>
</span><span id="URRobot.ik-221"><a href="#URRobot.ik-221"><span class="linenos">221</span></a>
</span><span id="URRobot.ik-222"><a href="#URRobot.ik-222"><span class="linenos">222</span></a><span class="sd">            Returns:</span>
</span><span id="URRobot.ik-223"><a href="#URRobot.ik-223"><span class="linenos">223</span></a><span class="sd">                The Jacobian of the Inverse Kinematics task.</span>
</span><span id="URRobot.ik-224"><a href="#URRobot.ik-224"><span class="linenos">224</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="URRobot.ik-225"><a href="#URRobot.ik-225"><span class="linenos">225</span></a>            <span class="c1"># least_squares() passes the value of the residual at x which is sometimes</span>
</span><span id="URRobot.ik-226"><a href="#URRobot.ik-226"><span class="linenos">226</span></a>            <span class="c1"># useful, but we don&#39;t need it here.</span>
</span><span id="URRobot.ik-227"><a href="#URRobot.ik-227"><span class="linenos">227</span></a>            <span class="k">del</span> <span class="n">res</span>
</span><span id="URRobot.ik-228"><a href="#URRobot.ik-228"><span class="linenos">228</span></a>
</span><span id="URRobot.ik-229"><a href="#URRobot.ik-229"><span class="linenos">229</span></a>            <span class="n">T</span> <span class="o">=</span> <span class="n">make_tf</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">ori</span><span class="o">=</span><span class="n">quat</span><span class="p">)</span>
</span><span id="URRobot.ik-230"><a href="#URRobot.ik-230"><span class="linenos">230</span></a>
</span><span id="URRobot.ik-231"><a href="#URRobot.ik-231"><span class="linenos">231</span></a>            <span class="c1"># Call mj_kinematics and mj_comPos (required for Jacobians).</span>
</span><span id="URRobot.ik-232"><a href="#URRobot.ik-232"><span class="linenos">232</span></a>            <span class="n">mujoco</span><span class="o">.</span><span class="n">mj_kinematics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="URRobot.ik-233"><a href="#URRobot.ik-233"><span class="linenos">233</span></a>            <span class="n">mujoco</span><span class="o">.</span><span class="n">mj_comPos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="URRobot.ik-234"><a href="#URRobot.ik-234"><span class="linenos">234</span></a>
</span><span id="URRobot.ik-235"><a href="#URRobot.ik-235"><span class="linenos">235</span></a>            <span class="c1"># Get Deffector, the 3x3 mju_subquat Jacobian</span>
</span><span id="URRobot.ik-236"><a href="#URRobot.ik-236"><span class="linenos">236</span></a>            <span class="n">effector_quat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span id="URRobot.ik-237"><a href="#URRobot.ik-237"><span class="linenos">237</span></a>
</span><span id="URRobot.ik-238"><a href="#URRobot.ik-238"><span class="linenos">238</span></a>            <span class="n">mujoco</span><span class="o">.</span><span class="n">mju_mat2Quat</span><span class="p">(</span><span class="n">effector_quat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ee_pose</span><span class="p">()</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="URRobot.ik-239"><a href="#URRobot.ik-239"><span class="linenos">239</span></a>            <span class="n">target_quat</span> <span class="o">=</span> <span class="n">smb</span><span class="o">.</span><span class="n">r2q</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
</span><span id="URRobot.ik-240"><a href="#URRobot.ik-240"><span class="linenos">240</span></a>            <span class="c1"># target_quat =  data.body(&quot;target&quot;).xquat</span>
</span><span id="URRobot.ik-241"><a href="#URRobot.ik-241"><span class="linenos">241</span></a>            <span class="n">Deffector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="URRobot.ik-242"><a href="#URRobot.ik-242"><span class="linenos">242</span></a>            <span class="n">mujoco</span><span class="o">.</span><span class="n">mjd_subQuat</span><span class="p">(</span><span class="n">target_quat</span><span class="p">,</span> <span class="n">effector_quat</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Deffector</span><span class="p">)</span>
</span><span id="URRobot.ik-243"><a href="#URRobot.ik-243"><span class="linenos">243</span></a>
</span><span id="URRobot.ik-244"><a href="#URRobot.ik-244"><span class="linenos">244</span></a>            <span class="c1"># Rotate into target frame, multiply by subQuat Jacobian, scale by radius.</span>
</span><span id="URRobot.ik-245"><a href="#URRobot.ik-245"><span class="linenos">245</span></a>            <span class="n">target_mat</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">R</span>
</span><span id="URRobot.ik-246"><a href="#URRobot.ik-246"><span class="linenos">246</span></a>            <span class="n">mat</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">Deffector</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">target_mat</span><span class="o">.</span><span class="n">T</span>
</span><span id="URRobot.ik-247"><a href="#URRobot.ik-247"><span class="linenos">247</span></a>            <span class="n">Jo</span> <span class="o">=</span> <span class="n">mat</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">Jo</span>
</span><span id="URRobot.ik-248"><a href="#URRobot.ik-248"><span class="linenos">248</span></a>
</span><span id="URRobot.ik-249"><a href="#URRobot.ik-249"><span class="linenos">249</span></a>            <span class="c1"># Regularization Jacobian.</span>
</span><span id="URRobot.ik-250"><a href="#URRobot.ik-250"><span class="linenos">250</span></a>            <span class="n">Jr</span> <span class="o">=</span> <span class="n">reg</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">n_joints</span><span class="p">)</span>
</span><span id="URRobot.ik-251"><a href="#URRobot.ik-251"><span class="linenos">251</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Jp</span><span class="p">,</span> <span class="n">Jo</span><span class="p">,</span> <span class="n">Jr</span><span class="p">))</span>
</span><span id="URRobot.ik-252"><a href="#URRobot.ik-252"><span class="linenos">252</span></a>
</span><span id="URRobot.ik-253"><a href="#URRobot.ik-253"><span class="linenos">253</span></a>        <span class="k">def</span> <span class="nf">ik_res</span><span class="p">(</span>
</span><span id="URRobot.ik-254"><a href="#URRobot.ik-254"><span class="linenos">254</span></a>            <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="URRobot.ik-255"><a href="#URRobot.ik-255"><span class="linenos">255</span></a>            <span class="n">pos</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="URRobot.ik-256"><a href="#URRobot.ik-256"><span class="linenos">256</span></a>            <span class="n">quat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="URRobot.ik-257"><a href="#URRobot.ik-257"><span class="linenos">257</span></a>            <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.04</span><span class="p">,</span>
</span><span id="URRobot.ik-258"><a href="#URRobot.ik-258"><span class="linenos">258</span></a>            <span class="n">reg</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
</span><span id="URRobot.ik-259"><a href="#URRobot.ik-259"><span class="linenos">259</span></a>            <span class="n">reg_target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="URRobot.ik-260"><a href="#URRobot.ik-260"><span class="linenos">260</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="URRobot.ik-261"><a href="#URRobot.ik-261"><span class="linenos">261</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Residual for inverse kinematics.</span>
</span><span id="URRobot.ik-262"><a href="#URRobot.ik-262"><span class="linenos">262</span></a>
</span><span id="URRobot.ik-263"><a href="#URRobot.ik-263"><span class="linenos">263</span></a><span class="sd">            Args:</span>
</span><span id="URRobot.ik-264"><a href="#URRobot.ik-264"><span class="linenos">264</span></a><span class="sd">                x: joint angles.</span>
</span><span id="URRobot.ik-265"><a href="#URRobot.ik-265"><span class="linenos">265</span></a><span class="sd">                pos: target position for the end effector.</span>
</span><span id="URRobot.ik-266"><a href="#URRobot.ik-266"><span class="linenos">266</span></a><span class="sd">                quat: target orientation for the end effector.</span>
</span><span id="URRobot.ik-267"><a href="#URRobot.ik-267"><span class="linenos">267</span></a><span class="sd">                radius: scaling of the 3D cross.</span>
</span><span id="URRobot.ik-268"><a href="#URRobot.ik-268"><span class="linenos">268</span></a>
</span><span id="URRobot.ik-269"><a href="#URRobot.ik-269"><span class="linenos">269</span></a><span class="sd">            Returns:</span>
</span><span id="URRobot.ik-270"><a href="#URRobot.ik-270"><span class="linenos">270</span></a><span class="sd">                The residual of the Inverse Kinematics task.</span>
</span><span id="URRobot.ik-271"><a href="#URRobot.ik-271"><span class="linenos">271</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="URRobot.ik-272"><a href="#URRobot.ik-272"><span class="linenos">272</span></a>
</span><span id="URRobot.ik-273"><a href="#URRobot.ik-273"><span class="linenos">273</span></a>            <span class="n">T</span> <span class="o">=</span> <span class="n">make_tf</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">ori</span><span class="o">=</span><span class="n">quat</span><span class="p">)</span>
</span><span id="URRobot.ik-274"><a href="#URRobot.ik-274"><span class="linenos">274</span></a>
</span><span id="URRobot.ik-275"><a href="#URRobot.ik-275"><span class="linenos">275</span></a>            <span class="c1"># Set qpos, compute forward kinematics.</span>
</span><span id="URRobot.ik-276"><a href="#URRobot.ik-276"><span class="linenos">276</span></a>            <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="URRobot.ik-277"><a href="#URRobot.ik-277"><span class="linenos">277</span></a>
</span><span id="URRobot.ik-278"><a href="#URRobot.ik-278"><span class="linenos">278</span></a>            <span class="p">[</span>
</span><span id="URRobot.ik-279"><a href="#URRobot.ik-279"><span class="linenos">279</span></a>                <span class="n">set_joint_q</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">joint_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="URRobot.ik-280"><a href="#URRobot.ik-280"><span class="linenos">280</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="URRobot.ik-281"><a href="#URRobot.ik-281"><span class="linenos">281</span></a>            <span class="p">]</span>
</span><span id="URRobot.ik-282"><a href="#URRobot.ik-282"><span class="linenos">282</span></a>            <span class="n">mujoco</span><span class="o">.</span><span class="n">mj_kinematics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="URRobot.ik-283"><a href="#URRobot.ik-283"><span class="linenos">283</span></a>
</span><span id="URRobot.ik-284"><a href="#URRobot.ik-284"><span class="linenos">284</span></a>            <span class="c1"># Position residual.</span>
</span><span id="URRobot.ik-285"><a href="#URRobot.ik-285"><span class="linenos">285</span></a>            <span class="c1"># res_pos = T.t - self.get_ee_pose().t</span>
</span><span id="URRobot.ik-286"><a href="#URRobot.ik-286"><span class="linenos">286</span></a>            <span class="n">res_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ee_pose</span><span class="p">()</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">T</span><span class="o">.</span><span class="n">t</span>
</span><span id="URRobot.ik-287"><a href="#URRobot.ik-287"><span class="linenos">287</span></a>
</span><span id="URRobot.ik-288"><a href="#URRobot.ik-288"><span class="linenos">288</span></a>            <span class="c1"># Effector quat, use mju_mat2quat.</span>
</span><span id="URRobot.ik-289"><a href="#URRobot.ik-289"><span class="linenos">289</span></a>            <span class="n">effector_quat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span id="URRobot.ik-290"><a href="#URRobot.ik-290"><span class="linenos">290</span></a>            <span class="n">mujoco</span><span class="o">.</span><span class="n">mju_mat2Quat</span><span class="p">(</span><span class="n">effector_quat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ee_pose</span><span class="p">()</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="URRobot.ik-291"><a href="#URRobot.ik-291"><span class="linenos">291</span></a>            <span class="c1"># mujoco.mju_mat2Quat(effector_quat, data.site(&quot;effector&quot;).xmat)</span>
</span><span id="URRobot.ik-292"><a href="#URRobot.ik-292"><span class="linenos">292</span></a>
</span><span id="URRobot.ik-293"><a href="#URRobot.ik-293"><span class="linenos">293</span></a>            <span class="c1"># Target quat, exploit the fact that the site is aligned with the body.</span>
</span><span id="URRobot.ik-294"><a href="#URRobot.ik-294"><span class="linenos">294</span></a>            <span class="n">target_quat</span> <span class="o">=</span> <span class="n">smb</span><span class="o">.</span><span class="n">r2q</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
</span><span id="URRobot.ik-295"><a href="#URRobot.ik-295"><span class="linenos">295</span></a>            <span class="c1"># target_quat = data.body(&quot;target&quot;).xquat</span>
</span><span id="URRobot.ik-296"><a href="#URRobot.ik-296"><span class="linenos">296</span></a>
</span><span id="URRobot.ik-297"><a href="#URRobot.ik-297"><span class="linenos">297</span></a>            <span class="c1"># Orientation residual: quaternion difference.</span>
</span><span id="URRobot.ik-298"><a href="#URRobot.ik-298"><span class="linenos">298</span></a>            <span class="n">res_quat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="URRobot.ik-299"><a href="#URRobot.ik-299"><span class="linenos">299</span></a>            <span class="n">mujoco</span><span class="o">.</span><span class="n">mju_subQuat</span><span class="p">(</span><span class="n">res_quat</span><span class="p">,</span> <span class="n">target_quat</span><span class="p">,</span> <span class="n">effector_quat</span><span class="p">)</span>
</span><span id="URRobot.ik-300"><a href="#URRobot.ik-300"><span class="linenos">300</span></a>            <span class="n">res_quat</span> <span class="o">*=</span> <span class="n">radius</span>
</span><span id="URRobot.ik-301"><a href="#URRobot.ik-301"><span class="linenos">301</span></a>
</span><span id="URRobot.ik-302"><a href="#URRobot.ik-302"><span class="linenos">302</span></a>            <span class="c1"># Regularization residual.</span>
</span><span id="URRobot.ik-303"><a href="#URRobot.ik-303"><span class="linenos">303</span></a>            <span class="n">reg_target</span> <span class="o">=</span> <span class="n">q0_init</span> <span class="k">if</span> <span class="n">reg_target</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">reg_target</span>
</span><span id="URRobot.ik-304"><a href="#URRobot.ik-304"><span class="linenos">304</span></a>            <span class="n">res_reg</span> <span class="o">=</span> <span class="n">reg</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">-</span> <span class="n">reg_target</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="URRobot.ik-305"><a href="#URRobot.ik-305"><span class="linenos">305</span></a>
</span><span id="URRobot.ik-306"><a href="#URRobot.ik-306"><span class="linenos">306</span></a>            <span class="n">res_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">res_pos</span><span class="p">,</span> <span class="n">res_quat</span><span class="p">,</span> <span class="n">res_reg</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
</span><span id="URRobot.ik-307"><a href="#URRobot.ik-307"><span class="linenos">307</span></a>
</span><span id="URRobot.ik-308"><a href="#URRobot.ik-308"><span class="linenos">308</span></a>            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">res_i</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="URRobot.ik-309"><a href="#URRobot.ik-309"><span class="linenos">309</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</span><span id="URRobot.ik-310"><a href="#URRobot.ik-310"><span class="linenos">310</span></a>
</span><span id="URRobot.ik-311"><a href="#URRobot.ik-311"><span class="linenos">311</span></a>        <span class="k">def</span> <span class="nf">distance_measure</span><span class="p">(</span><span class="n">pos_error</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">ori_error</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="URRobot.ik-312"><a href="#URRobot.ik-312"><span class="linenos">312</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Compute the distance measure for convergence.&quot;&quot;&quot;</span>
</span><span id="URRobot.ik-313"><a href="#URRobot.ik-313"><span class="linenos">313</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">pos_error</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">ori_error</span><span class="p">)</span>
</span><span id="URRobot.ik-314"><a href="#URRobot.ik-314"><span class="linenos">314</span></a>
</span><span id="URRobot.ik-315"><a href="#URRobot.ik-315"><span class="linenos">315</span></a>        <span class="c1"># Define IK problem</span>
</span><span id="URRobot.ik-316"><a href="#URRobot.ik-316"><span class="linenos">316</span></a>        <span class="c1"># https://colab.research.google.com/github/google-deepmind/mujoco/blob/main/python/least_squares.ipynb#scrollTo=mfhCxqQiio5l</span>
</span><span id="URRobot.ik-317"><a href="#URRobot.ik-317"><span class="linenos">317</span></a>
</span><span id="URRobot.ik-318"><a href="#URRobot.ik-318"><span class="linenos">318</span></a>        <span class="n">pos</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">t</span>
</span><span id="URRobot.ik-319"><a href="#URRobot.ik-319"><span class="linenos">319</span></a>        <span class="n">quat</span> <span class="o">=</span> <span class="n">smb</span><span class="o">.</span><span class="n">r2q</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
</span><span id="URRobot.ik-320"><a href="#URRobot.ik-320"><span class="linenos">320</span></a>        <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">joint_limits</span>
</span><span id="URRobot.ik-321"><a href="#URRobot.ik-321"><span class="linenos">321</span></a>        <span class="n">q0_init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span>
</span><span id="URRobot.ik-322"><a href="#URRobot.ik-322"><span class="linenos">322</span></a>        <span class="n">q0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span>
</span><span id="URRobot.ik-323"><a href="#URRobot.ik-323"><span class="linenos">323</span></a>        <span class="n">converged</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="URRobot.ik-324"><a href="#URRobot.ik-324"><span class="linenos">324</span></a>        <span class="n">q_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
</span><span id="URRobot.ik-325"><a href="#URRobot.ik-325"><span class="linenos">325</span></a>
</span><span id="URRobot.ik-326"><a href="#URRobot.ik-326"><span class="linenos">326</span></a>        <span class="n">_T</span> <span class="o">=</span> <span class="n">ctraj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_ee_pose</span><span class="p">(),</span> <span class="n">T</span><span class="p">,</span> <span class="n">iter_interpolation</span><span class="p">)</span>
</span><span id="URRobot.ik-327"><a href="#URRobot.ik-327"><span class="linenos">327</span></a>
</span><span id="URRobot.ik-328"><a href="#URRobot.ik-328"><span class="linenos">328</span></a>        <span class="n">t0</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</span><span id="URRobot.ik-329"><a href="#URRobot.ik-329"><span class="linenos">329</span></a>
</span><span id="URRobot.ik-330"><a href="#URRobot.ik-330"><span class="linenos">330</span></a>        <span class="k">for</span> <span class="n">Ti</span> <span class="ow">in</span> <span class="n">_T</span><span class="p">:</span>
</span><span id="URRobot.ik-331"><a href="#URRobot.ik-331"><span class="linenos">331</span></a>            <span class="n">pos</span> <span class="o">=</span> <span class="n">Ti</span><span class="o">.</span><span class="n">t</span>
</span><span id="URRobot.ik-332"><a href="#URRobot.ik-332"><span class="linenos">332</span></a>            <span class="n">quat</span> <span class="o">=</span> <span class="n">smb</span><span class="o">.</span><span class="n">r2q</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
</span><span id="URRobot.ik-333"><a href="#URRobot.ik-333"><span class="linenos">333</span></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">iter</span><span class="p">):</span>
</span><span id="URRobot.ik-334"><a href="#URRobot.ik-334"><span class="linenos">334</span></a>                <span class="n">ik_target</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ik_res</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">quat</span><span class="o">=</span><span class="n">quat</span><span class="p">,</span> <span class="n">reg_target</span><span class="o">=</span><span class="n">q0</span><span class="p">)</span>
</span><span id="URRobot.ik-335"><a href="#URRobot.ik-335"><span class="linenos">335</span></a>                <span class="n">jac_target</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">ik_jac</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">quat</span><span class="o">=</span><span class="n">quat</span><span class="p">)</span>
</span><span id="URRobot.ik-336"><a href="#URRobot.ik-336"><span class="linenos">336</span></a>
</span><span id="URRobot.ik-337"><a href="#URRobot.ik-337"><span class="linenos">337</span></a>                <span class="n">q</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">minimize</span><span class="o">.</span><span class="n">least_squares</span><span class="p">(</span>
</span><span id="URRobot.ik-338"><a href="#URRobot.ik-338"><span class="linenos">338</span></a>                    <span class="n">q0</span><span class="p">,</span>
</span><span id="URRobot.ik-339"><a href="#URRobot.ik-339"><span class="linenos">339</span></a>                    <span class="n">ik_target</span><span class="p">,</span>
</span><span id="URRobot.ik-340"><a href="#URRobot.ik-340"><span class="linenos">340</span></a>                    <span class="n">bounds</span><span class="p">,</span>
</span><span id="URRobot.ik-341"><a href="#URRobot.ik-341"><span class="linenos">341</span></a>                    <span class="n">jacobian</span><span class="o">=</span><span class="n">jac_target</span><span class="p">,</span>
</span><span id="URRobot.ik-342"><a href="#URRobot.ik-342"><span class="linenos">342</span></a>                    <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="URRobot.ik-343"><a href="#URRobot.ik-343"><span class="linenos">343</span></a>                <span class="p">)</span>
</span><span id="URRobot.ik-344"><a href="#URRobot.ik-344"><span class="linenos">344</span></a>
</span><span id="URRobot.ik-345"><a href="#URRobot.ik-345"><span class="linenos">345</span></a>                <span class="p">[</span>
</span><span id="URRobot.ik-346"><a href="#URRobot.ik-346"><span class="linenos">346</span></a>                    <span class="n">set_joint_q</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">joint_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">qi</span><span class="p">)</span>
</span><span id="URRobot.ik-347"><a href="#URRobot.ik-347"><span class="linenos">347</span></a>                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">qi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</span><span id="URRobot.ik-348"><a href="#URRobot.ik-348"><span class="linenos">348</span></a>                <span class="p">]</span>
</span><span id="URRobot.ik-349"><a href="#URRobot.ik-349"><span class="linenos">349</span></a>
</span><span id="URRobot.ik-350"><a href="#URRobot.ik-350"><span class="linenos">350</span></a>                <span class="n">mj</span><span class="o">.</span><span class="n">mj_kinematics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="URRobot.ik-351"><a href="#URRobot.ik-351"><span class="linenos">351</span></a>
</span><span id="URRobot.ik-352"><a href="#URRobot.ik-352"><span class="linenos">352</span></a>                <span class="n">pos_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ee_pose</span><span class="p">()</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">pos</span>
</span><span id="URRobot.ik-353"><a href="#URRobot.ik-353"><span class="linenos">353</span></a>                <span class="n">effector_quat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span id="URRobot.ik-354"><a href="#URRobot.ik-354"><span class="linenos">354</span></a>                <span class="n">mujoco</span><span class="o">.</span><span class="n">mju_mat2Quat</span><span class="p">(</span><span class="n">effector_quat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ee_pose</span><span class="p">()</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="URRobot.ik-355"><a href="#URRobot.ik-355"><span class="linenos">355</span></a>                <span class="n">res_quat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="URRobot.ik-356"><a href="#URRobot.ik-356"><span class="linenos">356</span></a>                <span class="n">mujoco</span><span class="o">.</span><span class="n">mju_subQuat</span><span class="p">(</span><span class="n">res_quat</span><span class="p">,</span> <span class="n">quat</span><span class="p">,</span> <span class="n">effector_quat</span><span class="p">)</span>
</span><span id="URRobot.ik-357"><a href="#URRobot.ik-357"><span class="linenos">357</span></a>                <span class="n">res_quat</span> <span class="o">*=</span> <span class="n">radius</span>
</span><span id="URRobot.ik-358"><a href="#URRobot.ik-358"><span class="linenos">358</span></a>                <span class="n">distance</span> <span class="o">=</span> <span class="n">distance_measure</span><span class="p">(</span><span class="n">pos_error</span><span class="p">,</span> <span class="n">res_quat</span><span class="p">)</span>
</span><span id="URRobot.ik-359"><a href="#URRobot.ik-359"><span class="linenos">359</span></a>
</span><span id="URRobot.ik-360"><a href="#URRobot.ik-360"><span class="linenos">360</span></a>                <span class="n">q_error</span> <span class="o">=</span> <span class="n">q</span> <span class="o">-</span> <span class="n">q0</span>
</span><span id="URRobot.ik-361"><a href="#URRobot.ik-361"><span class="linenos">361</span></a>
</span><span id="URRobot.ik-362"><a href="#URRobot.ik-362"><span class="linenos">362</span></a>                <span class="c1"># eval steps and epsilon</span>
</span><span id="URRobot.ik-363"><a href="#URRobot.ik-363"><span class="linenos">363</span></a>                <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">epsilon</span><span class="p">:</span>
</span><span id="URRobot.ik-364"><a href="#URRobot.ik-364"><span class="linenos">364</span></a>                    <span class="n">converged</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="URRobot.ik-365"><a href="#URRobot.ik-365"><span class="linenos">365</span></a>                    <span class="k">break</span>
</span><span id="URRobot.ik-366"><a href="#URRobot.ik-366"><span class="linenos">366</span></a>                <span class="n">q0</span> <span class="o">=</span> <span class="n">q</span>
</span><span id="URRobot.ik-367"><a href="#URRobot.ik-367"><span class="linenos">367</span></a>
</span><span id="URRobot.ik-368"><a href="#URRobot.ik-368"><span class="linenos">368</span></a>        <span class="c1"># reset to current q</span>
</span><span id="URRobot.ik-369"><a href="#URRobot.ik-369"><span class="linenos">369</span></a>        <span class="p">[</span>
</span><span id="URRobot.ik-370"><a href="#URRobot.ik-370"><span class="linenos">370</span></a>            <span class="n">set_joint_q</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">joint_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">q0_init</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="URRobot.ik-371"><a href="#URRobot.ik-371"><span class="linenos">371</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">q0_init</span><span class="p">))</span>
</span><span id="URRobot.ik-372"><a href="#URRobot.ik-372"><span class="linenos">372</span></a>        <span class="p">]</span>
</span><span id="URRobot.ik-373"><a href="#URRobot.ik-373"><span class="linenos">373</span></a>
</span><span id="URRobot.ik-374"><a href="#URRobot.ik-374"><span class="linenos">374</span></a>        <span class="n">time</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
</span><span id="URRobot.ik-375"><a href="#URRobot.ik-375"><span class="linenos">375</span></a>
</span><span id="URRobot.ik-376"><a href="#URRobot.ik-376"><span class="linenos">376</span></a>        <span class="n">t_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fk</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">pos</span>
</span><span id="URRobot.ik-377"><a href="#URRobot.ik-377"><span class="linenos">377</span></a>
</span><span id="URRobot.ik-378"><a href="#URRobot.ik-378"><span class="linenos">378</span></a>        <span class="k">return</span> <span class="n">q</span><span class="p">,</span> <span class="n">converged</span><span class="p">,</span> <span class="n">q_error</span><span class="p">,</span> <span class="n">t_error</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">time</span><span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Compute the inverse kinematics for the given target pose.</p>

<p>This function calculates the joint angles required to achieve the specified
end-effector pose using inverse kinematics. It uses an analytic Jacobian
and residual function to iteratively solve for the joint angles that minimize
the difference between the current end-effector pose and the target pose.</p>

<h2 id="args">Args:</h2>

<p>T : sm.SE3
    The target pose for the end-effector, represented as a transformation matrix.
iter : int
    Maximum number of iterations for the solver.
epsilon : float
    Convergence threshold for the distance measure.</p>

<h2 id="returns">Returns:</h2>

<p>Tuple[np.ndarray, bool]
    The joint angles that achieve the target pose and a boolean indicating if the pose was reachable.</p>
</div>


                            </div>
                            <div id="URRobot.get_ee_pose" class="classattr">
                                        <input id="URRobot.get_ee_pose-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_ee_pose</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">spatialmath</span><span class="o">.</span><span class="n">pose3d</span><span class="o">.</span><span class="n">SE3</span>:</span></span>

                <label class="view-source-button" for="URRobot.get_ee_pose-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#URRobot.get_ee_pose"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="URRobot.get_ee_pose-380"><a href="#URRobot.get_ee_pose-380"><span class="linenos">380</span></a>    <span class="k">def</span> <span class="nf">get_ee_pose</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sm</span><span class="o">.</span><span class="n">SE3</span><span class="p">:</span>
</span><span id="URRobot.get_ee_pose-381"><a href="#URRobot.get_ee_pose-381"><span class="linenos">381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="URRobot.get_ee_pose-382"><a href="#URRobot.get_ee_pose-382"><span class="linenos">382</span></a><span class="sd">        Get the end-effector pose for the UR robot.</span>
</span><span id="URRobot.get_ee_pose-383"><a href="#URRobot.get_ee_pose-383"><span class="linenos">383</span></a>
</span><span id="URRobot.get_ee_pose-384"><a href="#URRobot.get_ee_pose-384"><span class="linenos">384</span></a><span class="sd">        Returns</span>
</span><span id="URRobot.get_ee_pose-385"><a href="#URRobot.get_ee_pose-385"><span class="linenos">385</span></a><span class="sd">        ----------</span>
</span><span id="URRobot.get_ee_pose-386"><a href="#URRobot.get_ee_pose-386"><span class="linenos">386</span></a><span class="sd">                T (sm.SE3): The end-effector pose in the base frame.</span>
</span><span id="URRobot.get_ee_pose-387"><a href="#URRobot.get_ee_pose-387"><span class="linenos">387</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URRobot.get_ee_pose-388"><a href="#URRobot.get_ee_pose-388"><span class="linenos">388</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Get the end-effector pose for the UR robot.</p>

<h2 id="returns">Returns</h2>

<pre><code>    T (sm.SE3): The end-effector pose in the base frame.
</code></pre>
</div>


                            </div>
                            <div id="URRobot.set_ee_pose" class="classattr">
                                        <input id="URRobot.set_ee_pose-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_ee_pose</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">T</span><span class="p">:</span> <span class="n">spatialmath</span><span class="o">.</span><span class="n">pose3d</span><span class="o">.</span><span class="n">SE3</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="URRobot.set_ee_pose-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#URRobot.set_ee_pose"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="URRobot.set_ee_pose-390"><a href="#URRobot.set_ee_pose-390"><span class="linenos">390</span></a>    <span class="k">def</span> <span class="nf">set_ee_pose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">SE3</span><span class="p">):</span>
</span><span id="URRobot.set_ee_pose-391"><a href="#URRobot.set_ee_pose-391"><span class="linenos">391</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="URRobot.set_ee_pose-392"><a href="#URRobot.set_ee_pose-392"><span class="linenos">392</span></a><span class="sd">        Set the desired end-effector pose for the UR robot.</span>
</span><span id="URRobot.set_ee_pose-393"><a href="#URRobot.set_ee_pose-393"><span class="linenos">393</span></a>
</span><span id="URRobot.set_ee_pose-394"><a href="#URRobot.set_ee_pose-394"><span class="linenos">394</span></a><span class="sd">        Args</span>
</span><span id="URRobot.set_ee_pose-395"><a href="#URRobot.set_ee_pose-395"><span class="linenos">395</span></a><span class="sd">        ----------</span>
</span><span id="URRobot.set_ee_pose-396"><a href="#URRobot.set_ee_pose-396"><span class="linenos">396</span></a><span class="sd">                T (sm.SE3): The desired end-effector pose in the base frame.</span>
</span><span id="URRobot.set_ee_pose-397"><a href="#URRobot.set_ee_pose-397"><span class="linenos">397</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URRobot.set_ee_pose-398"><a href="#URRobot.set_ee_pose-398"><span class="linenos">398</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">T_target</span> <span class="o">=</span> <span class="n">T</span>
</span></pre></div>


            <div class="docstring"><p>Set the desired end-effector pose for the UR robot.</p>

<h2 id="args">Args</h2>

<pre><code>    T (sm.SE3): The desired end-effector pose in the base frame.
</code></pre>
</div>


                            </div>
                            <div id="URRobot.move_l" class="classattr">
                                        <input id="URRobot.move_l-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">move_l</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">T</span><span class="p">:</span> <span class="n">spatialmath</span><span class="o">.</span><span class="n">pose3d</span><span class="o">.</span><span class="n">SE3</span>,</span><span class="param">	<span class="n">ss</span><span class="p">:</span> <span class="n"><a href="../sims/base_sim.html#SimSync">sims.base_sim.SimSync</a></span>,</span><span class="param">	<span class="n">velocity</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.25</span>,</span><span class="param">	<span class="n">acceleration</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.2</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="URRobot.move_l-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#URRobot.move_l"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="URRobot.move_l-400"><a href="#URRobot.move_l-400"><span class="linenos">400</span></a>    <span class="k">def</span> <span class="nf">move_l</span><span class="p">(</span>
</span><span id="URRobot.move_l-401"><a href="#URRobot.move_l-401"><span class="linenos">401</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="URRobot.move_l-402"><a href="#URRobot.move_l-402"><span class="linenos">402</span></a>        <span class="n">T</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">SE3</span><span class="p">,</span>
</span><span id="URRobot.move_l-403"><a href="#URRobot.move_l-403"><span class="linenos">403</span></a>        <span class="n">ss</span><span class="p">:</span> <span class="n">SimSync</span><span class="p">,</span>
</span><span id="URRobot.move_l-404"><a href="#URRobot.move_l-404"><span class="linenos">404</span></a>        <span class="n">velocity</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
</span><span id="URRobot.move_l-405"><a href="#URRobot.move_l-405"><span class="linenos">405</span></a>        <span class="n">acceleration</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.2</span><span class="p">,</span>
</span><span id="URRobot.move_l-406"><a href="#URRobot.move_l-406"><span class="linenos">406</span></a>    <span class="p">):</span>
</span><span id="URRobot.move_l-407"><a href="#URRobot.move_l-407"><span class="linenos">407</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="URRobot.move_l-408"><a href="#URRobot.move_l-408"><span class="linenos">408</span></a><span class="sd">        Move to a given position in task-space (or cartesian space)</span>
</span><span id="URRobot.move_l-409"><a href="#URRobot.move_l-409"><span class="linenos">409</span></a>
</span><span id="URRobot.move_l-410"><a href="#URRobot.move_l-410"><span class="linenos">410</span></a><span class="sd">        The robot guides the TCP at a defined velocity along a straight path to the end point defined by T.</span>
</span><span id="URRobot.move_l-411"><a href="#URRobot.move_l-411"><span class="linenos">411</span></a>
</span><span id="URRobot.move_l-412"><a href="#URRobot.move_l-412"><span class="linenos">412</span></a><span class="sd">        Args:</span>
</span><span id="URRobot.move_l-413"><a href="#URRobot.move_l-413"><span class="linenos">413</span></a><span class="sd">                T (sm.SE3): The desired end-effector pose in the base frame.</span>
</span><span id="URRobot.move_l-414"><a href="#URRobot.move_l-414"><span class="linenos">414</span></a><span class="sd">                velocity (Union[list, np.ndarray]): tool velocity [m/s]</span>
</span><span id="URRobot.move_l-415"><a href="#URRobot.move_l-415"><span class="linenos">415</span></a><span class="sd">                acceleration (Union[list, np.ndarray]): tool acceleration [m/s^2]</span>
</span><span id="URRobot.move_l-416"><a href="#URRobot.move_l-416"><span class="linenos">416</span></a>
</span><span id="URRobot.move_l-417"><a href="#URRobot.move_l-417"><span class="linenos">417</span></a><span class="sd">        Returns:</span>
</span><span id="URRobot.move_l-418"><a href="#URRobot.move_l-418"><span class="linenos">418</span></a><span class="sd">                success (bool): True if the move succeeds and False otherwise.</span>
</span><span id="URRobot.move_l-419"><a href="#URRobot.move_l-419"><span class="linenos">419</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URRobot.move_l-420"><a href="#URRobot.move_l-420"><span class="linenos">420</span></a>
</span><span id="URRobot.move_l-421"><a href="#URRobot.move_l-421"><span class="linenos">421</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="URRobot.move_l-422"><a href="#URRobot.move_l-422"><span class="linenos">422</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="URRobot.move_l-423"><a href="#URRobot.move_l-423"><span class="linenos">423</span></a><span class="s2">                            You attempted to send a command to the robot without a controller, set a controller </span>
</span><span id="URRobot.move_l-424"><a href="#URRobot.move_l-424"><span class="linenos">424</span></a><span class="s2">                            ur5e.controller = DiffIk(ur5e)</span>
</span><span id="URRobot.move_l-425"><a href="#URRobot.move_l-425"><span class="linenos">425</span></a><span class="s2">                            or</span>
</span><span id="URRobot.move_l-426"><a href="#URRobot.move_l-426"><span class="linenos">426</span></a><span class="s2">                            ur5e.controller = OpSpace(ur5e)</span>
</span><span id="URRobot.move_l-427"><a href="#URRobot.move_l-427"><span class="linenos">427</span></a><span class="s2">                            &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="URRobot.move_l-428"><a href="#URRobot.move_l-428"><span class="linenos">428</span></a>
</span><span id="URRobot.move_l-429"><a href="#URRobot.move_l-429"><span class="linenos">429</span></a>        <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="URRobot.move_l-430"><a href="#URRobot.move_l-430"><span class="linenos">430</span></a>
</span><span id="URRobot.move_l-431"><a href="#URRobot.move_l-431"><span class="linenos">431</span></a>        <span class="c1"># get the tcp pose in base frame</span>
</span><span id="URRobot.move_l-432"><a href="#URRobot.move_l-432"><span class="linenos">432</span></a>        <span class="n">T_base_tcp</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">SE3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
</span><span id="URRobot.move_l-433"><a href="#URRobot.move_l-433"><span class="linenos">433</span></a>        <span class="n">T0</span> <span class="o">=</span> <span class="n">T_base_tcp</span>
</span><span id="URRobot.move_l-434"><a href="#URRobot.move_l-434"><span class="linenos">434</span></a>        <span class="n">T1</span> <span class="o">=</span> <span class="n">T</span>
</span><span id="URRobot.move_l-435"><a href="#URRobot.move_l-435"><span class="linenos">435</span></a>
</span><span id="URRobot.move_l-436"><a href="#URRobot.move_l-436"><span class="linenos">436</span></a>        <span class="c1"># check if current and target is identical within some tolerance and abort if so.</span>
</span><span id="URRobot.move_l-437"><a href="#URRobot.move_l-437"><span class="linenos">437</span></a>        <span class="k">if</span> <span class="n">T0</span> <span class="o">==</span> <span class="n">T1</span><span class="p">:</span>
</span><span id="URRobot.move_l-438"><a href="#URRobot.move_l-438"><span class="linenos">438</span></a>            <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="URRobot.move_l-439"><a href="#URRobot.move_l-439"><span class="linenos">439</span></a>            <span class="k">return</span> <span class="n">success</span>
</span><span id="URRobot.move_l-440"><a href="#URRobot.move_l-440"><span class="linenos">440</span></a>
</span><span id="URRobot.move_l-441"><a href="#URRobot.move_l-441"><span class="linenos">441</span></a>        <span class="c1"># calculate trajectory duration based on provided velocity and difference of SE(3) matrices as differential motion.</span>
</span><span id="URRobot.move_l-442"><a href="#URRobot.move_l-442"><span class="linenos">442</span></a>        <span class="n">delta</span> <span class="o">=</span> <span class="n">T0</span><span class="o">.</span><span class="n">delta</span><span class="p">(</span><span class="n">T1</span><span class="p">)</span>
</span><span id="URRobot.move_l-443"><a href="#URRobot.move_l-443"><span class="linenos">443</span></a>        <span class="n">duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">/</span> <span class="n">velocity</span>
</span><span id="URRobot.move_l-444"><a href="#URRobot.move_l-444"><span class="linenos">444</span></a>
</span><span id="URRobot.move_l-445"><a href="#URRobot.move_l-445"><span class="linenos">445</span></a>        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="URRobot.move_l-446"><a href="#URRobot.move_l-446"><span class="linenos">446</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="URRobot.move_l-447"><a href="#URRobot.move_l-447"><span class="linenos">447</span></a>                <span class="s2">&quot;&gt; performing move_l:</span><span class="se">\n</span><span class="s2">  from:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="URRobot.move_l-448"><a href="#URRobot.move_l-448"><span class="linenos">448</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">T0</span><span class="p">)</span>
</span><span id="URRobot.move_l-449"><a href="#URRobot.move_l-449"><span class="linenos">449</span></a>                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  to:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="URRobot.move_l-450"><a href="#URRobot.move_l-450"><span class="linenos">450</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">T1</span><span class="p">)</span>
</span><span id="URRobot.move_l-451"><a href="#URRobot.move_l-451"><span class="linenos">451</span></a>                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  duration:</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="URRobot.move_l-452"><a href="#URRobot.move_l-452"><span class="linenos">452</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">duration</span><span class="p">))</span>
</span><span id="URRobot.move_l-453"><a href="#URRobot.move_l-453"><span class="linenos">453</span></a>                <span class="o">+</span> <span class="s2">&quot; s&quot;</span>
</span><span id="URRobot.move_l-454"><a href="#URRobot.move_l-454"><span class="linenos">454</span></a>            <span class="p">)</span>
</span><span id="URRobot.move_l-455"><a href="#URRobot.move_l-455"><span class="linenos">455</span></a>
</span><span id="URRobot.move_l-456"><a href="#URRobot.move_l-456"><span class="linenos">456</span></a>        <span class="n">trajectory_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">))</span>
</span><span id="URRobot.move_l-457"><a href="#URRobot.move_l-457"><span class="linenos">457</span></a>        <span class="n">t_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">trajectory_samples</span><span class="p">)</span>
</span><span id="URRobot.move_l-458"><a href="#URRobot.move_l-458"><span class="linenos">458</span></a>
</span><span id="URRobot.move_l-459"><a href="#URRobot.move_l-459"><span class="linenos">459</span></a>        <span class="n">c_traj</span> <span class="o">=</span> <span class="n">ctraj</span><span class="p">(</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">t_array</span><span class="p">)</span>
</span><span id="URRobot.move_l-460"><a href="#URRobot.move_l-460"><span class="linenos">460</span></a>
</span><span id="URRobot.move_l-461"><a href="#URRobot.move_l-461"><span class="linenos">461</span></a>        <span class="c1"># Add task poses to the task queue</span>
</span><span id="URRobot.move_l-462"><a href="#URRobot.move_l-462"><span class="linenos">462</span></a>        <span class="k">for</span> <span class="n">task_pose</span> <span class="ow">in</span> <span class="n">c_traj</span><span class="p">:</span>
</span><span id="URRobot.move_l-463"><a href="#URRobot.move_l-463"><span class="linenos">463</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">T_target</span> <span class="o">=</span> <span class="n">task_pose</span>
</span><span id="URRobot.move_l-464"><a href="#URRobot.move_l-464"><span class="linenos">464</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="URRobot.move_l-465"><a href="#URRobot.move_l-465"><span class="linenos">465</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_ctrl</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="URRobot.move_l-466"><a href="#URRobot.move_l-466"><span class="linenos">466</span></a>            <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
</span><span id="URRobot.move_l-467"><a href="#URRobot.move_l-467"><span class="linenos">467</span></a>        <span class="k">return</span> <span class="n">success</span>
</span></pre></div>


            <div class="docstring"><p>Move to a given position in task-space (or cartesian space)</p>

<p>The robot guides the TCP at a defined velocity along a straight path to the end point defined by T.</p>

<p>Args:
        T (sm.SE3): The desired end-effector pose in the base frame.
        velocity (Union[list, np.ndarray]): tool velocity [m/s]
        acceleration (Union[list, np.ndarray]): tool acceleration [m/s^2]</p>

<p>Returns:
        success (bool): True if the move succeeds and False otherwise.</p>
</div>


                            </div>
                            <div id="URRobot.move_j" class="classattr">
                                        <input id="URRobot.move_j-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">move_j</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">q</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>,</span><span class="param">	<span class="n">ss</span><span class="p">:</span> <span class="n"><a href="../sims/base_sim.html#SimSync">sims.base_sim.SimSync</a></span>,</span><span class="param">	<span class="n">velocity</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.05</span>,</span><span class="param">	<span class="n">acceleration</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.4</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="URRobot.move_j-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#URRobot.move_j"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="URRobot.move_j-469"><a href="#URRobot.move_j-469"><span class="linenos">469</span></a>    <span class="k">def</span> <span class="nf">move_j</span><span class="p">(</span>
</span><span id="URRobot.move_j-470"><a href="#URRobot.move_j-470"><span class="linenos">470</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="URRobot.move_j-471"><a href="#URRobot.move_j-471"><span class="linenos">471</span></a>        <span class="n">q</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
</span><span id="URRobot.move_j-472"><a href="#URRobot.move_j-472"><span class="linenos">472</span></a>        <span class="n">ss</span><span class="p">:</span> <span class="n">SimSync</span><span class="p">,</span>
</span><span id="URRobot.move_j-473"><a href="#URRobot.move_j-473"><span class="linenos">473</span></a>        <span class="n">velocity</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.05</span><span class="p">,</span>
</span><span id="URRobot.move_j-474"><a href="#URRobot.move_j-474"><span class="linenos">474</span></a>        <span class="n">acceleration</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.4</span><span class="p">,</span>
</span><span id="URRobot.move_j-475"><a href="#URRobot.move_j-475"><span class="linenos">475</span></a>    <span class="p">):</span>
</span><span id="URRobot.move_j-476"><a href="#URRobot.move_j-476"><span class="linenos">476</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="URRobot.move_j-477"><a href="#URRobot.move_j-477"><span class="linenos">477</span></a><span class="sd">        Move to a given joint position in joint-space.</span>
</span><span id="URRobot.move_j-478"><a href="#URRobot.move_j-478"><span class="linenos">478</span></a>
</span><span id="URRobot.move_j-479"><a href="#URRobot.move_j-479"><span class="linenos">479</span></a><span class="sd">        The robot moves the joints to achieve the fastest path to the end point. The fastest</span>
</span><span id="URRobot.move_j-480"><a href="#URRobot.move_j-480"><span class="linenos">480</span></a><span class="sd">        path is generally not the shortest path and is thus not a straight line. As the</span>
</span><span id="URRobot.move_j-481"><a href="#URRobot.move_j-481"><span class="linenos">481</span></a><span class="sd">        motions of the robot axes are rotational, curved paths can be executed faster than</span>
</span><span id="URRobot.move_j-482"><a href="#URRobot.move_j-482"><span class="linenos">482</span></a><span class="sd">        straight paths. The exact path of the motion cannot be predicted.</span>
</span><span id="URRobot.move_j-483"><a href="#URRobot.move_j-483"><span class="linenos">483</span></a>
</span><span id="URRobot.move_j-484"><a href="#URRobot.move_j-484"><span class="linenos">484</span></a><span class="sd">        Args:</span>
</span><span id="URRobot.move_j-485"><a href="#URRobot.move_j-485"><span class="linenos">485</span></a><span class="sd">                q (Union[list, np.ndarray]): q specifies joint positions of the robot axes [radians].</span>
</span><span id="URRobot.move_j-486"><a href="#URRobot.move_j-486"><span class="linenos">486</span></a><span class="sd">                velocity (Union[list, np.ndarray]): joint velocity [rad/s]</span>
</span><span id="URRobot.move_j-487"><a href="#URRobot.move_j-487"><span class="linenos">487</span></a><span class="sd">                acceleration (Union[list, np.ndarray]): joint acceleration [rad/s^2]</span>
</span><span id="URRobot.move_j-488"><a href="#URRobot.move_j-488"><span class="linenos">488</span></a>
</span><span id="URRobot.move_j-489"><a href="#URRobot.move_j-489"><span class="linenos">489</span></a><span class="sd">        Returns:</span>
</span><span id="URRobot.move_j-490"><a href="#URRobot.move_j-490"><span class="linenos">490</span></a><span class="sd">                success (bool): True if the move succeeds and False otherwise.</span>
</span><span id="URRobot.move_j-491"><a href="#URRobot.move_j-491"><span class="linenos">491</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URRobot.move_j-492"><a href="#URRobot.move_j-492"><span class="linenos">492</span></a>
</span><span id="URRobot.move_j-493"><a href="#URRobot.move_j-493"><span class="linenos">493</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="URRobot.move_j-494"><a href="#URRobot.move_j-494"><span class="linenos">494</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="URRobot.move_j-495"><a href="#URRobot.move_j-495"><span class="linenos">495</span></a><span class="s2">                            You attempted to send a command to the robot without a controller, set a controller </span>
</span><span id="URRobot.move_j-496"><a href="#URRobot.move_j-496"><span class="linenos">496</span></a><span class="s2">                            ur5e.controller = DiffIk(ur5e)</span>
</span><span id="URRobot.move_j-497"><a href="#URRobot.move_j-497"><span class="linenos">497</span></a><span class="s2">                            or</span>
</span><span id="URRobot.move_j-498"><a href="#URRobot.move_j-498"><span class="linenos">498</span></a><span class="s2">                            ur5e.controller = OpSpace(ur5e)</span>
</span><span id="URRobot.move_j-499"><a href="#URRobot.move_j-499"><span class="linenos">499</span></a><span class="s2">                            &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="URRobot.move_j-500"><a href="#URRobot.move_j-500"><span class="linenos">500</span></a>
</span><span id="URRobot.move_j-501"><a href="#URRobot.move_j-501"><span class="linenos">501</span></a>        <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="URRobot.move_j-502"><a href="#URRobot.move_j-502"><span class="linenos">502</span></a>
</span><span id="URRobot.move_j-503"><a href="#URRobot.move_j-503"><span class="linenos">503</span></a>        <span class="n">current_q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span>
</span><span id="URRobot.move_j-504"><a href="#URRobot.move_j-504"><span class="linenos">504</span></a>        <span class="n">target_q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</span><span id="URRobot.move_j-505"><a href="#URRobot.move_j-505"><span class="linenos">505</span></a>
</span><span id="URRobot.move_j-506"><a href="#URRobot.move_j-506"><span class="linenos">506</span></a>        <span class="c1"># check if current and target is identical within some tolerance and abort if so.</span>
</span><span id="URRobot.move_j-507"><a href="#URRobot.move_j-507"><span class="linenos">507</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">current_q</span><span class="p">,</span> <span class="n">target_q</span><span class="p">):</span>
</span><span id="URRobot.move_j-508"><a href="#URRobot.move_j-508"><span class="linenos">508</span></a>            <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="URRobot.move_j-509"><a href="#URRobot.move_j-509"><span class="linenos">509</span></a>            <span class="k">return</span> <span class="n">success</span>
</span><span id="URRobot.move_j-510"><a href="#URRobot.move_j-510"><span class="linenos">510</span></a>
</span><span id="URRobot.move_j-511"><a href="#URRobot.move_j-511"><span class="linenos">511</span></a>        <span class="c1"># calculate trajectory duration based on provided velocity and leading axis movement.</span>
</span><span id="URRobot.move_j-512"><a href="#URRobot.move_j-512"><span class="linenos">512</span></a>        <span class="n">max_dist</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="URRobot.move_j-513"><a href="#URRobot.move_j-513"><span class="linenos">513</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
</span><span id="URRobot.move_j-514"><a href="#URRobot.move_j-514"><span class="linenos">514</span></a>            <span class="n">max_dist</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_dist</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">current_q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">target_q</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span><span id="URRobot.move_j-515"><a href="#URRobot.move_j-515"><span class="linenos">515</span></a>        <span class="n">duration</span> <span class="o">=</span> <span class="n">max_dist</span> <span class="o">/</span> <span class="n">velocity</span>
</span><span id="URRobot.move_j-516"><a href="#URRobot.move_j-516"><span class="linenos">516</span></a>        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="URRobot.move_j-517"><a href="#URRobot.move_j-517"><span class="linenos">517</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="URRobot.move_j-518"><a href="#URRobot.move_j-518"><span class="linenos">518</span></a>                <span class="s2">&quot;&gt; performing move_j:</span><span class="se">\n\t</span><span class="s2">from</span><span class="se">\t\t</span><span class="s2">:</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="URRobot.move_j-519"><a href="#URRobot.move_j-519"><span class="linenos">519</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_q</span><span class="p">)</span>
</span><span id="URRobot.move_j-520"><a href="#URRobot.move_j-520"><span class="linenos">520</span></a>                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">to</span><span class="se">\t\t</span><span class="s2">:</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="URRobot.move_j-521"><a href="#URRobot.move_j-521"><span class="linenos">521</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">target_q</span><span class="p">)</span>
</span><span id="URRobot.move_j-522"><a href="#URRobot.move_j-522"><span class="linenos">522</span></a>                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">duration</span><span class="se">\t</span><span class="s2">:</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="URRobot.move_j-523"><a href="#URRobot.move_j-523"><span class="linenos">523</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">duration</span><span class="p">))</span>
</span><span id="URRobot.move_j-524"><a href="#URRobot.move_j-524"><span class="linenos">524</span></a>                <span class="o">+</span> <span class="s2">&quot; s&quot;</span>
</span><span id="URRobot.move_j-525"><a href="#URRobot.move_j-525"><span class="linenos">525</span></a>            <span class="p">)</span>
</span><span id="URRobot.move_j-526"><a href="#URRobot.move_j-526"><span class="linenos">526</span></a>        <span class="n">trajectory_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">))</span>
</span><span id="URRobot.move_j-527"><a href="#URRobot.move_j-527"><span class="linenos">527</span></a>        <span class="n">t_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">trajectory_samples</span><span class="p">)</span>
</span><span id="URRobot.move_j-528"><a href="#URRobot.move_j-528"><span class="linenos">528</span></a>        <span class="n">j_traj</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span><span class="n">current_q</span><span class="p">,</span> <span class="n">target_q</span><span class="p">,</span> <span class="n">t_array</span><span class="p">)</span><span class="o">.</span><span class="n">q</span>
</span><span id="URRobot.move_j-529"><a href="#URRobot.move_j-529"><span class="linenos">529</span></a>
</span><span id="URRobot.move_j-530"><a href="#URRobot.move_j-530"><span class="linenos">530</span></a>        <span class="k">for</span> <span class="n">joint_q</span> <span class="ow">in</span> <span class="n">j_traj</span><span class="p">:</span>
</span><span id="URRobot.move_j-531"><a href="#URRobot.move_j-531"><span class="linenos">531</span></a>            <span class="n">task_pose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fk</span><span class="p">(</span><span class="n">joint_q</span><span class="p">)</span>
</span><span id="URRobot.move_j-532"><a href="#URRobot.move_j-532"><span class="linenos">532</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">T_target</span> <span class="o">=</span> <span class="n">task_pose</span>
</span><span id="URRobot.move_j-533"><a href="#URRobot.move_j-533"><span class="linenos">533</span></a>            <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
</span><span id="URRobot.move_j-534"><a href="#URRobot.move_j-534"><span class="linenos">534</span></a>        <span class="k">return</span> <span class="n">success</span>
</span></pre></div>


            <div class="docstring"><p>Move to a given joint position in joint-space.</p>

<p>The robot moves the joints to achieve the fastest path to the end point. The fastest
path is generally not the shortest path and is thus not a straight line. As the
motions of the robot axes are rotational, curved paths can be executed faster than
straight paths. The exact path of the motion cannot be predicted.</p>

<p>Args:
        q (Union[list, np.ndarray]): q specifies joint positions of the robot axes [radians].
        velocity (Union[list, np.ndarray]): joint velocity [rad/s]
        acceleration (Union[list, np.ndarray]): joint acceleration [rad/s^2]</p>

<p>Returns:
        success (bool): True if the move succeeds and False otherwise.</p>
</div>


                            </div>
                            <div id="URRobot.move_traj" class="classattr">
                                        <input id="URRobot.move_traj-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">move_traj</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">T</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">spatialmath</span><span class="o">.</span><span class="n">pose3d</span><span class="o">.</span><span class="n">SE3</span><span class="p">,</span> <span class="n">List</span><span class="p">]</span>,</span><span class="param">	<span class="n">ss</span><span class="p">:</span> <span class="n"><a href="../sims/base_sim.html#SimSync">sims.base_sim.SimSync</a></span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="URRobot.move_traj-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#URRobot.move_traj"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="URRobot.move_traj-536"><a href="#URRobot.move_traj-536"><span class="linenos">536</span></a>    <span class="k">def</span> <span class="nf">move_traj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">sm</span><span class="o">.</span><span class="n">SE3</span><span class="p">,</span> <span class="n">List</span><span class="p">],</span> <span class="n">ss</span><span class="p">:</span> <span class="n">SimSync</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="URRobot.move_traj-537"><a href="#URRobot.move_traj-537"><span class="linenos">537</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="URRobot.move_traj-538"><a href="#URRobot.move_traj-538"><span class="linenos">538</span></a><span class="sd">        Move the robot along a given trajectory.</span>
</span><span id="URRobot.move_traj-539"><a href="#URRobot.move_traj-539"><span class="linenos">539</span></a>
</span><span id="URRobot.move_traj-540"><a href="#URRobot.move_traj-540"><span class="linenos">540</span></a><span class="sd">        This function enqueues a series of task poses for the robot to follow sequentially.</span>
</span><span id="URRobot.move_traj-541"><a href="#URRobot.move_traj-541"><span class="linenos">541</span></a>
</span><span id="URRobot.move_traj-542"><a href="#URRobot.move_traj-542"><span class="linenos">542</span></a><span class="sd">        Args</span>
</span><span id="URRobot.move_traj-543"><a href="#URRobot.move_traj-543"><span class="linenos">543</span></a><span class="sd">        ----------</span>
</span><span id="URRobot.move_traj-544"><a href="#URRobot.move_traj-544"><span class="linenos">544</span></a><span class="sd">                T (Union[sm.SE3, List]): List of desired end-effector poses in the base frame.</span>
</span><span id="URRobot.move_traj-545"><a href="#URRobot.move_traj-545"><span class="linenos">545</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="URRobot.move_traj-546"><a href="#URRobot.move_traj-546"><span class="linenos">546</span></a>        <span class="c1"># add task poses to the robot task queue</span>
</span><span id="URRobot.move_traj-547"><a href="#URRobot.move_traj-547"><span class="linenos">547</span></a>
</span><span id="URRobot.move_traj-548"><a href="#URRobot.move_traj-548"><span class="linenos">548</span></a>        <span class="k">for</span> <span class="n">task_pose</span> <span class="ow">in</span> <span class="n">T</span><span class="p">:</span>
</span><span id="URRobot.move_traj-549"><a href="#URRobot.move_traj-549"><span class="linenos">549</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">T_target</span> <span class="o">=</span> <span class="n">task_pose</span>
</span><span id="URRobot.move_traj-550"><a href="#URRobot.move_traj-550"><span class="linenos">550</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="URRobot.move_traj-551"><a href="#URRobot.move_traj-551"><span class="linenos">551</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_ctrl</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="URRobot.move_traj-552"><a href="#URRobot.move_traj-552"><span class="linenos">552</span></a>            <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Move the robot along a given trajectory.</p>

<p>This function enqueues a series of task poses for the robot to follow sequentially.</p>

<h2 id="args">Args</h2>

<pre><code>    T (Union[sm.SE3, List]): List of desired end-effector poses in the base frame.
</code></pre>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="base_robot.html#BaseRobot">robots.base_robot.BaseRobot</a></dt>
                                <dd id="URRobot.set_ctrl" class="function"><a href="base_robot.html#BaseRobot.set_ctrl">set_ctrl</a></dd>
                <dd id="URRobot.ctrl" class="variable"><a href="base_robot.html#BaseRobot.ctrl">ctrl</a></dd>
                <dd id="URRobot.Jp" class="variable"><a href="base_robot.html#BaseRobot.Jp">Jp</a></dd>
                <dd id="URRobot.Jo" class="variable"><a href="base_robot.html#BaseRobot.Jo">Jo</a></dd>
                <dd id="URRobot.J" class="variable"><a href="base_robot.html#BaseRobot.J">J</a></dd>
                <dd id="URRobot.c" class="variable"><a href="base_robot.html#BaseRobot.c">c</a></dd>
                <dd id="URRobot.Mq" class="variable"><a href="base_robot.html#BaseRobot.Mq">Mq</a></dd>
                <dd id="URRobot.Mx" class="variable"><a href="base_robot.html#BaseRobot.Mx">Mx</a></dd>
                <dd id="URRobot.q" class="variable"><a href="base_robot.html#BaseRobot.q">q</a></dd>
                <dd id="URRobot.dq" class="variable"><a href="base_robot.html#BaseRobot.dq">dq</a></dd>
                <dd id="URRobot.ddq" class="variable"><a href="base_robot.html#BaseRobot.ddq">ddq</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="URRobot.Type">
                            <input id="URRobot.Type-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">URRobot.Type</span><wbr>(<span class="base">enum.Enum</span>):

                <label class="view-source-button" for="URRobot.Type-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#URRobot.Type"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="URRobot.Type-30"><a href="#URRobot.Type-30"><span class="linenos">30</span></a>    <span class="k">class</span> <span class="nc">Type</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="URRobot.Type-31"><a href="#URRobot.Type-31"><span class="linenos">31</span></a>        <span class="n">UR3e</span> <span class="o">=</span> <span class="s2">&quot;ur3e&quot;</span>
</span><span id="URRobot.Type-32"><a href="#URRobot.Type-32"><span class="linenos">32</span></a>        <span class="n">UR5e</span> <span class="o">=</span> <span class="s2">&quot;ur5e&quot;</span>
</span><span id="URRobot.Type-33"><a href="#URRobot.Type-33"><span class="linenos">33</span></a>        <span class="n">UR10e</span> <span class="o">=</span> <span class="s2">&quot;ur10e&quot;</span>
</span></pre></div>


    

                            <div id="URRobot.Type.UR3e" class="classattr">
                                <div class="attr variable">
            <span class="name">UR3e</span>        =
<span class="default_value">&lt;Type.UR3e: &#39;ur3e&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#URRobot.Type.UR3e"></a>
    
    

                            </div>
                            <div id="URRobot.Type.UR5e" class="classattr">
                                <div class="attr variable">
            <span class="name">UR5e</span>        =
<span class="default_value">&lt;Type.UR5e: &#39;ur5e&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#URRobot.Type.UR5e"></a>
    
    

                            </div>
                            <div id="URRobot.Type.UR10e" class="classattr">
                                <div class="attr variable">
            <span class="name">UR10e</span>        =
<span class="default_value">&lt;Type.UR10e: &#39;ur10e&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#URRobot.Type.UR10e"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>enum.Enum</dt>
                                <dd id="URRobot.Type.name" class="variable">name</dd>
                <dd id="URRobot.Type.value" class="variable">value</dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>