<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.6.1"/>
    <title>robots.shadow_hand API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../robots.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;robots</a>

            <img src="mujoco-logo-reborn.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#ShadowHand">ShadowHand</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ShadowHand.__init__">ShadowHand</a>
                        </li>
                        <li>
                                <a class="class" href="#ShadowHand.Type">ShadowHand.Type</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="variable" href="#ShadowHand.Type.RIGHT">RIGHT</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#ShadowHand.Type.LEFT">LEFT</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="class" href="#ShadowHand.ShadowFinger">ShadowHand.ShadowFinger</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#ShadowHand.ShadowFinger.__init__">ShadowFinger</a>
                                    </li>
                                    <li>
                                            <a class="class" href="#ShadowHand.ShadowFinger.FingerType">ShadowHand.ShadowFinger.FingerType</a>
                                                    <ul class="memberlist">
                                                <li>
                                                        <a class="variable" href="#ShadowHand.ShadowFinger.FingerType.FF">FF</a>
                                                </li>
                                                <li>
                                                        <a class="variable" href="#ShadowHand.ShadowFinger.FingerType.MF">MF</a>
                                                </li>
                                                <li>
                                                        <a class="variable" href="#ShadowHand.ShadowFinger.FingerType.RF">RF</a>
                                                </li>
                                                <li>
                                                        <a class="variable" href="#ShadowHand.ShadowFinger.FingerType.LF">LF</a>
                                                </li>
                                                <li>
                                                        <a class="variable" href="#ShadowHand.ShadowFinger.FingerType.TH">TH</a>
                                                </li>
                                        </ul>

                                    </li>
                                    <li>
                                            <a class="variable" href="#ShadowHand.ShadowFinger.J">J</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#ShadowHand.ShadowFinger.data">data</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#ShadowHand.ShadowFinger.model">model</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#ShadowHand.ShadowFinger.info">info</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#ShadowHand.ShadowFinger.name">name</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#ShadowHand.ShadowFinger.step">step</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#ShadowHand.ShadowFinger.set_ctrl">set_ctrl</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="variable" href="#ShadowHand.ff">ff</a>
                        </li>
                        <li>
                                <a class="variable" href="#ShadowHand.mf">mf</a>
                        </li>
                        <li>
                                <a class="variable" href="#ShadowHand.rf">rf</a>
                        </li>
                        <li>
                                <a class="variable" href="#ShadowHand.lf">lf</a>
                        </li>
                        <li>
                                <a class="variable" href="#ShadowHand.th">th</a>
                        </li>
                        <li>
                                <a class="variable" href="#ShadowHand.data">data</a>
                        </li>
                        <li>
                                <a class="variable" href="#ShadowHand.model">model</a>
                        </li>
                        <li>
                                <a class="variable" href="#ShadowHand.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#ShadowHand.info">info</a>
                        </li>
                        <li>
                                <a class="function" href="#ShadowHand.step">step</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../robots.html">robots</a><wbr>.shadow_hand    </h1>

                
                        <input id="mod-shadow_hand-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-shadow_hand-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span> <span class="nn">enum</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span> <span class="nn">mujoco</span> <span class="k">as</span> <span class="nn">mj</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span> <span class="nn">dm_control</span> <span class="kn">import</span> <span class="n">mjcf</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span> <span class="nn">robots</span> <span class="kn">import</span> <span class="n">BaseRobot</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span> <span class="nn">sims</span> <span class="kn">import</span> <span class="n">BaseSim</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">from</span> <span class="nn">sims.base_sim</span> <span class="kn">import</span> <span class="n">SimSync</span><span class="p">,</span> <span class="n">sleep</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">from</span> <span class="nn">utils.mj</span> <span class="kn">import</span> <span class="n">ObjType</span><span class="p">,</span> <span class="n">RobotInfo</span><span class="p">,</span> <span class="n">get_names</span><span class="p">,</span> <span class="n">get_pose</span><span class="p">,</span> <span class="n">id2name</span><span class="p">,</span> <span class="n">name2id</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">from</span> <span class="nn">utils.sm</span> <span class="kn">import</span> <span class="n">jtraj</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="k">class</span> <span class="nc">ShadowHand</span><span class="p">(</span><span class="n">BaseRobot</span><span class="p">):</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>    <span class="k">class</span> <span class="nc">Type</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>        <span class="n">RIGHT</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>        <span class="n">LEFT</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>    <span class="k">class</span> <span class="nc">ShadowFinger</span><span class="p">(</span><span class="n">BaseRobot</span><span class="p">):</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>        <span class="k">class</span> <span class="nc">FingerType</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>            <span class="n">FF</span> <span class="o">=</span> <span class="s2">&quot;FF&quot;</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>            <span class="n">MF</span> <span class="o">=</span> <span class="s2">&quot;MF&quot;</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>            <span class="n">RF</span> <span class="o">=</span> <span class="s2">&quot;RF&quot;</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>            <span class="n">LF</span> <span class="o">=</span> <span class="s2">&quot;LF&quot;</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>            <span class="n">TH</span> <span class="o">=</span> <span class="s2">&quot;TH&quot;</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sh</span><span class="p">:</span> <span class="s2">&quot;ShadowHand&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="n">FingerType</span><span class="p">):</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">data</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">model</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="nb">type</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="nb">type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">RobotInfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>            <span class="c1"># custom naming</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">body_names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>                <span class="n">bna</span> <span class="k">for</span> <span class="n">bna</span> <span class="ow">in</span> <span class="n">get_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">BODY</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;ff&quot;</span> <span class="ow">in</span> <span class="n">bna</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>            <span class="p">]</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">body_ids</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>                <span class="n">name2id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">bna</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">BODY</span><span class="p">)</span> <span class="k">for</span> <span class="n">bna</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">body_names</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>            <span class="p">]</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">geom_ids</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>                <span class="n">geom_id</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>                <span class="k">for</span> <span class="n">geom_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">ngeom</span><span class="p">)</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geom_bodyid</span><span class="p">[</span><span class="n">geom_id</span><span class="p">])</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">body_ids</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>            <span class="p">]</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">geom_names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>                <span class="n">id2name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">GEOM</span><span class="p">)</span> <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">geom_ids</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>            <span class="p">]</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">site_names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>                <span class="n">sna</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>                <span class="k">for</span> <span class="n">sna</span> <span class="ow">in</span> <span class="n">get_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">SITE</span><span class="p">)</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">sna</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>            <span class="p">]</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">site_ids</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>                <span class="n">name2id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">sna</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">SITE</span><span class="p">)</span> <span class="k">for</span> <span class="n">sna</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">site_names</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>            <span class="p">]</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="nd">@property</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="k">def</span> <span class="nf">J</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">            Get the full Jacobian in base frame.</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">            Returns</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">            ----------</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">                    Full Jacobian as a numpy array.</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>            <span class="n">sys_J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nv</span><span class="p">))</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>            <span class="n">mj</span><span class="o">.</span><span class="n">mj_jacSite</span><span class="p">(</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>                <span class="n">sys_J</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>                <span class="n">sys_J</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">site_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>                <span class="c1"># name2id(self.model, f&quot;{self.name}/{self.info.site_names[0]}&quot;, ObjType.SITE),</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>            <span class="p">)</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>            <span class="c1"># get only the dofs for this robot</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>            <span class="n">sys_J</span> <span class="o">=</span> <span class="n">sys_J</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">_dof_indxs</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>            <span class="c1"># convert from world frame to base frame</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>            <span class="n">sys_J</span><span class="p">[</span><span class="mi">3</span><span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>                <span class="n">get_pose</span><span class="p">(</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sh</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/rh_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">knuckle&quot;</span><span class="p">,</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>                    <span class="n">ObjType</span><span class="o">.</span><span class="n">BODY</span><span class="p">,</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">R</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>                <span class="o">@</span> <span class="n">sys_J</span><span class="p">[</span><span class="mi">3</span><span class="p">:,</span> <span class="p">:]</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>            <span class="p">)</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>            <span class="n">sys_J</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>                <span class="n">get_pose</span><span class="p">(</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sh</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/rh_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">knuckle&quot;</span><span class="p">,</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>                    <span class="n">ObjType</span><span class="o">.</span><span class="n">BODY</span><span class="p">,</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">R</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>                <span class="o">@</span> <span class="n">sys_J</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>            <span class="p">)</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>            <span class="k">return</span> <span class="n">sys_J</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>        <span class="nd">@property</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>        <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjData</span><span class="p">:</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>        <span class="nd">@property</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>        <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjModel</span><span class="p">:</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>        <span class="nd">@property</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>        <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RobotInfo</span><span class="p">:</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>        <span class="nd">@property</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>        <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="nd">@property</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>        <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>            <span class="k">return</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>        <span class="k">def</span> <span class="nf">set_ctrl</span><span class="p">(</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">ss</span><span class="p">:</span> <span class="n">SimSync</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">n_actuators</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>            <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>            <span class="n">trajectory_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">timestep</span><span class="p">))</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>            <span class="n">t_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">trajectory_samples</span><span class="p">)</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>            <span class="n">a_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">actuator_limits</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>            <span class="n">Q</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">t_array</span><span class="p">,</span> <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>            <span class="n">x_total</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>            <span class="n">is_curling</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>            <span class="n">in_overflow</span> <span class="o">=</span> <span class="n">x_total</span> <span class="o">&gt;=</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>            <span class="n">half_duration</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>            <span class="n">half_samples</span> <span class="o">=</span> <span class="n">trajectory_samples</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>            <span class="n">t_array_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">half_duration</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">half_samples</span><span class="p">)</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>            <span class="k">if</span> <span class="n">is_curling</span><span class="p">:</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">in_overflow</span><span class="p">:</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>                    <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_total</span><span class="p">,</span> <span class="mi">0</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>                    <span class="n">Q</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>                    <span class="n">Q</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_total</span><span class="p">,</span> <span class="n">t_array</span><span class="p">,</span> <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>                <span class="k">else</span><span class="p">:</span>  <span class="c1"># is overflow</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>                    <span class="c1"># Fill out first phase</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>                    <span class="n">Q</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>                        <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>                        <span class="n">t_array_1</span><span class="p">,</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>                        <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>                    <span class="n">Q</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>                    <span class="c1"># Fill out second phase</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>                    <span class="n">Q</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">))</span> <span class="o">*</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>                    <span class="p">)</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>                    <span class="n">Q</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>                        <span class="n">x_total</span> <span class="o">-</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>                        <span class="n">t_array</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:],</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>                        <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>            <span class="k">else</span><span class="p">:</span>  <span class="c1"># is extending</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>                <span class="n">in_overflow</span> <span class="o">=</span> <span class="n">x_total</span> <span class="o">&gt;</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>                <span class="n">is_overflow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>                <span class="k">if</span> <span class="n">in_overflow</span> <span class="ow">and</span> <span class="n">is_overflow</span><span class="p">:</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>                    <span class="c1"># When we extend from a fully curled position</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>                    <span class="n">Q</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>                    <span class="n">Q</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">x_total</span><span class="p">,</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>                        <span class="n">t_array</span><span class="p">,</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>                        <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">in_overflow</span> <span class="ow">and</span> <span class="n">is_overflow</span><span class="p">:</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>                    <span class="c1"># Fill out first phase</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>                    <span class="n">Q</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>                        <span class="n">a_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>                        <span class="n">t_array_1</span><span class="p">,</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>                        <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>                    <span class="n">Q</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>                    <span class="c1"># Fill out second phase</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>                    <span class="n">Q</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">))</span> <span class="o">*</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>                    <span class="p">)</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>                    <span class="n">Q</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>                        <span class="n">x_total</span><span class="p">,</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>                        <span class="n">t_array</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:],</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>                        <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>            <span class="k">def</span> <span class="nf">_set_ctrl</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">qi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">actuator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">actuator_ids</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">ctrl</span> <span class="o">=</span> <span class="n">qi</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>            <span class="c1"># execute Q</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>            <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">Q</span><span class="p">:</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>                <span class="n">_set_ctrl</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>                <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjModel</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjData</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">Type</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_args</span> <span class="o">=</span> <span class="n">args</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">_shadow_hand&quot;</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">RobotInfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="o">.</span><span class="n">FingerType</span><span class="o">.</span><span class="n">FF</span><span class="p">)</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="o">.</span><span class="n">FingerType</span><span class="o">.</span><span class="n">MF</span><span class="p">)</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="o">.</span><span class="n">FingerType</span><span class="o">.</span><span class="n">RF</span><span class="p">)</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="o">.</span><span class="n">FingerType</span><span class="o">.</span><span class="n">LF</span><span class="p">)</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="o">.</span><span class="n">FingerType</span><span class="o">.</span><span class="n">TH</span><span class="p">)</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_queue</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>    <span class="nd">@property</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjData</span><span class="p">:</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>    <span class="nd">@property</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>    <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjModel</span><span class="p">:</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>    <span class="nd">@property</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>    <span class="nd">@property</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RobotInfo</span><span class="p">:</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_queue</span><span class="p">:</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>            <span class="n">ctrl_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_queue</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_ctrl</span><span class="p">(</span><span class="n">ctrl_target</span><span class="p">)</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>    <span class="k">class</span> <span class="nc">MjSim</span><span class="p">(</span><span class="n">BaseSim</span><span class="p">):</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>            <span class="n">sh</span> <span class="o">=</span> <span class="n">ShadowHand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>            <span class="n">sh</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>        <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">mj</span><span class="o">.</span><span class="n">MjModel</span><span class="p">,</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjData</span><span class="p">]:</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>            <span class="c1"># root</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>            <span class="n">_HERE</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>            <span class="c1"># scene path</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>            <span class="n">_XML_SCENE</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">_HERE</span> <span class="o">/</span> <span class="s2">&quot;scenes/empty.xml&quot;</span><span class="p">)</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>            <span class="n">scene</span> <span class="o">=</span> <span class="n">mjcf</span><span class="o">.</span><span class="n">from_path</span><span class="p">(</span><span class="n">_XML_SCENE</span><span class="p">)</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>            <span class="c1"># shadow hand path</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>            <span class="n">_XML_SHADOW_HAND</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">_HERE</span> <span class="o">/</span> <span class="s2">&quot;assets/shadow_hand/shadow_rh.xml&quot;</span><span class="p">)</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>            <span class="n">shadow_hand</span> <span class="o">=</span> <span class="n">mjcf</span><span class="o">.</span><span class="n">from_path</span><span class="p">(</span><span class="n">_XML_SHADOW_HAND</span><span class="p">)</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>            <span class="n">scene</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">shadow_hand</span><span class="p">)</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>            <span class="n">m</span> <span class="o">=</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjModel</span><span class="o">.</span><span class="n">from_xml_string</span><span class="p">(</span><span class="n">scene</span><span class="o">.</span><span class="n">to_xml_string</span><span class="p">(),</span> <span class="n">scene</span><span class="o">.</span><span class="n">get_assets</span><span class="p">())</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjData</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>            <span class="c1"># step once to compute the poses of objects</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>            <span class="n">mj</span><span class="o">.</span><span class="n">mj_step</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>            <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">d</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>        <span class="nd">@property</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>        <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>        <span class="nd">@property</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>        <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>    <span class="n">sim</span> <span class="o">=</span> <span class="n">MjSim</span><span class="p">()</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>    <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span></pre></div>


            </section>
                <section id="ShadowHand">
                            <input id="ShadowHand-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ShadowHand</span><wbr>(<span class="base"><a href="base_robot.html#BaseRobot">robots.base_robot.BaseRobot</a></span>):

                <label class="view-source-button" for="ShadowHand-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ShadowHand"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ShadowHand-18"><a href="#ShadowHand-18"><span class="linenos"> 18</span></a><span class="k">class</span> <span class="nc">ShadowHand</span><span class="p">(</span><span class="n">BaseRobot</span><span class="p">):</span>
</span><span id="ShadowHand-19"><a href="#ShadowHand-19"><span class="linenos"> 19</span></a>    <span class="k">class</span> <span class="nc">Type</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="ShadowHand-20"><a href="#ShadowHand-20"><span class="linenos"> 20</span></a>        <span class="n">RIGHT</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span>
</span><span id="ShadowHand-21"><a href="#ShadowHand-21"><span class="linenos"> 21</span></a>        <span class="n">LEFT</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
</span><span id="ShadowHand-22"><a href="#ShadowHand-22"><span class="linenos"> 22</span></a>
</span><span id="ShadowHand-23"><a href="#ShadowHand-23"><span class="linenos"> 23</span></a>    <span class="k">class</span> <span class="nc">ShadowFinger</span><span class="p">(</span><span class="n">BaseRobot</span><span class="p">):</span>
</span><span id="ShadowHand-24"><a href="#ShadowHand-24"><span class="linenos"> 24</span></a>        <span class="k">class</span> <span class="nc">FingerType</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="ShadowHand-25"><a href="#ShadowHand-25"><span class="linenos"> 25</span></a>            <span class="n">FF</span> <span class="o">=</span> <span class="s2">&quot;FF&quot;</span>
</span><span id="ShadowHand-26"><a href="#ShadowHand-26"><span class="linenos"> 26</span></a>            <span class="n">MF</span> <span class="o">=</span> <span class="s2">&quot;MF&quot;</span>
</span><span id="ShadowHand-27"><a href="#ShadowHand-27"><span class="linenos"> 27</span></a>            <span class="n">RF</span> <span class="o">=</span> <span class="s2">&quot;RF&quot;</span>
</span><span id="ShadowHand-28"><a href="#ShadowHand-28"><span class="linenos"> 28</span></a>            <span class="n">LF</span> <span class="o">=</span> <span class="s2">&quot;LF&quot;</span>
</span><span id="ShadowHand-29"><a href="#ShadowHand-29"><span class="linenos"> 29</span></a>            <span class="n">TH</span> <span class="o">=</span> <span class="s2">&quot;TH&quot;</span>
</span><span id="ShadowHand-30"><a href="#ShadowHand-30"><span class="linenos"> 30</span></a>
</span><span id="ShadowHand-31"><a href="#ShadowHand-31"><span class="linenos"> 31</span></a>        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sh</span><span class="p">:</span> <span class="s2">&quot;ShadowHand&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="n">FingerType</span><span class="p">):</span>
</span><span id="ShadowHand-32"><a href="#ShadowHand-32"><span class="linenos"> 32</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">data</span>
</span><span id="ShadowHand-33"><a href="#ShadowHand-33"><span class="linenos"> 33</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">model</span>
</span><span id="ShadowHand-34"><a href="#ShadowHand-34"><span class="linenos"> 34</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="nb">type</span>
</span><span id="ShadowHand-35"><a href="#ShadowHand-35"><span class="linenos"> 35</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="nb">type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ShadowHand-36"><a href="#ShadowHand-36"><span class="linenos"> 36</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">RobotInfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</span><span id="ShadowHand-37"><a href="#ShadowHand-37"><span class="linenos"> 37</span></a>
</span><span id="ShadowHand-38"><a href="#ShadowHand-38"><span class="linenos"> 38</span></a>            <span class="c1"># custom naming</span>
</span><span id="ShadowHand-39"><a href="#ShadowHand-39"><span class="linenos"> 39</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">body_names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ShadowHand-40"><a href="#ShadowHand-40"><span class="linenos"> 40</span></a>                <span class="n">bna</span> <span class="k">for</span> <span class="n">bna</span> <span class="ow">in</span> <span class="n">get_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">BODY</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;ff&quot;</span> <span class="ow">in</span> <span class="n">bna</span>
</span><span id="ShadowHand-41"><a href="#ShadowHand-41"><span class="linenos"> 41</span></a>            <span class="p">]</span>
</span><span id="ShadowHand-42"><a href="#ShadowHand-42"><span class="linenos"> 42</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">body_ids</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ShadowHand-43"><a href="#ShadowHand-43"><span class="linenos"> 43</span></a>                <span class="n">name2id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">bna</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">BODY</span><span class="p">)</span> <span class="k">for</span> <span class="n">bna</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">body_names</span>
</span><span id="ShadowHand-44"><a href="#ShadowHand-44"><span class="linenos"> 44</span></a>            <span class="p">]</span>
</span><span id="ShadowHand-45"><a href="#ShadowHand-45"><span class="linenos"> 45</span></a>
</span><span id="ShadowHand-46"><a href="#ShadowHand-46"><span class="linenos"> 46</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">geom_ids</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ShadowHand-47"><a href="#ShadowHand-47"><span class="linenos"> 47</span></a>                <span class="n">geom_id</span>
</span><span id="ShadowHand-48"><a href="#ShadowHand-48"><span class="linenos"> 48</span></a>                <span class="k">for</span> <span class="n">geom_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">ngeom</span><span class="p">)</span>
</span><span id="ShadowHand-49"><a href="#ShadowHand-49"><span class="linenos"> 49</span></a>                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geom_bodyid</span><span class="p">[</span><span class="n">geom_id</span><span class="p">])</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">body_ids</span>
</span><span id="ShadowHand-50"><a href="#ShadowHand-50"><span class="linenos"> 50</span></a>            <span class="p">]</span>
</span><span id="ShadowHand-51"><a href="#ShadowHand-51"><span class="linenos"> 51</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">geom_names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ShadowHand-52"><a href="#ShadowHand-52"><span class="linenos"> 52</span></a>                <span class="n">id2name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">GEOM</span><span class="p">)</span> <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">geom_ids</span>
</span><span id="ShadowHand-53"><a href="#ShadowHand-53"><span class="linenos"> 53</span></a>            <span class="p">]</span>
</span><span id="ShadowHand-54"><a href="#ShadowHand-54"><span class="linenos"> 54</span></a>
</span><span id="ShadowHand-55"><a href="#ShadowHand-55"><span class="linenos"> 55</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">site_names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ShadowHand-56"><a href="#ShadowHand-56"><span class="linenos"> 56</span></a>                <span class="n">sna</span>
</span><span id="ShadowHand-57"><a href="#ShadowHand-57"><span class="linenos"> 57</span></a>                <span class="k">for</span> <span class="n">sna</span> <span class="ow">in</span> <span class="n">get_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">SITE</span><span class="p">)</span>
</span><span id="ShadowHand-58"><a href="#ShadowHand-58"><span class="linenos"> 58</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">sna</span>
</span><span id="ShadowHand-59"><a href="#ShadowHand-59"><span class="linenos"> 59</span></a>            <span class="p">]</span>
</span><span id="ShadowHand-60"><a href="#ShadowHand-60"><span class="linenos"> 60</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">site_ids</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ShadowHand-61"><a href="#ShadowHand-61"><span class="linenos"> 61</span></a>                <span class="n">name2id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">sna</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">SITE</span><span class="p">)</span> <span class="k">for</span> <span class="n">sna</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">site_names</span>
</span><span id="ShadowHand-62"><a href="#ShadowHand-62"><span class="linenos"> 62</span></a>            <span class="p">]</span>
</span><span id="ShadowHand-63"><a href="#ShadowHand-63"><span class="linenos"> 63</span></a>
</span><span id="ShadowHand-64"><a href="#ShadowHand-64"><span class="linenos"> 64</span></a>        <span class="nd">@property</span>
</span><span id="ShadowHand-65"><a href="#ShadowHand-65"><span class="linenos"> 65</span></a>        <span class="k">def</span> <span class="nf">J</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="ShadowHand-66"><a href="#ShadowHand-66"><span class="linenos"> 66</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ShadowHand-67"><a href="#ShadowHand-67"><span class="linenos"> 67</span></a><span class="sd">            Get the full Jacobian in base frame.</span>
</span><span id="ShadowHand-68"><a href="#ShadowHand-68"><span class="linenos"> 68</span></a>
</span><span id="ShadowHand-69"><a href="#ShadowHand-69"><span class="linenos"> 69</span></a><span class="sd">            Returns</span>
</span><span id="ShadowHand-70"><a href="#ShadowHand-70"><span class="linenos"> 70</span></a><span class="sd">            ----------</span>
</span><span id="ShadowHand-71"><a href="#ShadowHand-71"><span class="linenos"> 71</span></a><span class="sd">                    Full Jacobian as a numpy array.</span>
</span><span id="ShadowHand-72"><a href="#ShadowHand-72"><span class="linenos"> 72</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="ShadowHand-73"><a href="#ShadowHand-73"><span class="linenos"> 73</span></a>            <span class="n">sys_J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nv</span><span class="p">))</span>
</span><span id="ShadowHand-74"><a href="#ShadowHand-74"><span class="linenos"> 74</span></a>
</span><span id="ShadowHand-75"><a href="#ShadowHand-75"><span class="linenos"> 75</span></a>            <span class="n">mj</span><span class="o">.</span><span class="n">mj_jacSite</span><span class="p">(</span>
</span><span id="ShadowHand-76"><a href="#ShadowHand-76"><span class="linenos"> 76</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
</span><span id="ShadowHand-77"><a href="#ShadowHand-77"><span class="linenos"> 77</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="ShadowHand-78"><a href="#ShadowHand-78"><span class="linenos"> 78</span></a>                <span class="n">sys_J</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span>
</span><span id="ShadowHand-79"><a href="#ShadowHand-79"><span class="linenos"> 79</span></a>                <span class="n">sys_J</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span>
</span><span id="ShadowHand-80"><a href="#ShadowHand-80"><span class="linenos"> 80</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">site_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="ShadowHand-81"><a href="#ShadowHand-81"><span class="linenos"> 81</span></a>                <span class="c1"># name2id(self.model, f&quot;{self.name}/{self.info.site_names[0]}&quot;, ObjType.SITE),</span>
</span><span id="ShadowHand-82"><a href="#ShadowHand-82"><span class="linenos"> 82</span></a>            <span class="p">)</span>
</span><span id="ShadowHand-83"><a href="#ShadowHand-83"><span class="linenos"> 83</span></a>
</span><span id="ShadowHand-84"><a href="#ShadowHand-84"><span class="linenos"> 84</span></a>            <span class="c1"># get only the dofs for this robot</span>
</span><span id="ShadowHand-85"><a href="#ShadowHand-85"><span class="linenos"> 85</span></a>            <span class="n">sys_J</span> <span class="o">=</span> <span class="n">sys_J</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">_dof_indxs</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ShadowHand-86"><a href="#ShadowHand-86"><span class="linenos"> 86</span></a>
</span><span id="ShadowHand-87"><a href="#ShadowHand-87"><span class="linenos"> 87</span></a>            <span class="c1"># convert from world frame to base frame</span>
</span><span id="ShadowHand-88"><a href="#ShadowHand-88"><span class="linenos"> 88</span></a>            <span class="n">sys_J</span><span class="p">[</span><span class="mi">3</span><span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ShadowHand-89"><a href="#ShadowHand-89"><span class="linenos"> 89</span></a>                <span class="n">get_pose</span><span class="p">(</span>
</span><span id="ShadowHand-90"><a href="#ShadowHand-90"><span class="linenos"> 90</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
</span><span id="ShadowHand-91"><a href="#ShadowHand-91"><span class="linenos"> 91</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="ShadowHand-92"><a href="#ShadowHand-92"><span class="linenos"> 92</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sh</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/rh_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">knuckle&quot;</span><span class="p">,</span>
</span><span id="ShadowHand-93"><a href="#ShadowHand-93"><span class="linenos"> 93</span></a>                    <span class="n">ObjType</span><span class="o">.</span><span class="n">BODY</span><span class="p">,</span>
</span><span id="ShadowHand-94"><a href="#ShadowHand-94"><span class="linenos"> 94</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">R</span>
</span><span id="ShadowHand-95"><a href="#ShadowHand-95"><span class="linenos"> 95</span></a>                <span class="o">@</span> <span class="n">sys_J</span><span class="p">[</span><span class="mi">3</span><span class="p">:,</span> <span class="p">:]</span>
</span><span id="ShadowHand-96"><a href="#ShadowHand-96"><span class="linenos"> 96</span></a>            <span class="p">)</span>
</span><span id="ShadowHand-97"><a href="#ShadowHand-97"><span class="linenos"> 97</span></a>            <span class="n">sys_J</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ShadowHand-98"><a href="#ShadowHand-98"><span class="linenos"> 98</span></a>                <span class="n">get_pose</span><span class="p">(</span>
</span><span id="ShadowHand-99"><a href="#ShadowHand-99"><span class="linenos"> 99</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
</span><span id="ShadowHand-100"><a href="#ShadowHand-100"><span class="linenos">100</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="ShadowHand-101"><a href="#ShadowHand-101"><span class="linenos">101</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sh</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/rh_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">knuckle&quot;</span><span class="p">,</span>
</span><span id="ShadowHand-102"><a href="#ShadowHand-102"><span class="linenos">102</span></a>                    <span class="n">ObjType</span><span class="o">.</span><span class="n">BODY</span><span class="p">,</span>
</span><span id="ShadowHand-103"><a href="#ShadowHand-103"><span class="linenos">103</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">R</span>
</span><span id="ShadowHand-104"><a href="#ShadowHand-104"><span class="linenos">104</span></a>                <span class="o">@</span> <span class="n">sys_J</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="ShadowHand-105"><a href="#ShadowHand-105"><span class="linenos">105</span></a>            <span class="p">)</span>
</span><span id="ShadowHand-106"><a href="#ShadowHand-106"><span class="linenos">106</span></a>            <span class="k">return</span> <span class="n">sys_J</span>
</span><span id="ShadowHand-107"><a href="#ShadowHand-107"><span class="linenos">107</span></a>
</span><span id="ShadowHand-108"><a href="#ShadowHand-108"><span class="linenos">108</span></a>        <span class="nd">@property</span>
</span><span id="ShadowHand-109"><a href="#ShadowHand-109"><span class="linenos">109</span></a>        <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjData</span><span class="p">:</span>
</span><span id="ShadowHand-110"><a href="#ShadowHand-110"><span class="linenos">110</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</span><span id="ShadowHand-111"><a href="#ShadowHand-111"><span class="linenos">111</span></a>
</span><span id="ShadowHand-112"><a href="#ShadowHand-112"><span class="linenos">112</span></a>        <span class="nd">@property</span>
</span><span id="ShadowHand-113"><a href="#ShadowHand-113"><span class="linenos">113</span></a>        <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjModel</span><span class="p">:</span>
</span><span id="ShadowHand-114"><a href="#ShadowHand-114"><span class="linenos">114</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span>
</span><span id="ShadowHand-115"><a href="#ShadowHand-115"><span class="linenos">115</span></a>
</span><span id="ShadowHand-116"><a href="#ShadowHand-116"><span class="linenos">116</span></a>        <span class="nd">@property</span>
</span><span id="ShadowHand-117"><a href="#ShadowHand-117"><span class="linenos">117</span></a>        <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RobotInfo</span><span class="p">:</span>
</span><span id="ShadowHand-118"><a href="#ShadowHand-118"><span class="linenos">118</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span>
</span><span id="ShadowHand-119"><a href="#ShadowHand-119"><span class="linenos">119</span></a>
</span><span id="ShadowHand-120"><a href="#ShadowHand-120"><span class="linenos">120</span></a>        <span class="nd">@property</span>
</span><span id="ShadowHand-121"><a href="#ShadowHand-121"><span class="linenos">121</span></a>        <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ShadowHand-122"><a href="#ShadowHand-122"><span class="linenos">122</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
</span><span id="ShadowHand-123"><a href="#ShadowHand-123"><span class="linenos">123</span></a>
</span><span id="ShadowHand-124"><a href="#ShadowHand-124"><span class="linenos">124</span></a>        <span class="nd">@property</span>
</span><span id="ShadowHand-125"><a href="#ShadowHand-125"><span class="linenos">125</span></a>        <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ShadowHand-126"><a href="#ShadowHand-126"><span class="linenos">126</span></a>            <span class="k">return</span>
</span><span id="ShadowHand-127"><a href="#ShadowHand-127"><span class="linenos">127</span></a>
</span><span id="ShadowHand-128"><a href="#ShadowHand-128"><span class="linenos">128</span></a>        <span class="k">def</span> <span class="nf">set_ctrl</span><span class="p">(</span>
</span><span id="ShadowHand-129"><a href="#ShadowHand-129"><span class="linenos">129</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">ss</span><span class="p">:</span> <span class="n">SimSync</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span>
</span><span id="ShadowHand-130"><a href="#ShadowHand-130"><span class="linenos">130</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ShadowHand-131"><a href="#ShadowHand-131"><span class="linenos">131</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">n_actuators</span>
</span><span id="ShadowHand-132"><a href="#ShadowHand-132"><span class="linenos">132</span></a>
</span><span id="ShadowHand-133"><a href="#ShadowHand-133"><span class="linenos">133</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="ShadowHand-134"><a href="#ShadowHand-134"><span class="linenos">134</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="ShadowHand-135"><a href="#ShadowHand-135"><span class="linenos">135</span></a>
</span><span id="ShadowHand-136"><a href="#ShadowHand-136"><span class="linenos">136</span></a>            <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span>
</span><span id="ShadowHand-137"><a href="#ShadowHand-137"><span class="linenos">137</span></a>            <span class="n">trajectory_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">timestep</span><span class="p">))</span>
</span><span id="ShadowHand-138"><a href="#ShadowHand-138"><span class="linenos">138</span></a>            <span class="n">t_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">trajectory_samples</span><span class="p">)</span>
</span><span id="ShadowHand-139"><a href="#ShadowHand-139"><span class="linenos">139</span></a>            <span class="n">a_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">actuator_limits</span><span class="o">.</span><span class="n">T</span>
</span><span id="ShadowHand-140"><a href="#ShadowHand-140"><span class="linenos">140</span></a>
</span><span id="ShadowHand-141"><a href="#ShadowHand-141"><span class="linenos">141</span></a>            <span class="n">Q</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">t_array</span><span class="p">,</span> <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
</span><span id="ShadowHand-142"><a href="#ShadowHand-142"><span class="linenos">142</span></a>
</span><span id="ShadowHand-143"><a href="#ShadowHand-143"><span class="linenos">143</span></a>            <span class="n">x_total</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ShadowHand-144"><a href="#ShadowHand-144"><span class="linenos">144</span></a>            <span class="n">is_curling</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
</span><span id="ShadowHand-145"><a href="#ShadowHand-145"><span class="linenos">145</span></a>            <span class="n">in_overflow</span> <span class="o">=</span> <span class="n">x_total</span> <span class="o">&gt;=</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ShadowHand-146"><a href="#ShadowHand-146"><span class="linenos">146</span></a>
</span><span id="ShadowHand-147"><a href="#ShadowHand-147"><span class="linenos">147</span></a>            <span class="n">half_duration</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="ShadowHand-148"><a href="#ShadowHand-148"><span class="linenos">148</span></a>            <span class="n">half_samples</span> <span class="o">=</span> <span class="n">trajectory_samples</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="ShadowHand-149"><a href="#ShadowHand-149"><span class="linenos">149</span></a>            <span class="n">t_array_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">half_duration</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">half_samples</span><span class="p">)</span>
</span><span id="ShadowHand-150"><a href="#ShadowHand-150"><span class="linenos">150</span></a>
</span><span id="ShadowHand-151"><a href="#ShadowHand-151"><span class="linenos">151</span></a>            <span class="k">if</span> <span class="n">is_curling</span><span class="p">:</span>
</span><span id="ShadowHand-152"><a href="#ShadowHand-152"><span class="linenos">152</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">in_overflow</span><span class="p">:</span>
</span><span id="ShadowHand-153"><a href="#ShadowHand-153"><span class="linenos">153</span></a>                    <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_total</span><span class="p">,</span> <span class="mi">0</span>
</span><span id="ShadowHand-154"><a href="#ShadowHand-154"><span class="linenos">154</span></a>                    <span class="n">Q</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span>
</span><span id="ShadowHand-155"><a href="#ShadowHand-155"><span class="linenos">155</span></a>                    <span class="n">Q</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="ShadowHand-156"><a href="#ShadowHand-156"><span class="linenos">156</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_total</span><span class="p">,</span> <span class="n">t_array</span><span class="p">,</span> <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span>
</span><span id="ShadowHand-157"><a href="#ShadowHand-157"><span class="linenos">157</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="ShadowHand-158"><a href="#ShadowHand-158"><span class="linenos">158</span></a>                <span class="k">else</span><span class="p">:</span>  <span class="c1"># is overflow</span>
</span><span id="ShadowHand-159"><a href="#ShadowHand-159"><span class="linenos">159</span></a>                    <span class="c1"># Fill out first phase</span>
</span><span id="ShadowHand-160"><a href="#ShadowHand-160"><span class="linenos">160</span></a>                    <span class="n">Q</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="ShadowHand-161"><a href="#ShadowHand-161"><span class="linenos">161</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ShadowHand-162"><a href="#ShadowHand-162"><span class="linenos">162</span></a>                        <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ShadowHand-163"><a href="#ShadowHand-163"><span class="linenos">163</span></a>                        <span class="n">t_array_1</span><span class="p">,</span>
</span><span id="ShadowHand-164"><a href="#ShadowHand-164"><span class="linenos">164</span></a>                        <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="ShadowHand-165"><a href="#ShadowHand-165"><span class="linenos">165</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="ShadowHand-166"><a href="#ShadowHand-166"><span class="linenos">166</span></a>                    <span class="n">Q</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span>
</span><span id="ShadowHand-167"><a href="#ShadowHand-167"><span class="linenos">167</span></a>
</span><span id="ShadowHand-168"><a href="#ShadowHand-168"><span class="linenos">168</span></a>                    <span class="c1"># Fill out second phase</span>
</span><span id="ShadowHand-169"><a href="#ShadowHand-169"><span class="linenos">169</span></a>                    <span class="n">Q</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ShadowHand-170"><a href="#ShadowHand-170"><span class="linenos">170</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">))</span> <span class="o">*</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ShadowHand-171"><a href="#ShadowHand-171"><span class="linenos">171</span></a>                    <span class="p">)</span>
</span><span id="ShadowHand-172"><a href="#ShadowHand-172"><span class="linenos">172</span></a>                    <span class="n">Q</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="ShadowHand-173"><a href="#ShadowHand-173"><span class="linenos">173</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="ShadowHand-174"><a href="#ShadowHand-174"><span class="linenos">174</span></a>                        <span class="n">x_total</span> <span class="o">-</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ShadowHand-175"><a href="#ShadowHand-175"><span class="linenos">175</span></a>                        <span class="n">t_array</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:],</span>
</span><span id="ShadowHand-176"><a href="#ShadowHand-176"><span class="linenos">176</span></a>                        <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="ShadowHand-177"><a href="#ShadowHand-177"><span class="linenos">177</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="ShadowHand-178"><a href="#ShadowHand-178"><span class="linenos">178</span></a>
</span><span id="ShadowHand-179"><a href="#ShadowHand-179"><span class="linenos">179</span></a>            <span class="k">else</span><span class="p">:</span>  <span class="c1"># is extending</span>
</span><span id="ShadowHand-180"><a href="#ShadowHand-180"><span class="linenos">180</span></a>                <span class="n">in_overflow</span> <span class="o">=</span> <span class="n">x_total</span> <span class="o">&gt;</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ShadowHand-181"><a href="#ShadowHand-181"><span class="linenos">181</span></a>                <span class="n">is_overflow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ShadowHand-182"><a href="#ShadowHand-182"><span class="linenos">182</span></a>
</span><span id="ShadowHand-183"><a href="#ShadowHand-183"><span class="linenos">183</span></a>                <span class="k">if</span> <span class="n">in_overflow</span> <span class="ow">and</span> <span class="n">is_overflow</span><span class="p">:</span>
</span><span id="ShadowHand-184"><a href="#ShadowHand-184"><span class="linenos">184</span></a>                    <span class="c1"># When we extend from a fully curled position</span>
</span><span id="ShadowHand-185"><a href="#ShadowHand-185"><span class="linenos">185</span></a>                    <span class="n">Q</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ShadowHand-186"><a href="#ShadowHand-186"><span class="linenos">186</span></a>                    <span class="n">Q</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="ShadowHand-187"><a href="#ShadowHand-187"><span class="linenos">187</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="ShadowHand-188"><a href="#ShadowHand-188"><span class="linenos">188</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">x_total</span><span class="p">,</span>
</span><span id="ShadowHand-189"><a href="#ShadowHand-189"><span class="linenos">189</span></a>                        <span class="n">t_array</span><span class="p">,</span>
</span><span id="ShadowHand-190"><a href="#ShadowHand-190"><span class="linenos">190</span></a>                        <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="ShadowHand-191"><a href="#ShadowHand-191"><span class="linenos">191</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="ShadowHand-192"><a href="#ShadowHand-192"><span class="linenos">192</span></a>
</span><span id="ShadowHand-193"><a href="#ShadowHand-193"><span class="linenos">193</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">in_overflow</span> <span class="ow">and</span> <span class="n">is_overflow</span><span class="p">:</span>
</span><span id="ShadowHand-194"><a href="#ShadowHand-194"><span class="linenos">194</span></a>                    <span class="c1"># Fill out first phase</span>
</span><span id="ShadowHand-195"><a href="#ShadowHand-195"><span class="linenos">195</span></a>                    <span class="n">Q</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="ShadowHand-196"><a href="#ShadowHand-196"><span class="linenos">196</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="ShadowHand-197"><a href="#ShadowHand-197"><span class="linenos">197</span></a>                        <span class="n">a_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
</span><span id="ShadowHand-198"><a href="#ShadowHand-198"><span class="linenos">198</span></a>                        <span class="n">t_array_1</span><span class="p">,</span>
</span><span id="ShadowHand-199"><a href="#ShadowHand-199"><span class="linenos">199</span></a>                        <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="ShadowHand-200"><a href="#ShadowHand-200"><span class="linenos">200</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="ShadowHand-201"><a href="#ShadowHand-201"><span class="linenos">201</span></a>                    <span class="n">Q</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ShadowHand-202"><a href="#ShadowHand-202"><span class="linenos">202</span></a>
</span><span id="ShadowHand-203"><a href="#ShadowHand-203"><span class="linenos">203</span></a>                    <span class="c1"># Fill out second phase</span>
</span><span id="ShadowHand-204"><a href="#ShadowHand-204"><span class="linenos">204</span></a>                    <span class="n">Q</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ShadowHand-205"><a href="#ShadowHand-205"><span class="linenos">205</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">))</span> <span class="o">*</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ShadowHand-206"><a href="#ShadowHand-206"><span class="linenos">206</span></a>                    <span class="p">)</span>
</span><span id="ShadowHand-207"><a href="#ShadowHand-207"><span class="linenos">207</span></a>
</span><span id="ShadowHand-208"><a href="#ShadowHand-208"><span class="linenos">208</span></a>                    <span class="n">Q</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="ShadowHand-209"><a href="#ShadowHand-209"><span class="linenos">209</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ShadowHand-210"><a href="#ShadowHand-210"><span class="linenos">210</span></a>                        <span class="n">x_total</span><span class="p">,</span>
</span><span id="ShadowHand-211"><a href="#ShadowHand-211"><span class="linenos">211</span></a>                        <span class="n">t_array</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:],</span>
</span><span id="ShadowHand-212"><a href="#ShadowHand-212"><span class="linenos">212</span></a>                        <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="ShadowHand-213"><a href="#ShadowHand-213"><span class="linenos">213</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="ShadowHand-214"><a href="#ShadowHand-214"><span class="linenos">214</span></a>
</span><span id="ShadowHand-215"><a href="#ShadowHand-215"><span class="linenos">215</span></a>            <span class="k">def</span> <span class="nf">_set_ctrl</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
</span><span id="ShadowHand-216"><a href="#ShadowHand-216"><span class="linenos">216</span></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">qi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
</span><span id="ShadowHand-217"><a href="#ShadowHand-217"><span class="linenos">217</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">actuator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">actuator_ids</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">ctrl</span> <span class="o">=</span> <span class="n">qi</span>
</span><span id="ShadowHand-218"><a href="#ShadowHand-218"><span class="linenos">218</span></a>
</span><span id="ShadowHand-219"><a href="#ShadowHand-219"><span class="linenos">219</span></a>            <span class="c1"># execute Q</span>
</span><span id="ShadowHand-220"><a href="#ShadowHand-220"><span class="linenos">220</span></a>            <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">Q</span><span class="p">:</span>
</span><span id="ShadowHand-221"><a href="#ShadowHand-221"><span class="linenos">221</span></a>                <span class="n">_set_ctrl</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</span><span id="ShadowHand-222"><a href="#ShadowHand-222"><span class="linenos">222</span></a>                <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
</span><span id="ShadowHand-223"><a href="#ShadowHand-223"><span class="linenos">223</span></a>
</span><span id="ShadowHand-224"><a href="#ShadowHand-224"><span class="linenos">224</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="ShadowHand-225"><a href="#ShadowHand-225"><span class="linenos">225</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjModel</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjData</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">Type</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span>
</span><span id="ShadowHand-226"><a href="#ShadowHand-226"><span class="linenos">226</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ShadowHand-227"><a href="#ShadowHand-227"><span class="linenos">227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_args</span> <span class="o">=</span> <span class="n">args</span>
</span><span id="ShadowHand-228"><a href="#ShadowHand-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="ShadowHand-229"><a href="#ShadowHand-229"><span class="linenos">229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="ShadowHand-230"><a href="#ShadowHand-230"><span class="linenos">230</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">_shadow_hand&quot;</span>
</span><span id="ShadowHand-231"><a href="#ShadowHand-231"><span class="linenos">231</span></a>
</span><span id="ShadowHand-232"><a href="#ShadowHand-232"><span class="linenos">232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">RobotInfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="ShadowHand-233"><a href="#ShadowHand-233"><span class="linenos">233</span></a>
</span><span id="ShadowHand-234"><a href="#ShadowHand-234"><span class="linenos">234</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="o">.</span><span class="n">FingerType</span><span class="o">.</span><span class="n">FF</span><span class="p">)</span>
</span><span id="ShadowHand-235"><a href="#ShadowHand-235"><span class="linenos">235</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="o">.</span><span class="n">FingerType</span><span class="o">.</span><span class="n">MF</span><span class="p">)</span>
</span><span id="ShadowHand-236"><a href="#ShadowHand-236"><span class="linenos">236</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="o">.</span><span class="n">FingerType</span><span class="o">.</span><span class="n">RF</span><span class="p">)</span>
</span><span id="ShadowHand-237"><a href="#ShadowHand-237"><span class="linenos">237</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="o">.</span><span class="n">FingerType</span><span class="o">.</span><span class="n">LF</span><span class="p">)</span>
</span><span id="ShadowHand-238"><a href="#ShadowHand-238"><span class="linenos">238</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="o">.</span><span class="n">FingerType</span><span class="o">.</span><span class="n">TH</span><span class="p">)</span>
</span><span id="ShadowHand-239"><a href="#ShadowHand-239"><span class="linenos">239</span></a>
</span><span id="ShadowHand-240"><a href="#ShadowHand-240"><span class="linenos">240</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_queue</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
</span><span id="ShadowHand-241"><a href="#ShadowHand-241"><span class="linenos">241</span></a>
</span><span id="ShadowHand-242"><a href="#ShadowHand-242"><span class="linenos">242</span></a>    <span class="nd">@property</span>
</span><span id="ShadowHand-243"><a href="#ShadowHand-243"><span class="linenos">243</span></a>    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjData</span><span class="p">:</span>
</span><span id="ShadowHand-244"><a href="#ShadowHand-244"><span class="linenos">244</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</span><span id="ShadowHand-245"><a href="#ShadowHand-245"><span class="linenos">245</span></a>
</span><span id="ShadowHand-246"><a href="#ShadowHand-246"><span class="linenos">246</span></a>    <span class="nd">@property</span>
</span><span id="ShadowHand-247"><a href="#ShadowHand-247"><span class="linenos">247</span></a>    <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjModel</span><span class="p">:</span>
</span><span id="ShadowHand-248"><a href="#ShadowHand-248"><span class="linenos">248</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span>
</span><span id="ShadowHand-249"><a href="#ShadowHand-249"><span class="linenos">249</span></a>
</span><span id="ShadowHand-250"><a href="#ShadowHand-250"><span class="linenos">250</span></a>    <span class="nd">@property</span>
</span><span id="ShadowHand-251"><a href="#ShadowHand-251"><span class="linenos">251</span></a>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ShadowHand-252"><a href="#ShadowHand-252"><span class="linenos">252</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
</span><span id="ShadowHand-253"><a href="#ShadowHand-253"><span class="linenos">253</span></a>
</span><span id="ShadowHand-254"><a href="#ShadowHand-254"><span class="linenos">254</span></a>    <span class="nd">@property</span>
</span><span id="ShadowHand-255"><a href="#ShadowHand-255"><span class="linenos">255</span></a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RobotInfo</span><span class="p">:</span>
</span><span id="ShadowHand-256"><a href="#ShadowHand-256"><span class="linenos">256</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span>
</span><span id="ShadowHand-257"><a href="#ShadowHand-257"><span class="linenos">257</span></a>
</span><span id="ShadowHand-258"><a href="#ShadowHand-258"><span class="linenos">258</span></a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ShadowHand-259"><a href="#ShadowHand-259"><span class="linenos">259</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_queue</span><span class="p">:</span>
</span><span id="ShadowHand-260"><a href="#ShadowHand-260"><span class="linenos">260</span></a>            <span class="n">ctrl_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_queue</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
</span><span id="ShadowHand-261"><a href="#ShadowHand-261"><span class="linenos">261</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_ctrl</span><span class="p">(</span><span class="n">ctrl_target</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Base class for robot simulation in MuJoCo.</p>

<p>This class provides a framework for simulating robots in MuJoCo environments. It defines
key properties and methods that should be implemented in child classes, including access
to the robot's model, data, and control mechanisms.</p>
</div>


                            <div id="ShadowHand.__init__" class="classattr">
                                        <input id="ShadowHand.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ShadowHand</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">model</span><span class="p">:</span> <span class="n">mujoco</span><span class="o">.</span><span class="n">_structs</span><span class="o">.</span><span class="n">MjModel</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">mujoco</span><span class="o">.</span><span class="n">_structs</span><span class="o">.</span><span class="n">MjData</span>,</span><span class="param">	<span class="nb">type</span><span class="p">:</span> <span class="n"><a href="#ShadowHand.Type">ShadowHand.Type</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">Type</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">:</span> <span class="s1">&#39;right&#39;</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">args</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="ShadowHand.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ShadowHand.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ShadowHand.__init__-224"><a href="#ShadowHand.__init__-224"><span class="linenos">224</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="ShadowHand.__init__-225"><a href="#ShadowHand.__init__-225"><span class="linenos">225</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjModel</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjData</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">Type</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span>
</span><span id="ShadowHand.__init__-226"><a href="#ShadowHand.__init__-226"><span class="linenos">226</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ShadowHand.__init__-227"><a href="#ShadowHand.__init__-227"><span class="linenos">227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_args</span> <span class="o">=</span> <span class="n">args</span>
</span><span id="ShadowHand.__init__-228"><a href="#ShadowHand.__init__-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="ShadowHand.__init__-229"><a href="#ShadowHand.__init__-229"><span class="linenos">229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="ShadowHand.__init__-230"><a href="#ShadowHand.__init__-230"><span class="linenos">230</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">_shadow_hand&quot;</span>
</span><span id="ShadowHand.__init__-231"><a href="#ShadowHand.__init__-231"><span class="linenos">231</span></a>
</span><span id="ShadowHand.__init__-232"><a href="#ShadowHand.__init__-232"><span class="linenos">232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">RobotInfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="ShadowHand.__init__-233"><a href="#ShadowHand.__init__-233"><span class="linenos">233</span></a>
</span><span id="ShadowHand.__init__-234"><a href="#ShadowHand.__init__-234"><span class="linenos">234</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="o">.</span><span class="n">FingerType</span><span class="o">.</span><span class="n">FF</span><span class="p">)</span>
</span><span id="ShadowHand.__init__-235"><a href="#ShadowHand.__init__-235"><span class="linenos">235</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="o">.</span><span class="n">FingerType</span><span class="o">.</span><span class="n">MF</span><span class="p">)</span>
</span><span id="ShadowHand.__init__-236"><a href="#ShadowHand.__init__-236"><span class="linenos">236</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="o">.</span><span class="n">FingerType</span><span class="o">.</span><span class="n">RF</span><span class="p">)</span>
</span><span id="ShadowHand.__init__-237"><a href="#ShadowHand.__init__-237"><span class="linenos">237</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="o">.</span><span class="n">FingerType</span><span class="o">.</span><span class="n">LF</span><span class="p">)</span>
</span><span id="ShadowHand.__init__-238"><a href="#ShadowHand.__init__-238"><span class="linenos">238</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShadowFinger</span><span class="o">.</span><span class="n">FingerType</span><span class="o">.</span><span class="n">TH</span><span class="p">)</span>
</span><span id="ShadowHand.__init__-239"><a href="#ShadowHand.__init__-239"><span class="linenos">239</span></a>
</span><span id="ShadowHand.__init__-240"><a href="#ShadowHand.__init__-240"><span class="linenos">240</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_queue</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="ShadowHand.ff" class="classattr">
                                <div class="attr variable">
            <span class="name">ff</span>

        
    </div>
    <a class="headerlink" href="#ShadowHand.ff"></a>
    
    

                            </div>
                            <div id="ShadowHand.mf" class="classattr">
                                <div class="attr variable">
            <span class="name">mf</span>

        
    </div>
    <a class="headerlink" href="#ShadowHand.mf"></a>
    
    

                            </div>
                            <div id="ShadowHand.rf" class="classattr">
                                <div class="attr variable">
            <span class="name">rf</span>

        
    </div>
    <a class="headerlink" href="#ShadowHand.rf"></a>
    
    

                            </div>
                            <div id="ShadowHand.lf" class="classattr">
                                <div class="attr variable">
            <span class="name">lf</span>

        
    </div>
    <a class="headerlink" href="#ShadowHand.lf"></a>
    
    

                            </div>
                            <div id="ShadowHand.th" class="classattr">
                                <div class="attr variable">
            <span class="name">th</span>

        
    </div>
    <a class="headerlink" href="#ShadowHand.th"></a>
    
    

                            </div>
                            <div id="ShadowHand.data" class="classattr">
                                        <input id="ShadowHand.data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">data</span><span class="annotation">: mujoco._structs.MjData</span>

                <label class="view-source-button" for="ShadowHand.data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ShadowHand.data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ShadowHand.data-242"><a href="#ShadowHand.data-242"><span class="linenos">242</span></a>    <span class="nd">@property</span>
</span><span id="ShadowHand.data-243"><a href="#ShadowHand.data-243"><span class="linenos">243</span></a>    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjData</span><span class="p">:</span>
</span><span id="ShadowHand.data-244"><a href="#ShadowHand.data-244"><span class="linenos">244</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</span></pre></div>


            <div class="docstring"><p>Access the current simulation data.</p>

<p>This property provides access to an instance of the <code>MjData</code> class, which contains the dynamic
simulation state. This includes quantities such as joint positions, velocities,
actuator forces, and sensory information. The <code>MjData</code> object is updated at each simulation step
and can be used to inspect the real-time state of the robot during the simulation.</p>

<h2 id="returns">Returns</h2>

<p>mj.MjData
    An object representing the current dynamic state of the simulation.</p>
</div>


                            </div>
                            <div id="ShadowHand.model" class="classattr">
                                        <input id="ShadowHand.model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">model</span><span class="annotation">: mujoco._structs.MjModel</span>

                <label class="view-source-button" for="ShadowHand.model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ShadowHand.model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ShadowHand.model-246"><a href="#ShadowHand.model-246"><span class="linenos">246</span></a>    <span class="nd">@property</span>
</span><span id="ShadowHand.model-247"><a href="#ShadowHand.model-247"><span class="linenos">247</span></a>    <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjModel</span><span class="p">:</span>
</span><span id="ShadowHand.model-248"><a href="#ShadowHand.model-248"><span class="linenos">248</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span>
</span></pre></div>


            <div class="docstring"><p>Access the model of the MuJoCo simulation.</p>

<p>This property returns an instance of the <code>MjModel</code> class, which describes the physical and
mechanical properties of the simulation. The <code>MjModel</code> object contains static information about the
robot such as its kinematic tree, inertial properties, joint and actuator definitions, and geometry
configurations. It is used to define the robot's structure and behavior within the simulation.</p>

<h2 id="returns">Returns</h2>

<p>mj.MjModel
    An object representing the static model of the robot and overall MuJoCo simulation.</p>
</div>


                            </div>
                            <div id="ShadowHand.name" class="classattr">
                                        <input id="ShadowHand.name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">name</span><span class="annotation">: str</span>

                <label class="view-source-button" for="ShadowHand.name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ShadowHand.name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ShadowHand.name-250"><a href="#ShadowHand.name-250"><span class="linenos">250</span></a>    <span class="nd">@property</span>
</span><span id="ShadowHand.name-251"><a href="#ShadowHand.name-251"><span class="linenos">251</span></a>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ShadowHand.name-252"><a href="#ShadowHand.name-252"><span class="linenos">252</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
</span></pre></div>


            <div class="docstring"><p>Get the name of the robot.</p>

<p>This property returns the name of the robot as a string. The name is typically a unique identifier
used to distinguish between different robots in the simulation environment.</p>

<h2 id="returns">Returns</h2>

<p>str
    The name of the robot as a string.</p>
</div>


                            </div>
                            <div id="ShadowHand.info" class="classattr">
                                        <input id="ShadowHand.info-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">info</span><span class="annotation">: <a href="../utils/mj.html#RobotInfo">utils.mj.RobotInfo</a></span>

                <label class="view-source-button" for="ShadowHand.info-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ShadowHand.info"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ShadowHand.info-254"><a href="#ShadowHand.info-254"><span class="linenos">254</span></a>    <span class="nd">@property</span>
</span><span id="ShadowHand.info-255"><a href="#ShadowHand.info-255"><span class="linenos">255</span></a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RobotInfo</span><span class="p">:</span>
</span><span id="ShadowHand.info-256"><a href="#ShadowHand.info-256"><span class="linenos">256</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span>
</span></pre></div>


            <div class="docstring"><p>Get detailed information about the robot.</p>

<p>This property returns an instance of the <code>RobotInfo</code> class, which provides comprehensive
details about the robot's structure and components. This includes information on the robot's
bodies, joints, actuators, and geometries, among other attributes. The <code>RobotInfo</code> instance
can be used to access various properties such as the number of joints, actuator limits, joint
limits, and more.</p>

<h2 id="returns">Returns</h2>

<p>RobotInfo
    An object containing detailed information about the robot's configuration and components.</p>
</div>


                            </div>
                            <div id="ShadowHand.step" class="classattr">
                                        <input id="ShadowHand.step-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">step</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ShadowHand.step-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ShadowHand.step"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ShadowHand.step-258"><a href="#ShadowHand.step-258"><span class="linenos">258</span></a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ShadowHand.step-259"><a href="#ShadowHand.step-259"><span class="linenos">259</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_queue</span><span class="p">:</span>
</span><span id="ShadowHand.step-260"><a href="#ShadowHand.step-260"><span class="linenos">260</span></a>            <span class="n">ctrl_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_queue</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
</span><span id="ShadowHand.step-261"><a href="#ShadowHand.step-261"><span class="linenos">261</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_ctrl</span><span class="p">(</span><span class="n">ctrl_target</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform a step in the controller.</p>

<p>This method calls the <code><a href="#ShadowHand.step">step()</a></code> method of the controller object and
before doing so it checks if there are any tasks to be performed in
the robot task queue</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="base_robot.html#BaseRobot">robots.base_robot.BaseRobot</a></dt>
                                <dd id="ShadowHand.set_ctrl" class="function"><a href="base_robot.html#BaseRobot.set_ctrl">set_ctrl</a></dd>
                <dd id="ShadowHand.ctrl" class="variable"><a href="base_robot.html#BaseRobot.ctrl">ctrl</a></dd>
                <dd id="ShadowHand.Jp" class="variable"><a href="base_robot.html#BaseRobot.Jp">Jp</a></dd>
                <dd id="ShadowHand.Jo" class="variable"><a href="base_robot.html#BaseRobot.Jo">Jo</a></dd>
                <dd id="ShadowHand.J" class="variable"><a href="base_robot.html#BaseRobot.J">J</a></dd>
                <dd id="ShadowHand.c" class="variable"><a href="base_robot.html#BaseRobot.c">c</a></dd>
                <dd id="ShadowHand.Mq" class="variable"><a href="base_robot.html#BaseRobot.Mq">Mq</a></dd>
                <dd id="ShadowHand.Mx" class="variable"><a href="base_robot.html#BaseRobot.Mx">Mx</a></dd>
                <dd id="ShadowHand.q" class="variable"><a href="base_robot.html#BaseRobot.q">q</a></dd>
                <dd id="ShadowHand.dq" class="variable"><a href="base_robot.html#BaseRobot.dq">dq</a></dd>
                <dd id="ShadowHand.ddq" class="variable"><a href="base_robot.html#BaseRobot.ddq">ddq</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ShadowHand.Type">
                            <input id="ShadowHand.Type-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ShadowHand.Type</span><wbr>(<span class="base">enum.Enum</span>):

                <label class="view-source-button" for="ShadowHand.Type-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ShadowHand.Type"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ShadowHand.Type-19"><a href="#ShadowHand.Type-19"><span class="linenos">19</span></a>    <span class="k">class</span> <span class="nc">Type</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="ShadowHand.Type-20"><a href="#ShadowHand.Type-20"><span class="linenos">20</span></a>        <span class="n">RIGHT</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span>
</span><span id="ShadowHand.Type-21"><a href="#ShadowHand.Type-21"><span class="linenos">21</span></a>        <span class="n">LEFT</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
</span></pre></div>


    

                            <div id="ShadowHand.Type.RIGHT" class="classattr">
                                <div class="attr variable">
            <span class="name">RIGHT</span>        =
<span class="default_value">&lt;Type.RIGHT: &#39;right&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#ShadowHand.Type.RIGHT"></a>
    
    

                            </div>
                            <div id="ShadowHand.Type.LEFT" class="classattr">
                                <div class="attr variable">
            <span class="name">LEFT</span>        =
<span class="default_value">&lt;Type.LEFT: &#39;left&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#ShadowHand.Type.LEFT"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>enum.Enum</dt>
                                <dd id="ShadowHand.Type.name" class="variable">name</dd>
                <dd id="ShadowHand.Type.value" class="variable">value</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ShadowHand.ShadowFinger">
                            <input id="ShadowHand.ShadowFinger-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ShadowHand.ShadowFinger</span><wbr>(<span class="base"><a href="base_robot.html#BaseRobot">robots.base_robot.BaseRobot</a></span>):

                <label class="view-source-button" for="ShadowHand.ShadowFinger-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ShadowHand.ShadowFinger"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ShadowHand.ShadowFinger-23"><a href="#ShadowHand.ShadowFinger-23"><span class="linenos"> 23</span></a>    <span class="k">class</span> <span class="nc">ShadowFinger</span><span class="p">(</span><span class="n">BaseRobot</span><span class="p">):</span>
</span><span id="ShadowHand.ShadowFinger-24"><a href="#ShadowHand.ShadowFinger-24"><span class="linenos"> 24</span></a>        <span class="k">class</span> <span class="nc">FingerType</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="ShadowHand.ShadowFinger-25"><a href="#ShadowHand.ShadowFinger-25"><span class="linenos"> 25</span></a>            <span class="n">FF</span> <span class="o">=</span> <span class="s2">&quot;FF&quot;</span>
</span><span id="ShadowHand.ShadowFinger-26"><a href="#ShadowHand.ShadowFinger-26"><span class="linenos"> 26</span></a>            <span class="n">MF</span> <span class="o">=</span> <span class="s2">&quot;MF&quot;</span>
</span><span id="ShadowHand.ShadowFinger-27"><a href="#ShadowHand.ShadowFinger-27"><span class="linenos"> 27</span></a>            <span class="n">RF</span> <span class="o">=</span> <span class="s2">&quot;RF&quot;</span>
</span><span id="ShadowHand.ShadowFinger-28"><a href="#ShadowHand.ShadowFinger-28"><span class="linenos"> 28</span></a>            <span class="n">LF</span> <span class="o">=</span> <span class="s2">&quot;LF&quot;</span>
</span><span id="ShadowHand.ShadowFinger-29"><a href="#ShadowHand.ShadowFinger-29"><span class="linenos"> 29</span></a>            <span class="n">TH</span> <span class="o">=</span> <span class="s2">&quot;TH&quot;</span>
</span><span id="ShadowHand.ShadowFinger-30"><a href="#ShadowHand.ShadowFinger-30"><span class="linenos"> 30</span></a>
</span><span id="ShadowHand.ShadowFinger-31"><a href="#ShadowHand.ShadowFinger-31"><span class="linenos"> 31</span></a>        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sh</span><span class="p">:</span> <span class="s2">&quot;ShadowHand&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="n">FingerType</span><span class="p">):</span>
</span><span id="ShadowHand.ShadowFinger-32"><a href="#ShadowHand.ShadowFinger-32"><span class="linenos"> 32</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">data</span>
</span><span id="ShadowHand.ShadowFinger-33"><a href="#ShadowHand.ShadowFinger-33"><span class="linenos"> 33</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">model</span>
</span><span id="ShadowHand.ShadowFinger-34"><a href="#ShadowHand.ShadowFinger-34"><span class="linenos"> 34</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="nb">type</span>
</span><span id="ShadowHand.ShadowFinger-35"><a href="#ShadowHand.ShadowFinger-35"><span class="linenos"> 35</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="nb">type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ShadowHand.ShadowFinger-36"><a href="#ShadowHand.ShadowFinger-36"><span class="linenos"> 36</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">RobotInfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger-37"><a href="#ShadowHand.ShadowFinger-37"><span class="linenos"> 37</span></a>
</span><span id="ShadowHand.ShadowFinger-38"><a href="#ShadowHand.ShadowFinger-38"><span class="linenos"> 38</span></a>            <span class="c1"># custom naming</span>
</span><span id="ShadowHand.ShadowFinger-39"><a href="#ShadowHand.ShadowFinger-39"><span class="linenos"> 39</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">body_names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ShadowHand.ShadowFinger-40"><a href="#ShadowHand.ShadowFinger-40"><span class="linenos"> 40</span></a>                <span class="n">bna</span> <span class="k">for</span> <span class="n">bna</span> <span class="ow">in</span> <span class="n">get_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">BODY</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;ff&quot;</span> <span class="ow">in</span> <span class="n">bna</span>
</span><span id="ShadowHand.ShadowFinger-41"><a href="#ShadowHand.ShadowFinger-41"><span class="linenos"> 41</span></a>            <span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger-42"><a href="#ShadowHand.ShadowFinger-42"><span class="linenos"> 42</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">body_ids</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ShadowHand.ShadowFinger-43"><a href="#ShadowHand.ShadowFinger-43"><span class="linenos"> 43</span></a>                <span class="n">name2id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">bna</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">BODY</span><span class="p">)</span> <span class="k">for</span> <span class="n">bna</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">body_names</span>
</span><span id="ShadowHand.ShadowFinger-44"><a href="#ShadowHand.ShadowFinger-44"><span class="linenos"> 44</span></a>            <span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger-45"><a href="#ShadowHand.ShadowFinger-45"><span class="linenos"> 45</span></a>
</span><span id="ShadowHand.ShadowFinger-46"><a href="#ShadowHand.ShadowFinger-46"><span class="linenos"> 46</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">geom_ids</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ShadowHand.ShadowFinger-47"><a href="#ShadowHand.ShadowFinger-47"><span class="linenos"> 47</span></a>                <span class="n">geom_id</span>
</span><span id="ShadowHand.ShadowFinger-48"><a href="#ShadowHand.ShadowFinger-48"><span class="linenos"> 48</span></a>                <span class="k">for</span> <span class="n">geom_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">ngeom</span><span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger-49"><a href="#ShadowHand.ShadowFinger-49"><span class="linenos"> 49</span></a>                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geom_bodyid</span><span class="p">[</span><span class="n">geom_id</span><span class="p">])</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">body_ids</span>
</span><span id="ShadowHand.ShadowFinger-50"><a href="#ShadowHand.ShadowFinger-50"><span class="linenos"> 50</span></a>            <span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger-51"><a href="#ShadowHand.ShadowFinger-51"><span class="linenos"> 51</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">geom_names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ShadowHand.ShadowFinger-52"><a href="#ShadowHand.ShadowFinger-52"><span class="linenos"> 52</span></a>                <span class="n">id2name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">GEOM</span><span class="p">)</span> <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">geom_ids</span>
</span><span id="ShadowHand.ShadowFinger-53"><a href="#ShadowHand.ShadowFinger-53"><span class="linenos"> 53</span></a>            <span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger-54"><a href="#ShadowHand.ShadowFinger-54"><span class="linenos"> 54</span></a>
</span><span id="ShadowHand.ShadowFinger-55"><a href="#ShadowHand.ShadowFinger-55"><span class="linenos"> 55</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">site_names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ShadowHand.ShadowFinger-56"><a href="#ShadowHand.ShadowFinger-56"><span class="linenos"> 56</span></a>                <span class="n">sna</span>
</span><span id="ShadowHand.ShadowFinger-57"><a href="#ShadowHand.ShadowFinger-57"><span class="linenos"> 57</span></a>                <span class="k">for</span> <span class="n">sna</span> <span class="ow">in</span> <span class="n">get_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">SITE</span><span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger-58"><a href="#ShadowHand.ShadowFinger-58"><span class="linenos"> 58</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">sna</span>
</span><span id="ShadowHand.ShadowFinger-59"><a href="#ShadowHand.ShadowFinger-59"><span class="linenos"> 59</span></a>            <span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger-60"><a href="#ShadowHand.ShadowFinger-60"><span class="linenos"> 60</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">site_ids</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ShadowHand.ShadowFinger-61"><a href="#ShadowHand.ShadowFinger-61"><span class="linenos"> 61</span></a>                <span class="n">name2id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">sna</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">SITE</span><span class="p">)</span> <span class="k">for</span> <span class="n">sna</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">site_names</span>
</span><span id="ShadowHand.ShadowFinger-62"><a href="#ShadowHand.ShadowFinger-62"><span class="linenos"> 62</span></a>            <span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger-63"><a href="#ShadowHand.ShadowFinger-63"><span class="linenos"> 63</span></a>
</span><span id="ShadowHand.ShadowFinger-64"><a href="#ShadowHand.ShadowFinger-64"><span class="linenos"> 64</span></a>        <span class="nd">@property</span>
</span><span id="ShadowHand.ShadowFinger-65"><a href="#ShadowHand.ShadowFinger-65"><span class="linenos"> 65</span></a>        <span class="k">def</span> <span class="nf">J</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger-66"><a href="#ShadowHand.ShadowFinger-66"><span class="linenos"> 66</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ShadowHand.ShadowFinger-67"><a href="#ShadowHand.ShadowFinger-67"><span class="linenos"> 67</span></a><span class="sd">            Get the full Jacobian in base frame.</span>
</span><span id="ShadowHand.ShadowFinger-68"><a href="#ShadowHand.ShadowFinger-68"><span class="linenos"> 68</span></a>
</span><span id="ShadowHand.ShadowFinger-69"><a href="#ShadowHand.ShadowFinger-69"><span class="linenos"> 69</span></a><span class="sd">            Returns</span>
</span><span id="ShadowHand.ShadowFinger-70"><a href="#ShadowHand.ShadowFinger-70"><span class="linenos"> 70</span></a><span class="sd">            ----------</span>
</span><span id="ShadowHand.ShadowFinger-71"><a href="#ShadowHand.ShadowFinger-71"><span class="linenos"> 71</span></a><span class="sd">                    Full Jacobian as a numpy array.</span>
</span><span id="ShadowHand.ShadowFinger-72"><a href="#ShadowHand.ShadowFinger-72"><span class="linenos"> 72</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="ShadowHand.ShadowFinger-73"><a href="#ShadowHand.ShadowFinger-73"><span class="linenos"> 73</span></a>            <span class="n">sys_J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nv</span><span class="p">))</span>
</span><span id="ShadowHand.ShadowFinger-74"><a href="#ShadowHand.ShadowFinger-74"><span class="linenos"> 74</span></a>
</span><span id="ShadowHand.ShadowFinger-75"><a href="#ShadowHand.ShadowFinger-75"><span class="linenos"> 75</span></a>            <span class="n">mj</span><span class="o">.</span><span class="n">mj_jacSite</span><span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger-76"><a href="#ShadowHand.ShadowFinger-76"><span class="linenos"> 76</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger-77"><a href="#ShadowHand.ShadowFinger-77"><span class="linenos"> 77</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger-78"><a href="#ShadowHand.ShadowFinger-78"><span class="linenos"> 78</span></a>                <span class="n">sys_J</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span>
</span><span id="ShadowHand.ShadowFinger-79"><a href="#ShadowHand.ShadowFinger-79"><span class="linenos"> 79</span></a>                <span class="n">sys_J</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span>
</span><span id="ShadowHand.ShadowFinger-80"><a href="#ShadowHand.ShadowFinger-80"><span class="linenos"> 80</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">site_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="ShadowHand.ShadowFinger-81"><a href="#ShadowHand.ShadowFinger-81"><span class="linenos"> 81</span></a>                <span class="c1"># name2id(self.model, f&quot;{self.name}/{self.info.site_names[0]}&quot;, ObjType.SITE),</span>
</span><span id="ShadowHand.ShadowFinger-82"><a href="#ShadowHand.ShadowFinger-82"><span class="linenos"> 82</span></a>            <span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger-83"><a href="#ShadowHand.ShadowFinger-83"><span class="linenos"> 83</span></a>
</span><span id="ShadowHand.ShadowFinger-84"><a href="#ShadowHand.ShadowFinger-84"><span class="linenos"> 84</span></a>            <span class="c1"># get only the dofs for this robot</span>
</span><span id="ShadowHand.ShadowFinger-85"><a href="#ShadowHand.ShadowFinger-85"><span class="linenos"> 85</span></a>            <span class="n">sys_J</span> <span class="o">=</span> <span class="n">sys_J</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">_dof_indxs</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger-86"><a href="#ShadowHand.ShadowFinger-86"><span class="linenos"> 86</span></a>
</span><span id="ShadowHand.ShadowFinger-87"><a href="#ShadowHand.ShadowFinger-87"><span class="linenos"> 87</span></a>            <span class="c1"># convert from world frame to base frame</span>
</span><span id="ShadowHand.ShadowFinger-88"><a href="#ShadowHand.ShadowFinger-88"><span class="linenos"> 88</span></a>            <span class="n">sys_J</span><span class="p">[</span><span class="mi">3</span><span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger-89"><a href="#ShadowHand.ShadowFinger-89"><span class="linenos"> 89</span></a>                <span class="n">get_pose</span><span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger-90"><a href="#ShadowHand.ShadowFinger-90"><span class="linenos"> 90</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger-91"><a href="#ShadowHand.ShadowFinger-91"><span class="linenos"> 91</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger-92"><a href="#ShadowHand.ShadowFinger-92"><span class="linenos"> 92</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sh</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/rh_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">knuckle&quot;</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger-93"><a href="#ShadowHand.ShadowFinger-93"><span class="linenos"> 93</span></a>                    <span class="n">ObjType</span><span class="o">.</span><span class="n">BODY</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger-94"><a href="#ShadowHand.ShadowFinger-94"><span class="linenos"> 94</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">R</span>
</span><span id="ShadowHand.ShadowFinger-95"><a href="#ShadowHand.ShadowFinger-95"><span class="linenos"> 95</span></a>                <span class="o">@</span> <span class="n">sys_J</span><span class="p">[</span><span class="mi">3</span><span class="p">:,</span> <span class="p">:]</span>
</span><span id="ShadowHand.ShadowFinger-96"><a href="#ShadowHand.ShadowFinger-96"><span class="linenos"> 96</span></a>            <span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger-97"><a href="#ShadowHand.ShadowFinger-97"><span class="linenos"> 97</span></a>            <span class="n">sys_J</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger-98"><a href="#ShadowHand.ShadowFinger-98"><span class="linenos"> 98</span></a>                <span class="n">get_pose</span><span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger-99"><a href="#ShadowHand.ShadowFinger-99"><span class="linenos"> 99</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger-100"><a href="#ShadowHand.ShadowFinger-100"><span class="linenos">100</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger-101"><a href="#ShadowHand.ShadowFinger-101"><span class="linenos">101</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sh</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/rh_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">knuckle&quot;</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger-102"><a href="#ShadowHand.ShadowFinger-102"><span class="linenos">102</span></a>                    <span class="n">ObjType</span><span class="o">.</span><span class="n">BODY</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger-103"><a href="#ShadowHand.ShadowFinger-103"><span class="linenos">103</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">R</span>
</span><span id="ShadowHand.ShadowFinger-104"><a href="#ShadowHand.ShadowFinger-104"><span class="linenos">104</span></a>                <span class="o">@</span> <span class="n">sys_J</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="ShadowHand.ShadowFinger-105"><a href="#ShadowHand.ShadowFinger-105"><span class="linenos">105</span></a>            <span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger-106"><a href="#ShadowHand.ShadowFinger-106"><span class="linenos">106</span></a>            <span class="k">return</span> <span class="n">sys_J</span>
</span><span id="ShadowHand.ShadowFinger-107"><a href="#ShadowHand.ShadowFinger-107"><span class="linenos">107</span></a>
</span><span id="ShadowHand.ShadowFinger-108"><a href="#ShadowHand.ShadowFinger-108"><span class="linenos">108</span></a>        <span class="nd">@property</span>
</span><span id="ShadowHand.ShadowFinger-109"><a href="#ShadowHand.ShadowFinger-109"><span class="linenos">109</span></a>        <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjData</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger-110"><a href="#ShadowHand.ShadowFinger-110"><span class="linenos">110</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</span><span id="ShadowHand.ShadowFinger-111"><a href="#ShadowHand.ShadowFinger-111"><span class="linenos">111</span></a>
</span><span id="ShadowHand.ShadowFinger-112"><a href="#ShadowHand.ShadowFinger-112"><span class="linenos">112</span></a>        <span class="nd">@property</span>
</span><span id="ShadowHand.ShadowFinger-113"><a href="#ShadowHand.ShadowFinger-113"><span class="linenos">113</span></a>        <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjModel</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger-114"><a href="#ShadowHand.ShadowFinger-114"><span class="linenos">114</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span>
</span><span id="ShadowHand.ShadowFinger-115"><a href="#ShadowHand.ShadowFinger-115"><span class="linenos">115</span></a>
</span><span id="ShadowHand.ShadowFinger-116"><a href="#ShadowHand.ShadowFinger-116"><span class="linenos">116</span></a>        <span class="nd">@property</span>
</span><span id="ShadowHand.ShadowFinger-117"><a href="#ShadowHand.ShadowFinger-117"><span class="linenos">117</span></a>        <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RobotInfo</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger-118"><a href="#ShadowHand.ShadowFinger-118"><span class="linenos">118</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span>
</span><span id="ShadowHand.ShadowFinger-119"><a href="#ShadowHand.ShadowFinger-119"><span class="linenos">119</span></a>
</span><span id="ShadowHand.ShadowFinger-120"><a href="#ShadowHand.ShadowFinger-120"><span class="linenos">120</span></a>        <span class="nd">@property</span>
</span><span id="ShadowHand.ShadowFinger-121"><a href="#ShadowHand.ShadowFinger-121"><span class="linenos">121</span></a>        <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger-122"><a href="#ShadowHand.ShadowFinger-122"><span class="linenos">122</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
</span><span id="ShadowHand.ShadowFinger-123"><a href="#ShadowHand.ShadowFinger-123"><span class="linenos">123</span></a>
</span><span id="ShadowHand.ShadowFinger-124"><a href="#ShadowHand.ShadowFinger-124"><span class="linenos">124</span></a>        <span class="nd">@property</span>
</span><span id="ShadowHand.ShadowFinger-125"><a href="#ShadowHand.ShadowFinger-125"><span class="linenos">125</span></a>        <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger-126"><a href="#ShadowHand.ShadowFinger-126"><span class="linenos">126</span></a>            <span class="k">return</span>
</span><span id="ShadowHand.ShadowFinger-127"><a href="#ShadowHand.ShadowFinger-127"><span class="linenos">127</span></a>
</span><span id="ShadowHand.ShadowFinger-128"><a href="#ShadowHand.ShadowFinger-128"><span class="linenos">128</span></a>        <span class="k">def</span> <span class="nf">set_ctrl</span><span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger-129"><a href="#ShadowHand.ShadowFinger-129"><span class="linenos">129</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">ss</span><span class="p">:</span> <span class="n">SimSync</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span>
</span><span id="ShadowHand.ShadowFinger-130"><a href="#ShadowHand.ShadowFinger-130"><span class="linenos">130</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger-131"><a href="#ShadowHand.ShadowFinger-131"><span class="linenos">131</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">n_actuators</span>
</span><span id="ShadowHand.ShadowFinger-132"><a href="#ShadowHand.ShadowFinger-132"><span class="linenos">132</span></a>
</span><span id="ShadowHand.ShadowFinger-133"><a href="#ShadowHand.ShadowFinger-133"><span class="linenos">133</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="ShadowHand.ShadowFinger-134"><a href="#ShadowHand.ShadowFinger-134"><span class="linenos">134</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger-135"><a href="#ShadowHand.ShadowFinger-135"><span class="linenos">135</span></a>
</span><span id="ShadowHand.ShadowFinger-136"><a href="#ShadowHand.ShadowFinger-136"><span class="linenos">136</span></a>            <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span>
</span><span id="ShadowHand.ShadowFinger-137"><a href="#ShadowHand.ShadowFinger-137"><span class="linenos">137</span></a>            <span class="n">trajectory_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">timestep</span><span class="p">))</span>
</span><span id="ShadowHand.ShadowFinger-138"><a href="#ShadowHand.ShadowFinger-138"><span class="linenos">138</span></a>            <span class="n">t_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">trajectory_samples</span><span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger-139"><a href="#ShadowHand.ShadowFinger-139"><span class="linenos">139</span></a>            <span class="n">a_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">actuator_limits</span><span class="o">.</span><span class="n">T</span>
</span><span id="ShadowHand.ShadowFinger-140"><a href="#ShadowHand.ShadowFinger-140"><span class="linenos">140</span></a>
</span><span id="ShadowHand.ShadowFinger-141"><a href="#ShadowHand.ShadowFinger-141"><span class="linenos">141</span></a>            <span class="n">Q</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">t_array</span><span class="p">,</span> <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger-142"><a href="#ShadowHand.ShadowFinger-142"><span class="linenos">142</span></a>
</span><span id="ShadowHand.ShadowFinger-143"><a href="#ShadowHand.ShadowFinger-143"><span class="linenos">143</span></a>            <span class="n">x_total</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger-144"><a href="#ShadowHand.ShadowFinger-144"><span class="linenos">144</span></a>            <span class="n">is_curling</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
</span><span id="ShadowHand.ShadowFinger-145"><a href="#ShadowHand.ShadowFinger-145"><span class="linenos">145</span></a>            <span class="n">in_overflow</span> <span class="o">=</span> <span class="n">x_total</span> <span class="o">&gt;=</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger-146"><a href="#ShadowHand.ShadowFinger-146"><span class="linenos">146</span></a>
</span><span id="ShadowHand.ShadowFinger-147"><a href="#ShadowHand.ShadowFinger-147"><span class="linenos">147</span></a>            <span class="n">half_duration</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="ShadowHand.ShadowFinger-148"><a href="#ShadowHand.ShadowFinger-148"><span class="linenos">148</span></a>            <span class="n">half_samples</span> <span class="o">=</span> <span class="n">trajectory_samples</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="ShadowHand.ShadowFinger-149"><a href="#ShadowHand.ShadowFinger-149"><span class="linenos">149</span></a>            <span class="n">t_array_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">half_duration</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">half_samples</span><span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger-150"><a href="#ShadowHand.ShadowFinger-150"><span class="linenos">150</span></a>
</span><span id="ShadowHand.ShadowFinger-151"><a href="#ShadowHand.ShadowFinger-151"><span class="linenos">151</span></a>            <span class="k">if</span> <span class="n">is_curling</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger-152"><a href="#ShadowHand.ShadowFinger-152"><span class="linenos">152</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">in_overflow</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger-153"><a href="#ShadowHand.ShadowFinger-153"><span class="linenos">153</span></a>                    <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_total</span><span class="p">,</span> <span class="mi">0</span>
</span><span id="ShadowHand.ShadowFinger-154"><a href="#ShadowHand.ShadowFinger-154"><span class="linenos">154</span></a>                    <span class="n">Q</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger-155"><a href="#ShadowHand.ShadowFinger-155"><span class="linenos">155</span></a>                    <span class="n">Q</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger-156"><a href="#ShadowHand.ShadowFinger-156"><span class="linenos">156</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_total</span><span class="p">,</span> <span class="n">t_array</span><span class="p">,</span> <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span>
</span><span id="ShadowHand.ShadowFinger-157"><a href="#ShadowHand.ShadowFinger-157"><span class="linenos">157</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="ShadowHand.ShadowFinger-158"><a href="#ShadowHand.ShadowFinger-158"><span class="linenos">158</span></a>                <span class="k">else</span><span class="p">:</span>  <span class="c1"># is overflow</span>
</span><span id="ShadowHand.ShadowFinger-159"><a href="#ShadowHand.ShadowFinger-159"><span class="linenos">159</span></a>                    <span class="c1"># Fill out first phase</span>
</span><span id="ShadowHand.ShadowFinger-160"><a href="#ShadowHand.ShadowFinger-160"><span class="linenos">160</span></a>                    <span class="n">Q</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger-161"><a href="#ShadowHand.ShadowFinger-161"><span class="linenos">161</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ShadowHand.ShadowFinger-162"><a href="#ShadowHand.ShadowFinger-162"><span class="linenos">162</span></a>                        <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ShadowHand.ShadowFinger-163"><a href="#ShadowHand.ShadowFinger-163"><span class="linenos">163</span></a>                        <span class="n">t_array_1</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger-164"><a href="#ShadowHand.ShadowFinger-164"><span class="linenos">164</span></a>                        <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger-165"><a href="#ShadowHand.ShadowFinger-165"><span class="linenos">165</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="ShadowHand.ShadowFinger-166"><a href="#ShadowHand.ShadowFinger-166"><span class="linenos">166</span></a>                    <span class="n">Q</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger-167"><a href="#ShadowHand.ShadowFinger-167"><span class="linenos">167</span></a>
</span><span id="ShadowHand.ShadowFinger-168"><a href="#ShadowHand.ShadowFinger-168"><span class="linenos">168</span></a>                    <span class="c1"># Fill out second phase</span>
</span><span id="ShadowHand.ShadowFinger-169"><a href="#ShadowHand.ShadowFinger-169"><span class="linenos">169</span></a>                    <span class="n">Q</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger-170"><a href="#ShadowHand.ShadowFinger-170"><span class="linenos">170</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">))</span> <span class="o">*</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger-171"><a href="#ShadowHand.ShadowFinger-171"><span class="linenos">171</span></a>                    <span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger-172"><a href="#ShadowHand.ShadowFinger-172"><span class="linenos">172</span></a>                    <span class="n">Q</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger-173"><a href="#ShadowHand.ShadowFinger-173"><span class="linenos">173</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="ShadowHand.ShadowFinger-174"><a href="#ShadowHand.ShadowFinger-174"><span class="linenos">174</span></a>                        <span class="n">x_total</span> <span class="o">-</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ShadowHand.ShadowFinger-175"><a href="#ShadowHand.ShadowFinger-175"><span class="linenos">175</span></a>                        <span class="n">t_array</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:],</span>
</span><span id="ShadowHand.ShadowFinger-176"><a href="#ShadowHand.ShadowFinger-176"><span class="linenos">176</span></a>                        <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger-177"><a href="#ShadowHand.ShadowFinger-177"><span class="linenos">177</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="ShadowHand.ShadowFinger-178"><a href="#ShadowHand.ShadowFinger-178"><span class="linenos">178</span></a>
</span><span id="ShadowHand.ShadowFinger-179"><a href="#ShadowHand.ShadowFinger-179"><span class="linenos">179</span></a>            <span class="k">else</span><span class="p">:</span>  <span class="c1"># is extending</span>
</span><span id="ShadowHand.ShadowFinger-180"><a href="#ShadowHand.ShadowFinger-180"><span class="linenos">180</span></a>                <span class="n">in_overflow</span> <span class="o">=</span> <span class="n">x_total</span> <span class="o">&gt;</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger-181"><a href="#ShadowHand.ShadowFinger-181"><span class="linenos">181</span></a>                <span class="n">is_overflow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger-182"><a href="#ShadowHand.ShadowFinger-182"><span class="linenos">182</span></a>
</span><span id="ShadowHand.ShadowFinger-183"><a href="#ShadowHand.ShadowFinger-183"><span class="linenos">183</span></a>                <span class="k">if</span> <span class="n">in_overflow</span> <span class="ow">and</span> <span class="n">is_overflow</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger-184"><a href="#ShadowHand.ShadowFinger-184"><span class="linenos">184</span></a>                    <span class="c1"># When we extend from a fully curled position</span>
</span><span id="ShadowHand.ShadowFinger-185"><a href="#ShadowHand.ShadowFinger-185"><span class="linenos">185</span></a>                    <span class="n">Q</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger-186"><a href="#ShadowHand.ShadowFinger-186"><span class="linenos">186</span></a>                    <span class="n">Q</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger-187"><a href="#ShadowHand.ShadowFinger-187"><span class="linenos">187</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="ShadowHand.ShadowFinger-188"><a href="#ShadowHand.ShadowFinger-188"><span class="linenos">188</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">x_total</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger-189"><a href="#ShadowHand.ShadowFinger-189"><span class="linenos">189</span></a>                        <span class="n">t_array</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger-190"><a href="#ShadowHand.ShadowFinger-190"><span class="linenos">190</span></a>                        <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger-191"><a href="#ShadowHand.ShadowFinger-191"><span class="linenos">191</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="ShadowHand.ShadowFinger-192"><a href="#ShadowHand.ShadowFinger-192"><span class="linenos">192</span></a>
</span><span id="ShadowHand.ShadowFinger-193"><a href="#ShadowHand.ShadowFinger-193"><span class="linenos">193</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">in_overflow</span> <span class="ow">and</span> <span class="n">is_overflow</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger-194"><a href="#ShadowHand.ShadowFinger-194"><span class="linenos">194</span></a>                    <span class="c1"># Fill out first phase</span>
</span><span id="ShadowHand.ShadowFinger-195"><a href="#ShadowHand.ShadowFinger-195"><span class="linenos">195</span></a>                    <span class="n">Q</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger-196"><a href="#ShadowHand.ShadowFinger-196"><span class="linenos">196</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="ShadowHand.ShadowFinger-197"><a href="#ShadowHand.ShadowFinger-197"><span class="linenos">197</span></a>                        <span class="n">a_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
</span><span id="ShadowHand.ShadowFinger-198"><a href="#ShadowHand.ShadowFinger-198"><span class="linenos">198</span></a>                        <span class="n">t_array_1</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger-199"><a href="#ShadowHand.ShadowFinger-199"><span class="linenos">199</span></a>                        <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger-200"><a href="#ShadowHand.ShadowFinger-200"><span class="linenos">200</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="ShadowHand.ShadowFinger-201"><a href="#ShadowHand.ShadowFinger-201"><span class="linenos">201</span></a>                    <span class="n">Q</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger-202"><a href="#ShadowHand.ShadowFinger-202"><span class="linenos">202</span></a>
</span><span id="ShadowHand.ShadowFinger-203"><a href="#ShadowHand.ShadowFinger-203"><span class="linenos">203</span></a>                    <span class="c1"># Fill out second phase</span>
</span><span id="ShadowHand.ShadowFinger-204"><a href="#ShadowHand.ShadowFinger-204"><span class="linenos">204</span></a>                    <span class="n">Q</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger-205"><a href="#ShadowHand.ShadowFinger-205"><span class="linenos">205</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">))</span> <span class="o">*</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger-206"><a href="#ShadowHand.ShadowFinger-206"><span class="linenos">206</span></a>                    <span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger-207"><a href="#ShadowHand.ShadowFinger-207"><span class="linenos">207</span></a>
</span><span id="ShadowHand.ShadowFinger-208"><a href="#ShadowHand.ShadowFinger-208"><span class="linenos">208</span></a>                    <span class="n">Q</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger-209"><a href="#ShadowHand.ShadowFinger-209"><span class="linenos">209</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ShadowHand.ShadowFinger-210"><a href="#ShadowHand.ShadowFinger-210"><span class="linenos">210</span></a>                        <span class="n">x_total</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger-211"><a href="#ShadowHand.ShadowFinger-211"><span class="linenos">211</span></a>                        <span class="n">t_array</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:],</span>
</span><span id="ShadowHand.ShadowFinger-212"><a href="#ShadowHand.ShadowFinger-212"><span class="linenos">212</span></a>                        <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger-213"><a href="#ShadowHand.ShadowFinger-213"><span class="linenos">213</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="ShadowHand.ShadowFinger-214"><a href="#ShadowHand.ShadowFinger-214"><span class="linenos">214</span></a>
</span><span id="ShadowHand.ShadowFinger-215"><a href="#ShadowHand.ShadowFinger-215"><span class="linenos">215</span></a>            <span class="k">def</span> <span class="nf">_set_ctrl</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
</span><span id="ShadowHand.ShadowFinger-216"><a href="#ShadowHand.ShadowFinger-216"><span class="linenos">216</span></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">qi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
</span><span id="ShadowHand.ShadowFinger-217"><a href="#ShadowHand.ShadowFinger-217"><span class="linenos">217</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">actuator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">actuator_ids</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">ctrl</span> <span class="o">=</span> <span class="n">qi</span>
</span><span id="ShadowHand.ShadowFinger-218"><a href="#ShadowHand.ShadowFinger-218"><span class="linenos">218</span></a>
</span><span id="ShadowHand.ShadowFinger-219"><a href="#ShadowHand.ShadowFinger-219"><span class="linenos">219</span></a>            <span class="c1"># execute Q</span>
</span><span id="ShadowHand.ShadowFinger-220"><a href="#ShadowHand.ShadowFinger-220"><span class="linenos">220</span></a>            <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">Q</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger-221"><a href="#ShadowHand.ShadowFinger-221"><span class="linenos">221</span></a>                <span class="n">_set_ctrl</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger-222"><a href="#ShadowHand.ShadowFinger-222"><span class="linenos">222</span></a>                <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Base class for robot simulation in MuJoCo.</p>

<p>This class provides a framework for simulating robots in MuJoCo environments. It defines
key properties and methods that should be implemented in child classes, including access
to the robot's model, data, and control mechanisms.</p>
</div>


                            <div id="ShadowHand.ShadowFinger.__init__" class="classattr">
                                        <input id="ShadowHand.ShadowFinger.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ShadowHand.ShadowFinger</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">sh</span><span class="p">:</span> <span class="n"><a href="#ShadowHand">ShadowHand</a></span>,</span><span class="param">	<span class="nb">type</span><span class="p">:</span> <span class="n"><a href="#ShadowHand.ShadowFinger.FingerType">ShadowHand.ShadowFinger.FingerType</a></span></span>)</span>

                <label class="view-source-button" for="ShadowHand.ShadowFinger.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ShadowHand.ShadowFinger.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ShadowHand.ShadowFinger.__init__-31"><a href="#ShadowHand.ShadowFinger.__init__-31"><span class="linenos">31</span></a>        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sh</span><span class="p">:</span> <span class="s2">&quot;ShadowHand&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="n">FingerType</span><span class="p">):</span>
</span><span id="ShadowHand.ShadowFinger.__init__-32"><a href="#ShadowHand.ShadowFinger.__init__-32"><span class="linenos">32</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">data</span>
</span><span id="ShadowHand.ShadowFinger.__init__-33"><a href="#ShadowHand.ShadowFinger.__init__-33"><span class="linenos">33</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">model</span>
</span><span id="ShadowHand.ShadowFinger.__init__-34"><a href="#ShadowHand.ShadowFinger.__init__-34"><span class="linenos">34</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="nb">type</span>
</span><span id="ShadowHand.ShadowFinger.__init__-35"><a href="#ShadowHand.ShadowFinger.__init__-35"><span class="linenos">35</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="nb">type</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ShadowHand.ShadowFinger.__init__-36"><a href="#ShadowHand.ShadowFinger.__init__-36"><span class="linenos">36</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">RobotInfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger.__init__-37"><a href="#ShadowHand.ShadowFinger.__init__-37"><span class="linenos">37</span></a>
</span><span id="ShadowHand.ShadowFinger.__init__-38"><a href="#ShadowHand.ShadowFinger.__init__-38"><span class="linenos">38</span></a>            <span class="c1"># custom naming</span>
</span><span id="ShadowHand.ShadowFinger.__init__-39"><a href="#ShadowHand.ShadowFinger.__init__-39"><span class="linenos">39</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">body_names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ShadowHand.ShadowFinger.__init__-40"><a href="#ShadowHand.ShadowFinger.__init__-40"><span class="linenos">40</span></a>                <span class="n">bna</span> <span class="k">for</span> <span class="n">bna</span> <span class="ow">in</span> <span class="n">get_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">BODY</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;ff&quot;</span> <span class="ow">in</span> <span class="n">bna</span>
</span><span id="ShadowHand.ShadowFinger.__init__-41"><a href="#ShadowHand.ShadowFinger.__init__-41"><span class="linenos">41</span></a>            <span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger.__init__-42"><a href="#ShadowHand.ShadowFinger.__init__-42"><span class="linenos">42</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">body_ids</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ShadowHand.ShadowFinger.__init__-43"><a href="#ShadowHand.ShadowFinger.__init__-43"><span class="linenos">43</span></a>                <span class="n">name2id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">bna</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">BODY</span><span class="p">)</span> <span class="k">for</span> <span class="n">bna</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">body_names</span>
</span><span id="ShadowHand.ShadowFinger.__init__-44"><a href="#ShadowHand.ShadowFinger.__init__-44"><span class="linenos">44</span></a>            <span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger.__init__-45"><a href="#ShadowHand.ShadowFinger.__init__-45"><span class="linenos">45</span></a>
</span><span id="ShadowHand.ShadowFinger.__init__-46"><a href="#ShadowHand.ShadowFinger.__init__-46"><span class="linenos">46</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">geom_ids</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ShadowHand.ShadowFinger.__init__-47"><a href="#ShadowHand.ShadowFinger.__init__-47"><span class="linenos">47</span></a>                <span class="n">geom_id</span>
</span><span id="ShadowHand.ShadowFinger.__init__-48"><a href="#ShadowHand.ShadowFinger.__init__-48"><span class="linenos">48</span></a>                <span class="k">for</span> <span class="n">geom_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">ngeom</span><span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger.__init__-49"><a href="#ShadowHand.ShadowFinger.__init__-49"><span class="linenos">49</span></a>                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geom_bodyid</span><span class="p">[</span><span class="n">geom_id</span><span class="p">])</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">body_ids</span>
</span><span id="ShadowHand.ShadowFinger.__init__-50"><a href="#ShadowHand.ShadowFinger.__init__-50"><span class="linenos">50</span></a>            <span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger.__init__-51"><a href="#ShadowHand.ShadowFinger.__init__-51"><span class="linenos">51</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">geom_names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ShadowHand.ShadowFinger.__init__-52"><a href="#ShadowHand.ShadowFinger.__init__-52"><span class="linenos">52</span></a>                <span class="n">id2name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">GEOM</span><span class="p">)</span> <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">geom_ids</span>
</span><span id="ShadowHand.ShadowFinger.__init__-53"><a href="#ShadowHand.ShadowFinger.__init__-53"><span class="linenos">53</span></a>            <span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger.__init__-54"><a href="#ShadowHand.ShadowFinger.__init__-54"><span class="linenos">54</span></a>
</span><span id="ShadowHand.ShadowFinger.__init__-55"><a href="#ShadowHand.ShadowFinger.__init__-55"><span class="linenos">55</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">site_names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ShadowHand.ShadowFinger.__init__-56"><a href="#ShadowHand.ShadowFinger.__init__-56"><span class="linenos">56</span></a>                <span class="n">sna</span>
</span><span id="ShadowHand.ShadowFinger.__init__-57"><a href="#ShadowHand.ShadowFinger.__init__-57"><span class="linenos">57</span></a>                <span class="k">for</span> <span class="n">sna</span> <span class="ow">in</span> <span class="n">get_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">SITE</span><span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger.__init__-58"><a href="#ShadowHand.ShadowFinger.__init__-58"><span class="linenos">58</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">sna</span>
</span><span id="ShadowHand.ShadowFinger.__init__-59"><a href="#ShadowHand.ShadowFinger.__init__-59"><span class="linenos">59</span></a>            <span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger.__init__-60"><a href="#ShadowHand.ShadowFinger.__init__-60"><span class="linenos">60</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">site_ids</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ShadowHand.ShadowFinger.__init__-61"><a href="#ShadowHand.ShadowFinger.__init__-61"><span class="linenos">61</span></a>                <span class="n">name2id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">sna</span><span class="p">,</span> <span class="n">ObjType</span><span class="o">.</span><span class="n">SITE</span><span class="p">)</span> <span class="k">for</span> <span class="n">sna</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">site_names</span>
</span><span id="ShadowHand.ShadowFinger.__init__-62"><a href="#ShadowHand.ShadowFinger.__init__-62"><span class="linenos">62</span></a>            <span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="ShadowHand.ShadowFinger.J" class="classattr">
                                        <input id="ShadowHand.ShadowFinger.J-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">J</span><span class="annotation">: numpy.ndarray</span>

                <label class="view-source-button" for="ShadowHand.ShadowFinger.J-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ShadowHand.ShadowFinger.J"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ShadowHand.ShadowFinger.J-64"><a href="#ShadowHand.ShadowFinger.J-64"><span class="linenos"> 64</span></a>        <span class="nd">@property</span>
</span><span id="ShadowHand.ShadowFinger.J-65"><a href="#ShadowHand.ShadowFinger.J-65"><span class="linenos"> 65</span></a>        <span class="k">def</span> <span class="nf">J</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger.J-66"><a href="#ShadowHand.ShadowFinger.J-66"><span class="linenos"> 66</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ShadowHand.ShadowFinger.J-67"><a href="#ShadowHand.ShadowFinger.J-67"><span class="linenos"> 67</span></a><span class="sd">            Get the full Jacobian in base frame.</span>
</span><span id="ShadowHand.ShadowFinger.J-68"><a href="#ShadowHand.ShadowFinger.J-68"><span class="linenos"> 68</span></a>
</span><span id="ShadowHand.ShadowFinger.J-69"><a href="#ShadowHand.ShadowFinger.J-69"><span class="linenos"> 69</span></a><span class="sd">            Returns</span>
</span><span id="ShadowHand.ShadowFinger.J-70"><a href="#ShadowHand.ShadowFinger.J-70"><span class="linenos"> 70</span></a><span class="sd">            ----------</span>
</span><span id="ShadowHand.ShadowFinger.J-71"><a href="#ShadowHand.ShadowFinger.J-71"><span class="linenos"> 71</span></a><span class="sd">                    Full Jacobian as a numpy array.</span>
</span><span id="ShadowHand.ShadowFinger.J-72"><a href="#ShadowHand.ShadowFinger.J-72"><span class="linenos"> 72</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="ShadowHand.ShadowFinger.J-73"><a href="#ShadowHand.ShadowFinger.J-73"><span class="linenos"> 73</span></a>            <span class="n">sys_J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nv</span><span class="p">))</span>
</span><span id="ShadowHand.ShadowFinger.J-74"><a href="#ShadowHand.ShadowFinger.J-74"><span class="linenos"> 74</span></a>
</span><span id="ShadowHand.ShadowFinger.J-75"><a href="#ShadowHand.ShadowFinger.J-75"><span class="linenos"> 75</span></a>            <span class="n">mj</span><span class="o">.</span><span class="n">mj_jacSite</span><span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger.J-76"><a href="#ShadowHand.ShadowFinger.J-76"><span class="linenos"> 76</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger.J-77"><a href="#ShadowHand.ShadowFinger.J-77"><span class="linenos"> 77</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger.J-78"><a href="#ShadowHand.ShadowFinger.J-78"><span class="linenos"> 78</span></a>                <span class="n">sys_J</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span>
</span><span id="ShadowHand.ShadowFinger.J-79"><a href="#ShadowHand.ShadowFinger.J-79"><span class="linenos"> 79</span></a>                <span class="n">sys_J</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span>
</span><span id="ShadowHand.ShadowFinger.J-80"><a href="#ShadowHand.ShadowFinger.J-80"><span class="linenos"> 80</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">site_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="ShadowHand.ShadowFinger.J-81"><a href="#ShadowHand.ShadowFinger.J-81"><span class="linenos"> 81</span></a>                <span class="c1"># name2id(self.model, f&quot;{self.name}/{self.info.site_names[0]}&quot;, ObjType.SITE),</span>
</span><span id="ShadowHand.ShadowFinger.J-82"><a href="#ShadowHand.ShadowFinger.J-82"><span class="linenos"> 82</span></a>            <span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger.J-83"><a href="#ShadowHand.ShadowFinger.J-83"><span class="linenos"> 83</span></a>
</span><span id="ShadowHand.ShadowFinger.J-84"><a href="#ShadowHand.ShadowFinger.J-84"><span class="linenos"> 84</span></a>            <span class="c1"># get only the dofs for this robot</span>
</span><span id="ShadowHand.ShadowFinger.J-85"><a href="#ShadowHand.ShadowFinger.J-85"><span class="linenos"> 85</span></a>            <span class="n">sys_J</span> <span class="o">=</span> <span class="n">sys_J</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">_dof_indxs</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger.J-86"><a href="#ShadowHand.ShadowFinger.J-86"><span class="linenos"> 86</span></a>
</span><span id="ShadowHand.ShadowFinger.J-87"><a href="#ShadowHand.ShadowFinger.J-87"><span class="linenos"> 87</span></a>            <span class="c1"># convert from world frame to base frame</span>
</span><span id="ShadowHand.ShadowFinger.J-88"><a href="#ShadowHand.ShadowFinger.J-88"><span class="linenos"> 88</span></a>            <span class="n">sys_J</span><span class="p">[</span><span class="mi">3</span><span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger.J-89"><a href="#ShadowHand.ShadowFinger.J-89"><span class="linenos"> 89</span></a>                <span class="n">get_pose</span><span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger.J-90"><a href="#ShadowHand.ShadowFinger.J-90"><span class="linenos"> 90</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger.J-91"><a href="#ShadowHand.ShadowFinger.J-91"><span class="linenos"> 91</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger.J-92"><a href="#ShadowHand.ShadowFinger.J-92"><span class="linenos"> 92</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sh</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/rh_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">knuckle&quot;</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger.J-93"><a href="#ShadowHand.ShadowFinger.J-93"><span class="linenos"> 93</span></a>                    <span class="n">ObjType</span><span class="o">.</span><span class="n">BODY</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger.J-94"><a href="#ShadowHand.ShadowFinger.J-94"><span class="linenos"> 94</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">R</span>
</span><span id="ShadowHand.ShadowFinger.J-95"><a href="#ShadowHand.ShadowFinger.J-95"><span class="linenos"> 95</span></a>                <span class="o">@</span> <span class="n">sys_J</span><span class="p">[</span><span class="mi">3</span><span class="p">:,</span> <span class="p">:]</span>
</span><span id="ShadowHand.ShadowFinger.J-96"><a href="#ShadowHand.ShadowFinger.J-96"><span class="linenos"> 96</span></a>            <span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger.J-97"><a href="#ShadowHand.ShadowFinger.J-97"><span class="linenos"> 97</span></a>            <span class="n">sys_J</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger.J-98"><a href="#ShadowHand.ShadowFinger.J-98"><span class="linenos"> 98</span></a>                <span class="n">get_pose</span><span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger.J-99"><a href="#ShadowHand.ShadowFinger.J-99"><span class="linenos"> 99</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger.J-100"><a href="#ShadowHand.ShadowFinger.J-100"><span class="linenos">100</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger.J-101"><a href="#ShadowHand.ShadowFinger.J-101"><span class="linenos">101</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sh</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/rh_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">knuckle&quot;</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger.J-102"><a href="#ShadowHand.ShadowFinger.J-102"><span class="linenos">102</span></a>                    <span class="n">ObjType</span><span class="o">.</span><span class="n">BODY</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger.J-103"><a href="#ShadowHand.ShadowFinger.J-103"><span class="linenos">103</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">R</span>
</span><span id="ShadowHand.ShadowFinger.J-104"><a href="#ShadowHand.ShadowFinger.J-104"><span class="linenos">104</span></a>                <span class="o">@</span> <span class="n">sys_J</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="ShadowHand.ShadowFinger.J-105"><a href="#ShadowHand.ShadowFinger.J-105"><span class="linenos">105</span></a>            <span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger.J-106"><a href="#ShadowHand.ShadowFinger.J-106"><span class="linenos">106</span></a>            <span class="k">return</span> <span class="n">sys_J</span>
</span></pre></div>


            <div class="docstring"><p>Get the full Jacobian in base frame.</p>

<h2 id="returns">Returns</h2>

<pre><code>    Full Jacobian as a numpy array.
</code></pre>
</div>


                            </div>
                            <div id="ShadowHand.ShadowFinger.data" class="classattr">
                                        <input id="ShadowHand.ShadowFinger.data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">data</span><span class="annotation">: mujoco._structs.MjData</span>

                <label class="view-source-button" for="ShadowHand.ShadowFinger.data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ShadowHand.ShadowFinger.data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ShadowHand.ShadowFinger.data-108"><a href="#ShadowHand.ShadowFinger.data-108"><span class="linenos">108</span></a>        <span class="nd">@property</span>
</span><span id="ShadowHand.ShadowFinger.data-109"><a href="#ShadowHand.ShadowFinger.data-109"><span class="linenos">109</span></a>        <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjData</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger.data-110"><a href="#ShadowHand.ShadowFinger.data-110"><span class="linenos">110</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</span></pre></div>


            <div class="docstring"><p>Access the current simulation data.</p>

<p>This property provides access to an instance of the <code>MjData</code> class, which contains the dynamic
simulation state. This includes quantities such as joint positions, velocities,
actuator forces, and sensory information. The <code>MjData</code> object is updated at each simulation step
and can be used to inspect the real-time state of the robot during the simulation.</p>

<h2 id="returns">Returns</h2>

<p>mj.MjData
    An object representing the current dynamic state of the simulation.</p>
</div>


                            </div>
                            <div id="ShadowHand.ShadowFinger.model" class="classattr">
                                        <input id="ShadowHand.ShadowFinger.model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">model</span><span class="annotation">: mujoco._structs.MjModel</span>

                <label class="view-source-button" for="ShadowHand.ShadowFinger.model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ShadowHand.ShadowFinger.model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ShadowHand.ShadowFinger.model-112"><a href="#ShadowHand.ShadowFinger.model-112"><span class="linenos">112</span></a>        <span class="nd">@property</span>
</span><span id="ShadowHand.ShadowFinger.model-113"><a href="#ShadowHand.ShadowFinger.model-113"><span class="linenos">113</span></a>        <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mj</span><span class="o">.</span><span class="n">MjModel</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger.model-114"><a href="#ShadowHand.ShadowFinger.model-114"><span class="linenos">114</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span>
</span></pre></div>


            <div class="docstring"><p>Access the model of the MuJoCo simulation.</p>

<p>This property returns an instance of the <code>MjModel</code> class, which describes the physical and
mechanical properties of the simulation. The <code>MjModel</code> object contains static information about the
robot such as its kinematic tree, inertial properties, joint and actuator definitions, and geometry
configurations. It is used to define the robot's structure and behavior within the simulation.</p>

<h2 id="returns">Returns</h2>

<p>mj.MjModel
    An object representing the static model of the robot and overall MuJoCo simulation.</p>
</div>


                            </div>
                            <div id="ShadowHand.ShadowFinger.info" class="classattr">
                                        <input id="ShadowHand.ShadowFinger.info-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">info</span><span class="annotation">: <a href="../utils/mj.html#RobotInfo">utils.mj.RobotInfo</a></span>

                <label class="view-source-button" for="ShadowHand.ShadowFinger.info-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ShadowHand.ShadowFinger.info"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ShadowHand.ShadowFinger.info-116"><a href="#ShadowHand.ShadowFinger.info-116"><span class="linenos">116</span></a>        <span class="nd">@property</span>
</span><span id="ShadowHand.ShadowFinger.info-117"><a href="#ShadowHand.ShadowFinger.info-117"><span class="linenos">117</span></a>        <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RobotInfo</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger.info-118"><a href="#ShadowHand.ShadowFinger.info-118"><span class="linenos">118</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span>
</span></pre></div>


            <div class="docstring"><p>Get detailed information about the robot.</p>

<p>This property returns an instance of the <code>RobotInfo</code> class, which provides comprehensive
details about the robot's structure and components. This includes information on the robot's
bodies, joints, actuators, and geometries, among other attributes. The <code>RobotInfo</code> instance
can be used to access various properties such as the number of joints, actuator limits, joint
limits, and more.</p>

<h2 id="returns">Returns</h2>

<p>RobotInfo
    An object containing detailed information about the robot's configuration and components.</p>
</div>


                            </div>
                            <div id="ShadowHand.ShadowFinger.name" class="classattr">
                                        <input id="ShadowHand.ShadowFinger.name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">name</span><span class="annotation">: str</span>

                <label class="view-source-button" for="ShadowHand.ShadowFinger.name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ShadowHand.ShadowFinger.name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ShadowHand.ShadowFinger.name-120"><a href="#ShadowHand.ShadowFinger.name-120"><span class="linenos">120</span></a>        <span class="nd">@property</span>
</span><span id="ShadowHand.ShadowFinger.name-121"><a href="#ShadowHand.ShadowFinger.name-121"><span class="linenos">121</span></a>        <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger.name-122"><a href="#ShadowHand.ShadowFinger.name-122"><span class="linenos">122</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
</span></pre></div>


            <div class="docstring"><p>Get the name of the robot.</p>

<p>This property returns the name of the robot as a string. The name is typically a unique identifier
used to distinguish between different robots in the simulation environment.</p>

<h2 id="returns">Returns</h2>

<p>str
    The name of the robot as a string.</p>
</div>


                            </div>
                            <div id="ShadowHand.ShadowFinger.step" class="classattr">
                                        <input id="ShadowHand.ShadowFinger.step-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">step</span><span class="annotation">: None</span>

                <label class="view-source-button" for="ShadowHand.ShadowFinger.step-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ShadowHand.ShadowFinger.step"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ShadowHand.ShadowFinger.step-124"><a href="#ShadowHand.ShadowFinger.step-124"><span class="linenos">124</span></a>        <span class="nd">@property</span>
</span><span id="ShadowHand.ShadowFinger.step-125"><a href="#ShadowHand.ShadowFinger.step-125"><span class="linenos">125</span></a>        <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger.step-126"><a href="#ShadowHand.ShadowFinger.step-126"><span class="linenos">126</span></a>            <span class="k">return</span>
</span></pre></div>


            <div class="docstring"><p>Perform a step in the controller.</p>

<p>This method calls the <code><a href="#ShadowHand.ShadowFinger.step">step()</a></code> method of the controller object and
before doing so it checks if there are any tasks to be performed in
the robot task queue</p>
</div>


                            </div>
                            <div id="ShadowHand.ShadowFinger.set_ctrl" class="classattr">
                                        <input id="ShadowHand.ShadowFinger.set_ctrl-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_ctrl</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>,</span><span class="param">	<span class="n">ss</span><span class="p">:</span> <span class="n"><a href="../sims/base_sim.html#SimSync">sims.base_sim.SimSync</a></span>,</span><span class="param">	<span class="n">time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ShadowHand.ShadowFinger.set_ctrl-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ShadowHand.ShadowFinger.set_ctrl"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ShadowHand.ShadowFinger.set_ctrl-128"><a href="#ShadowHand.ShadowFinger.set_ctrl-128"><span class="linenos">128</span></a>        <span class="k">def</span> <span class="nf">set_ctrl</span><span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-129"><a href="#ShadowHand.ShadowFinger.set_ctrl-129"><span class="linenos">129</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">ss</span><span class="p">:</span> <span class="n">SimSync</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-130"><a href="#ShadowHand.ShadowFinger.set_ctrl-130"><span class="linenos">130</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-131"><a href="#ShadowHand.ShadowFinger.set_ctrl-131"><span class="linenos">131</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">n_actuators</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-132"><a href="#ShadowHand.ShadowFinger.set_ctrl-132"><span class="linenos">132</span></a>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-133"><a href="#ShadowHand.ShadowFinger.set_ctrl-133"><span class="linenos">133</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-134"><a href="#ShadowHand.ShadowFinger.set_ctrl-134"><span class="linenos">134</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-135"><a href="#ShadowHand.ShadowFinger.set_ctrl-135"><span class="linenos">135</span></a>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-136"><a href="#ShadowHand.ShadowFinger.set_ctrl-136"><span class="linenos">136</span></a>            <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-137"><a href="#ShadowHand.ShadowFinger.set_ctrl-137"><span class="linenos">137</span></a>            <span class="n">trajectory_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">timestep</span><span class="p">))</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-138"><a href="#ShadowHand.ShadowFinger.set_ctrl-138"><span class="linenos">138</span></a>            <span class="n">t_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">trajectory_samples</span><span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-139"><a href="#ShadowHand.ShadowFinger.set_ctrl-139"><span class="linenos">139</span></a>            <span class="n">a_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">actuator_limits</span><span class="o">.</span><span class="n">T</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-140"><a href="#ShadowHand.ShadowFinger.set_ctrl-140"><span class="linenos">140</span></a>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-141"><a href="#ShadowHand.ShadowFinger.set_ctrl-141"><span class="linenos">141</span></a>            <span class="n">Q</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">t_array</span><span class="p">,</span> <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-142"><a href="#ShadowHand.ShadowFinger.set_ctrl-142"><span class="linenos">142</span></a>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-143"><a href="#ShadowHand.ShadowFinger.set_ctrl-143"><span class="linenos">143</span></a>            <span class="n">x_total</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-144"><a href="#ShadowHand.ShadowFinger.set_ctrl-144"><span class="linenos">144</span></a>            <span class="n">is_curling</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-145"><a href="#ShadowHand.ShadowFinger.set_ctrl-145"><span class="linenos">145</span></a>            <span class="n">in_overflow</span> <span class="o">=</span> <span class="n">x_total</span> <span class="o">&gt;=</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-146"><a href="#ShadowHand.ShadowFinger.set_ctrl-146"><span class="linenos">146</span></a>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-147"><a href="#ShadowHand.ShadowFinger.set_ctrl-147"><span class="linenos">147</span></a>            <span class="n">half_duration</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-148"><a href="#ShadowHand.ShadowFinger.set_ctrl-148"><span class="linenos">148</span></a>            <span class="n">half_samples</span> <span class="o">=</span> <span class="n">trajectory_samples</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-149"><a href="#ShadowHand.ShadowFinger.set_ctrl-149"><span class="linenos">149</span></a>            <span class="n">t_array_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">half_duration</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">half_samples</span><span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-150"><a href="#ShadowHand.ShadowFinger.set_ctrl-150"><span class="linenos">150</span></a>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-151"><a href="#ShadowHand.ShadowFinger.set_ctrl-151"><span class="linenos">151</span></a>            <span class="k">if</span> <span class="n">is_curling</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-152"><a href="#ShadowHand.ShadowFinger.set_ctrl-152"><span class="linenos">152</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">in_overflow</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-153"><a href="#ShadowHand.ShadowFinger.set_ctrl-153"><span class="linenos">153</span></a>                    <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_total</span><span class="p">,</span> <span class="mi">0</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-154"><a href="#ShadowHand.ShadowFinger.set_ctrl-154"><span class="linenos">154</span></a>                    <span class="n">Q</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-155"><a href="#ShadowHand.ShadowFinger.set_ctrl-155"><span class="linenos">155</span></a>                    <span class="n">Q</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-156"><a href="#ShadowHand.ShadowFinger.set_ctrl-156"><span class="linenos">156</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_total</span><span class="p">,</span> <span class="n">t_array</span><span class="p">,</span> <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-157"><a href="#ShadowHand.ShadowFinger.set_ctrl-157"><span class="linenos">157</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-158"><a href="#ShadowHand.ShadowFinger.set_ctrl-158"><span class="linenos">158</span></a>                <span class="k">else</span><span class="p">:</span>  <span class="c1"># is overflow</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-159"><a href="#ShadowHand.ShadowFinger.set_ctrl-159"><span class="linenos">159</span></a>                    <span class="c1"># Fill out first phase</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-160"><a href="#ShadowHand.ShadowFinger.set_ctrl-160"><span class="linenos">160</span></a>                    <span class="n">Q</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-161"><a href="#ShadowHand.ShadowFinger.set_ctrl-161"><span class="linenos">161</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-162"><a href="#ShadowHand.ShadowFinger.set_ctrl-162"><span class="linenos">162</span></a>                        <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-163"><a href="#ShadowHand.ShadowFinger.set_ctrl-163"><span class="linenos">163</span></a>                        <span class="n">t_array_1</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-164"><a href="#ShadowHand.ShadowFinger.set_ctrl-164"><span class="linenos">164</span></a>                        <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-165"><a href="#ShadowHand.ShadowFinger.set_ctrl-165"><span class="linenos">165</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-166"><a href="#ShadowHand.ShadowFinger.set_ctrl-166"><span class="linenos">166</span></a>                    <span class="n">Q</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-167"><a href="#ShadowHand.ShadowFinger.set_ctrl-167"><span class="linenos">167</span></a>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-168"><a href="#ShadowHand.ShadowFinger.set_ctrl-168"><span class="linenos">168</span></a>                    <span class="c1"># Fill out second phase</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-169"><a href="#ShadowHand.ShadowFinger.set_ctrl-169"><span class="linenos">169</span></a>                    <span class="n">Q</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-170"><a href="#ShadowHand.ShadowFinger.set_ctrl-170"><span class="linenos">170</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">))</span> <span class="o">*</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-171"><a href="#ShadowHand.ShadowFinger.set_ctrl-171"><span class="linenos">171</span></a>                    <span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-172"><a href="#ShadowHand.ShadowFinger.set_ctrl-172"><span class="linenos">172</span></a>                    <span class="n">Q</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-173"><a href="#ShadowHand.ShadowFinger.set_ctrl-173"><span class="linenos">173</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-174"><a href="#ShadowHand.ShadowFinger.set_ctrl-174"><span class="linenos">174</span></a>                        <span class="n">x_total</span> <span class="o">-</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-175"><a href="#ShadowHand.ShadowFinger.set_ctrl-175"><span class="linenos">175</span></a>                        <span class="n">t_array</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:],</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-176"><a href="#ShadowHand.ShadowFinger.set_ctrl-176"><span class="linenos">176</span></a>                        <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-177"><a href="#ShadowHand.ShadowFinger.set_ctrl-177"><span class="linenos">177</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-178"><a href="#ShadowHand.ShadowFinger.set_ctrl-178"><span class="linenos">178</span></a>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-179"><a href="#ShadowHand.ShadowFinger.set_ctrl-179"><span class="linenos">179</span></a>            <span class="k">else</span><span class="p">:</span>  <span class="c1"># is extending</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-180"><a href="#ShadowHand.ShadowFinger.set_ctrl-180"><span class="linenos">180</span></a>                <span class="n">in_overflow</span> <span class="o">=</span> <span class="n">x_total</span> <span class="o">&gt;</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-181"><a href="#ShadowHand.ShadowFinger.set_ctrl-181"><span class="linenos">181</span></a>                <span class="n">is_overflow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-182"><a href="#ShadowHand.ShadowFinger.set_ctrl-182"><span class="linenos">182</span></a>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-183"><a href="#ShadowHand.ShadowFinger.set_ctrl-183"><span class="linenos">183</span></a>                <span class="k">if</span> <span class="n">in_overflow</span> <span class="ow">and</span> <span class="n">is_overflow</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-184"><a href="#ShadowHand.ShadowFinger.set_ctrl-184"><span class="linenos">184</span></a>                    <span class="c1"># When we extend from a fully curled position</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-185"><a href="#ShadowHand.ShadowFinger.set_ctrl-185"><span class="linenos">185</span></a>                    <span class="n">Q</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-186"><a href="#ShadowHand.ShadowFinger.set_ctrl-186"><span class="linenos">186</span></a>                    <span class="n">Q</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-187"><a href="#ShadowHand.ShadowFinger.set_ctrl-187"><span class="linenos">187</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-188"><a href="#ShadowHand.ShadowFinger.set_ctrl-188"><span class="linenos">188</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">x_total</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-189"><a href="#ShadowHand.ShadowFinger.set_ctrl-189"><span class="linenos">189</span></a>                        <span class="n">t_array</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-190"><a href="#ShadowHand.ShadowFinger.set_ctrl-190"><span class="linenos">190</span></a>                        <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-191"><a href="#ShadowHand.ShadowFinger.set_ctrl-191"><span class="linenos">191</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-192"><a href="#ShadowHand.ShadowFinger.set_ctrl-192"><span class="linenos">192</span></a>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-193"><a href="#ShadowHand.ShadowFinger.set_ctrl-193"><span class="linenos">193</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">in_overflow</span> <span class="ow">and</span> <span class="n">is_overflow</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-194"><a href="#ShadowHand.ShadowFinger.set_ctrl-194"><span class="linenos">194</span></a>                    <span class="c1"># Fill out first phase</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-195"><a href="#ShadowHand.ShadowFinger.set_ctrl-195"><span class="linenos">195</span></a>                    <span class="n">Q</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-196"><a href="#ShadowHand.ShadowFinger.set_ctrl-196"><span class="linenos">196</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-197"><a href="#ShadowHand.ShadowFinger.set_ctrl-197"><span class="linenos">197</span></a>                        <span class="n">a_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-198"><a href="#ShadowHand.ShadowFinger.set_ctrl-198"><span class="linenos">198</span></a>                        <span class="n">t_array_1</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-199"><a href="#ShadowHand.ShadowFinger.set_ctrl-199"><span class="linenos">199</span></a>                        <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-200"><a href="#ShadowHand.ShadowFinger.set_ctrl-200"><span class="linenos">200</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-201"><a href="#ShadowHand.ShadowFinger.set_ctrl-201"><span class="linenos">201</span></a>                    <span class="n">Q</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-202"><a href="#ShadowHand.ShadowFinger.set_ctrl-202"><span class="linenos">202</span></a>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-203"><a href="#ShadowHand.ShadowFinger.set_ctrl-203"><span class="linenos">203</span></a>                    <span class="c1"># Fill out second phase</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-204"><a href="#ShadowHand.ShadowFinger.set_ctrl-204"><span class="linenos">204</span></a>                    <span class="n">Q</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-205"><a href="#ShadowHand.ShadowFinger.set_ctrl-205"><span class="linenos">205</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">))</span> <span class="o">*</span> <span class="n">a_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-206"><a href="#ShadowHand.ShadowFinger.set_ctrl-206"><span class="linenos">206</span></a>                    <span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-207"><a href="#ShadowHand.ShadowFinger.set_ctrl-207"><span class="linenos">207</span></a>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-208"><a href="#ShadowHand.ShadowFinger.set_ctrl-208"><span class="linenos">208</span></a>                    <span class="n">Q</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtraj</span><span class="p">(</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-209"><a href="#ShadowHand.ShadowFinger.set_ctrl-209"><span class="linenos">209</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-210"><a href="#ShadowHand.ShadowFinger.set_ctrl-210"><span class="linenos">210</span></a>                        <span class="n">x_total</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-211"><a href="#ShadowHand.ShadowFinger.set_ctrl-211"><span class="linenos">211</span></a>                        <span class="n">t_array</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_array_1</span><span class="p">)</span> <span class="p">:],</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-212"><a href="#ShadowHand.ShadowFinger.set_ctrl-212"><span class="linenos">212</span></a>                        <span class="n">interp_type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-213"><a href="#ShadowHand.ShadowFinger.set_ctrl-213"><span class="linenos">213</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-214"><a href="#ShadowHand.ShadowFinger.set_ctrl-214"><span class="linenos">214</span></a>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-215"><a href="#ShadowHand.ShadowFinger.set_ctrl-215"><span class="linenos">215</span></a>            <span class="k">def</span> <span class="nf">_set_ctrl</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-216"><a href="#ShadowHand.ShadowFinger.set_ctrl-216"><span class="linenos">216</span></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">qi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-217"><a href="#ShadowHand.ShadowFinger.set_ctrl-217"><span class="linenos">217</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">actuator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">actuator_ids</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">ctrl</span> <span class="o">=</span> <span class="n">qi</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-218"><a href="#ShadowHand.ShadowFinger.set_ctrl-218"><span class="linenos">218</span></a>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-219"><a href="#ShadowHand.ShadowFinger.set_ctrl-219"><span class="linenos">219</span></a>            <span class="c1"># execute Q</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-220"><a href="#ShadowHand.ShadowFinger.set_ctrl-220"><span class="linenos">220</span></a>            <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">Q</span><span class="p">:</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-221"><a href="#ShadowHand.ShadowFinger.set_ctrl-221"><span class="linenos">221</span></a>                <span class="n">_set_ctrl</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</span><span id="ShadowHand.ShadowFinger.set_ctrl-222"><a href="#ShadowHand.ShadowFinger.set_ctrl-222"><span class="linenos">222</span></a>                <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This function sends the control signal to the simulated robot.</p>

<h2 id="args">Args</h2>

<pre><code>    x (Union[list, np.ndarray]): control signal
</code></pre>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="base_robot.html#BaseRobot">robots.base_robot.BaseRobot</a></dt>
                                <dd id="ShadowHand.ShadowFinger.ctrl" class="variable"><a href="base_robot.html#BaseRobot.ctrl">ctrl</a></dd>
                <dd id="ShadowHand.ShadowFinger.Jp" class="variable"><a href="base_robot.html#BaseRobot.Jp">Jp</a></dd>
                <dd id="ShadowHand.ShadowFinger.Jo" class="variable"><a href="base_robot.html#BaseRobot.Jo">Jo</a></dd>
                <dd id="ShadowHand.ShadowFinger.c" class="variable"><a href="base_robot.html#BaseRobot.c">c</a></dd>
                <dd id="ShadowHand.ShadowFinger.Mq" class="variable"><a href="base_robot.html#BaseRobot.Mq">Mq</a></dd>
                <dd id="ShadowHand.ShadowFinger.Mx" class="variable"><a href="base_robot.html#BaseRobot.Mx">Mx</a></dd>
                <dd id="ShadowHand.ShadowFinger.q" class="variable"><a href="base_robot.html#BaseRobot.q">q</a></dd>
                <dd id="ShadowHand.ShadowFinger.dq" class="variable"><a href="base_robot.html#BaseRobot.dq">dq</a></dd>
                <dd id="ShadowHand.ShadowFinger.ddq" class="variable"><a href="base_robot.html#BaseRobot.ddq">ddq</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ShadowHand.ShadowFinger.FingerType">
                            <input id="ShadowHand.ShadowFinger.FingerType-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ShadowHand.ShadowFinger.FingerType</span><wbr>(<span class="base">enum.Enum</span>):

                <label class="view-source-button" for="ShadowHand.ShadowFinger.FingerType-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ShadowHand.ShadowFinger.FingerType"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ShadowHand.ShadowFinger.FingerType-24"><a href="#ShadowHand.ShadowFinger.FingerType-24"><span class="linenos">24</span></a>        <span class="k">class</span> <span class="nc">FingerType</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="ShadowHand.ShadowFinger.FingerType-25"><a href="#ShadowHand.ShadowFinger.FingerType-25"><span class="linenos">25</span></a>            <span class="n">FF</span> <span class="o">=</span> <span class="s2">&quot;FF&quot;</span>
</span><span id="ShadowHand.ShadowFinger.FingerType-26"><a href="#ShadowHand.ShadowFinger.FingerType-26"><span class="linenos">26</span></a>            <span class="n">MF</span> <span class="o">=</span> <span class="s2">&quot;MF&quot;</span>
</span><span id="ShadowHand.ShadowFinger.FingerType-27"><a href="#ShadowHand.ShadowFinger.FingerType-27"><span class="linenos">27</span></a>            <span class="n">RF</span> <span class="o">=</span> <span class="s2">&quot;RF&quot;</span>
</span><span id="ShadowHand.ShadowFinger.FingerType-28"><a href="#ShadowHand.ShadowFinger.FingerType-28"><span class="linenos">28</span></a>            <span class="n">LF</span> <span class="o">=</span> <span class="s2">&quot;LF&quot;</span>
</span><span id="ShadowHand.ShadowFinger.FingerType-29"><a href="#ShadowHand.ShadowFinger.FingerType-29"><span class="linenos">29</span></a>            <span class="n">TH</span> <span class="o">=</span> <span class="s2">&quot;TH&quot;</span>
</span></pre></div>


    

                            <div id="ShadowHand.ShadowFinger.FingerType.FF" class="classattr">
                                <div class="attr variable">
            <span class="name">FF</span>        =
<span class="default_value">&lt;FingerType.FF: &#39;FF&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#ShadowHand.ShadowFinger.FingerType.FF"></a>
    
    

                            </div>
                            <div id="ShadowHand.ShadowFinger.FingerType.MF" class="classattr">
                                <div class="attr variable">
            <span class="name">MF</span>        =
<span class="default_value">&lt;FingerType.MF: &#39;MF&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#ShadowHand.ShadowFinger.FingerType.MF"></a>
    
    

                            </div>
                            <div id="ShadowHand.ShadowFinger.FingerType.RF" class="classattr">
                                <div class="attr variable">
            <span class="name">RF</span>        =
<span class="default_value">&lt;FingerType.RF: &#39;RF&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#ShadowHand.ShadowFinger.FingerType.RF"></a>
    
    

                            </div>
                            <div id="ShadowHand.ShadowFinger.FingerType.LF" class="classattr">
                                <div class="attr variable">
            <span class="name">LF</span>        =
<span class="default_value">&lt;FingerType.LF: &#39;LF&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#ShadowHand.ShadowFinger.FingerType.LF"></a>
    
    

                            </div>
                            <div id="ShadowHand.ShadowFinger.FingerType.TH" class="classattr">
                                <div class="attr variable">
            <span class="name">TH</span>        =
<span class="default_value">&lt;FingerType.TH: &#39;TH&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#ShadowHand.ShadowFinger.FingerType.TH"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>enum.Enum</dt>
                                <dd id="ShadowHand.ShadowFinger.FingerType.name" class="variable">name</dd>
                <dd id="ShadowHand.ShadowFinger.FingerType.value" class="variable">value</dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>